import{_ as d,r as l,o as k,c as m,b as a,w as e,a as n,d as s,e as c}from"./app.c0ce12a9.js";const v={},b=n("h1",{id:"conversaciones-conversations",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#conversaciones-conversations","aria-hidden":"true"},"#"),s(" Conversaciones ("),n("code",null,"conversations"),s(")")],-1),g=n("p",null,"Crea potentes interfaces conversacionales con facilidad.",-1),y=n("h2",{id:"introduccion",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#introduccion","aria-hidden":"true"},"#"),s(" Introducci\xF3n")],-1),f=n("p",null,"La mayor\xEDa de los chats consisten en algo m\xE1s que un solo mensaje. (meh)",-1),h=n("p",null,"Por ejemplo, puedes querer hacer una pregunta al usuario, y luego esperar la respuesta. Esto puede incluso ir y venir varias veces, de modo que se desarrolla una conversaci\xF3n.",-1),w=s("Cuando pienses en el "),_=s("middleware"),x=s(", te dar\xE1s cuenta de que todo se basa en un \xFAnico "),q=s("objeto contexto"),j=s(" por manejador. Esto significa que siempre se maneja un solo mensaje de forma aislada. No es f\xE1cil escribir algo como \u201Ccomprobar el texto de hace tres mensajes\u201D o algo as\xED."),C=c(`<p><strong>Este plugin viene al rescate:</strong> Proporciona una forma extremadamente flexible de definir las conversaciones entre tu bot y tus usuarios.</p><p>Muchos marcos de bots te hacen definir grandes objetos de configuraci\xF3n con pasos y etapas y saltos y flujos de asistentes y lo que sea. Esto conduce a una gran cantidad de c\xF3digo repetitivo, y hace que sea dif\xEDcil de seguir. <strong>Este plugin no funciona as\xED.</strong></p><p>En su lugar, con este plugin, usar\xE1s algo mucho m\xE1s poderoso: <strong>c\xF3digo</strong>. B\xE1sicamente, simplemente defines una funci\xF3n JavaScript normal que te permite definir c\xF3mo evoluciona la conversaci\xF3n. A medida que el bot y el usuario hablen entre s\xED, la funci\xF3n se ejecutar\xE1 declaraci\xF3n por declaraci\xF3n.</p><p>(Para ser justos, en realidad no es as\xED como funciona bajo el cap\xF3. Pero es muy \xFAtil pensarlo as\xED). En realidad, tu funci\xF3n se ejecutar\xE1 de manera un poco diferente, pero llegaremos a eso <a href="#esperar-a-las-actualizaciones">m\xE1s tarde</a>.</p><h2 id="ejemplo-simple" tabindex="-1"><a class="header-anchor" href="#ejemplo-simple" aria-hidden="true">#</a> Ejemplo simple</h2><p>Antes de que nos sumerjamos en c\xF3mo se pueden crear conversaciones, echa un vistazo a un breve ejemplo de JavaScript de c\xF3mo se ver\xE1 una conversaci\xF3n.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">saludo</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;\xA1Hola! \xBFCu\xE1l es tu nombre?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> mensaje <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\xA1Bienvenido al chat, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>mensaje<span class="token punctuation">.</span>texto<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>En esta conversaci\xF3n, el bot saludar\xE1 primero al usuario y le preguntar\xE1 su nombre. Luego esperar\xE1 hasta que el usuario env\xEDe su nombre. Por \xFAltimo, el bot da la bienvenida al usuario al chat, repitiendo el nombre.</p><p>F\xE1cil, \xBFverdad? \xA1Veamos c\xF3mo se hace!</p><h2 id="funciones-del-constructor-de-conversaciones" tabindex="-1"><a class="header-anchor" href="#funciones-del-constructor-de-conversaciones" aria-hidden="true">#</a> Funciones del Constructor de Conversaciones</h2><p>En primer lugar, vamos a importar algunas cosas.</p>`,11),z=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"Conversation"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"ConversationFlavor"),n("span",{class:"token punctuation"},","),s(`
  conversations`),n("span",{class:"token punctuation"},","),s(`
  createConversation`),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"@grammyjs/conversations"'),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),S=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(`
  conversations`),n("span",{class:"token punctuation"},","),s(`
  createConversation`),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"@grammyjs/conversations"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),E=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"Conversation"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"ConversationFlavor"),n("span",{class:"token punctuation"},","),s(`
  conversations`),n("span",{class:"token punctuation"},","),s(`
  createConversation`),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"https://deno.land/x/grammy_conversations@v1.0.3/mod.ts"'),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),M=c(`<p>Una vez aclarado esto, podemos ver c\xF3mo definir las interfaces conversacionales.</p><p>El elemento principal de una conversaci\xF3n es una funci\xF3n con dos argumentos. A esto lo llamamos la <em>funci\xF3n constructora de la conversaci\xF3n</em>.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">saludo</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO: codificar la conversaci\xF3n</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Veamos cu\xE1les son los dos par\xE1metros.</p>`,4),A=n("em",null,"El segundo par\xE1metro",-1),T=s("* no es tan interesante, es s\xF3lo un objeto de contexto normal. Como siempre, se llama "),P=n("code",null,"ctx",-1),F=s(" y utiliza tu "),I=s("tipo de contexto personalizado"),D=s(" (quiz\xE1s llamado "),B=n("code",null,[s("My"),n("wbr"),s("Context")],-1),J=s("). El plugin de conversaciones exporta un "),O=s("context flavor"),L=s(" llamado "),R=n("code",null,[s("Conversation"),n("wbr"),s("Flavor")],-1),G=s("."),N=n("strong",null,"El primer par\xE1metro",-1),V=s(" es el elemento central de este plugin. Se llama com\xFAnmente "),H=n("code",null,"conversation",-1),Q=s(", y tiene el tipo "),$=n("code",null,"Conversaci\xF3n",-1),U=s(" ("),Y={href:"https://doc.deno.land/https://deno.land/x/grammy_conversations/mod.ts/~/Conversation",target:"_blank",rel:"noopener noreferrer"},W=s("referencia de la API"),K=s("). Puede ser usado como un manejador para controlar la conversaci\xF3n, como esperar la entrada del usuario, y m\xE1s. El tipo "),X=n("code",null,"Conversation",-1),Z=s(" espera su "),nn=s("tipo de contexto personalizado"),sn=s(" como par\xE1metro de tipo, por lo que a menudo utilizar\xEDa "),an=n("code",null,[s("Conversation<My"),n("wbr"),s("Context>")],-1),en=s("."),tn=c(`<p>En resumen, en TypeScript, tu funci\xF3n de construcci\xF3n de conversaci\xF3n se ver\xE1 as\xED.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">MyContext</span> <span class="token operator">=</span> Context <span class="token operator">&amp;</span> ConversationFlavor<span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">MyConversation</span> <span class="token operator">=</span> Conversation<span class="token operator">&lt;</span>MyContext<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO: codificar la conversaci\xF3n</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Dentro de su funci\xF3n de construcci\xF3n de conversaci\xF3n, ahora puede definir c\xF3mo debe ser la conversaci\xF3n. Antes de profundizar en cada una de las caracter\xEDsticas de este plugin, echemos un vistazo a un ejemplo m\xE1s complejo que el <a href="#ejemplo-simple">simple</a> anterior.</p>`,3),on=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"movie"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xBFCu\xE1ntas pel\xEDculas favoritas tiene?"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" count "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),s("form"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"number"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" movies"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"string"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"let"),s(" i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(" i "),n("span",{class:"token operator"},"<"),s(" count"),n("span",{class:"token punctuation"},";"),s(" i"),n("span",{class:"token operator"},"++"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"\xA1Dime el n\xFAmero "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("i "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},"!"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" titleCtx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"waitFor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'":text"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    movies`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"push"),n("span",{class:"token punctuation"},"("),s("titleCtx"),n("span",{class:"token punctuation"},"."),s("msg"),n("span",{class:"token punctuation"},"."),s("text"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Aqu\xED hay una mejor clasificaci\xF3n!"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  movies`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sort"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),s("movies"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("m"),n("span",{class:"token punctuation"},","),s(" i"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("i "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},". "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("m"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"join"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\\n"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),cn=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"movie"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xBFCu\xE1ntas pel\xEDculas favoritas tiene?"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" count "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),s("form"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"number"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" movies "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"let"),s(" i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(" i "),n("span",{class:"token operator"},"<"),s(" count"),n("span",{class:"token punctuation"},";"),s(" i"),n("span",{class:"token operator"},"++"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"\xA1Dime el n\xFAmero "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("i "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},"!"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" titleCtx "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"waitFor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'":text"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    movies`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"push"),n("span",{class:"token punctuation"},"("),s("titleCtx"),n("span",{class:"token punctuation"},"."),s("msg"),n("span",{class:"token punctuation"},"."),s("text"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Aqu\xED hay una mejor clasificaci\xF3n!"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  movies`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sort"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),s("movies"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("m"),n("span",{class:"token punctuation"},","),s(" i")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("i "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},". "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("m"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"join"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\\n"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),pn=n("p",null,"\xBFPuedes averiguar c\xF3mo funcionar\xE1 este bot?",-1),ln=n("h2",{id:"instalar-y-entrar-en-una-conversacion",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#instalar-y-entrar-en-una-conversacion","aria-hidden":"true"},"#"),s(" Instalar y entrar en una conversaci\xF3n")],-1),un=s("En primer lugar, "),rn=n("strong",null,"debes",-1),dn=s(" utilizar el "),kn=s("plugin de sesi\xF3n"),mn=s(" si quieres utilizar el plugin de conversaciones. Tambi\xE9n tienes que instalar el propio plugin de conversaciones, antes de poder registrar conversaciones individuales en tu bot."),vn=c(`<div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Instalar el plugin de sesi\xF3n.</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">initial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// devuelve un objeto vac\xEDo por ahora</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Instala el plugin de conversaciones.</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">conversations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A continuaci\xF3n, puedes instalar la funci\xF3n de construcci\xF3n de conversaci\xF3n como middleware en tu objeto bot envolvi\xE9ndola dentro de <code>create<wbr>Conversation</code>.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createConversation</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Ahora que tu conversaci\xF3n est\xE1 registrada en el bot, puedes entrar en la conversaci\xF3n desde cualquier manejador. Aseg\xFArate de usar <code>await</code> para todos los m\xE9todos en <code>ctx<wbr>.conversation</code>\u2014de lo contrario tu c\xF3digo se romper\xE1.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;greeting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tan pronto como el usuario env\xEDe <code>/start</code> al bot, la conversaci\xF3n ser\xE1 introducida. El objeto de contexto actual se pasa como segundo argumento a la funci\xF3n de construcci\xF3n de la conversaci\xF3n. Por ejemplo, si inicias tu conversaci\xF3n con <code>await ctx<wbr>.reply(ctx<wbr>.message<wbr>.text)</code>, contendr\xE1 la actualizaci\xF3n que contiene <code>/start</code>.</p><div class="custom-container tip"><p class="custom-container-title">Cambiar el identificador de la conversaci\xF3n</p><p>Por defecto, tienes que pasar el nombre de la funci\xF3n a <code>ctx<wbr>.conversation<wbr>.enter()</code>. Sin embargo, si prefieres utilizar un identificador diferente, puedes especificarlo as\xED</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createConversation</span><span class="token punctuation">(</span>greeting<span class="token punctuation">,</span> <span class="token string">&quot;new-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>A su vez, puedes entrar en la conversaci\xF3n con \xE9l:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;new-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>En total, tu c\xF3digo deber\xEDa tener ahora m\xE1s o menos este aspecto:</p>`,8),bn=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" Bot"),n("span",{class:"token punctuation"},","),s(" Context"),n("span",{class:"token punctuation"},","),s(" session "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"grammy"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"Conversation"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"ConversationFlavor"),n("span",{class:"token punctuation"},","),s(`
  conversations`),n("span",{class:"token punctuation"},","),s(`
  createConversation`),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"@grammyjs/conversations"'),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"MyContext"),s(),n("span",{class:"token operator"},"="),s(" Context "),n("span",{class:"token operator"},"&"),s(" ConversationFlavor"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"MyConversation"),s(),n("span",{class:"token operator"},"="),s(" Conversation"),n("span",{class:"token operator"},"<"),s("MyContext"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" bot "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},[s("Bot"),n("span",{class:"token operator"},"<"),s("MyContext"),n("span",{class:"token operator"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'""'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"session"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token function-variable function"},"initial"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"conversations"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token doc-comment comment"},"/** Define la conversaci\xF3n */"),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"greeting"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// TODO: codificar la conversaci\xF3n"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"createConversation"),n("span",{class:"token punctuation"},"("),s("greeting"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"command"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},'// introduce la funci\xF3n "saludo" que has declarado'),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),s("conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"enter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"greeting"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),gn=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" Bot"),n("span",{class:"token punctuation"},","),s(" Context"),n("span",{class:"token punctuation"},","),s(" session "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"grammy"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(`
  conversations`),n("span",{class:"token punctuation"},","),s(`
  createConversation`),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"@grammyjs/conversations"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" bot "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Bot"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'""'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"session"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token function-variable function"},"initial"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"conversations"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token doc-comment comment"},"/** Define la conversaci\xF3n */"),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"greeting"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// TODO: codificar la conversaci\xF3n"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"createConversation"),n("span",{class:"token punctuation"},"("),s("greeting"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"command"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"ctx"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},'// introduce la funci\xF3n "saludo" que has declarado'),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),s("conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"enter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"greeting"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),yn=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" Bot"),n("span",{class:"token punctuation"},","),s(" Context"),n("span",{class:"token punctuation"},","),s(" session "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"https://deno.land/x/grammy@v1.11.1/mod.ts"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"Conversation"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"ConversationFlavor"),n("span",{class:"token punctuation"},","),s(`
  conversations`),n("span",{class:"token punctuation"},","),s(`
  createConversation`),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"https://deno.land/x/grammy_conversations@v1.0.3/mod.ts"'),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"MyContext"),s(),n("span",{class:"token operator"},"="),s(" Context "),n("span",{class:"token operator"},"&"),s(" ConversationFlavor"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"type"),s(),n("span",{class:"token class-name"},"MyConversation"),s(),n("span",{class:"token operator"},"="),s(" Conversation"),n("span",{class:"token operator"},"<"),s("MyContext"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" bot "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},[s("Bot"),n("span",{class:"token operator"},"<"),s("MyContext"),n("span",{class:"token operator"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'""'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"session"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token function-variable function"},"initial"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"conversations"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token doc-comment comment"},"/** Define la conversaci\xF3n */"),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"greeting"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// TODO: codificar la conversaci\xF3n"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"createConversation"),n("span",{class:"token punctuation"},"("),s("greeting"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"command"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"start"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},'// introduce la funci\xF3n "saludo" que has declarado'),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),s("conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"enter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"greeting"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),fn=n("h2",{id:"salir-de-una-conversacion",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#salir-de-una-conversacion","aria-hidden":"true"},"#"),s(" Salir de una conversaci\xF3n")],-1),hn=n("p",null,[s("La conversaci\xF3n se ejecutar\xE1 hasta que su funci\xF3n de construcci\xF3n de conversaci\xF3n se complete. Esto significa que puedes simplemente dejar una conversaci\xF3n usando "),n("code",null,"return"),s(".")],-1),wn=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"hiAndBye"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Hola! \xA1Y adi\xF3s!"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token comment"},"// Deja la conversaci\xF3n:"),s(`
  `),n("span",{class:"token keyword"},"return"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_n=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"hiAndBye"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Hola! \xA1Y adi\xF3s!"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token comment"},"// Deja la conversaci\xF3n:"),s(`
  `),n("span",{class:"token keyword"},"return"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),xn=n("p",null,[s("(S\xED, poner un "),n("code",null,"return"),s(" al final de la funci\xF3n es un poco in\xFAtil, pero se entiende la idea).")],-1),qn=s("Tambi\xE9n puedes lanzar un error. Esto tambi\xE9n saldr\xE1 de la conversaci\xF3n. Recuerda "),jn=s("instalar un manejador de errores"),Cn=s(" en tu bot."),zn=n("p",null,[s("Si quieres acabar con la conversaci\xF3n mientras espera la entrada del usuario, tambi\xE9n puedes usar "),n("code",null,[s("await ctx"),n("wbr"),s(".conversation"),n("wbr"),s(".exit()")]),s(". A menudo es mejor quedarse con el simple retorno de la funci\xF3n, pero hay algunos ejemplos en los que el uso de "),n("code",null,[s("await ctx"),n("wbr"),s(".conversation"),n("wbr"),s(".exit()")]),s(" es conveniente. Recuerda que debes "),n("code",null,"esperar"),s(" la llamada.")],-1),Sn=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"movie"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// TODO: definir la conversaci\xF3n"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// Instalar el plugin de conversaciones."),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"conversations"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// Salir siempre de cualquier conversaci\xF3n tras /cancelar"),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"command"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"cancel"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Saliendo."'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),s("conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// Salir siempre de la conversaci\xF3n de la `movie` "),s(`
`),n("span",{class:"token comment"},"// cuando se pulsa el bot\xF3n de `cancel` del teclado en l\xEDnea."),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"callbackQuery"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"cancel"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"answerCallbackQuery"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Dejando la conversaci\xF3n"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),s("conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"movie"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"createConversation"),n("span",{class:"token punctuation"},"("),s("movie"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"command"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"movie"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" ctx"),n("span",{class:"token punctuation"},"."),s("conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"enter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"movie"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),En=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"movie"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// TODO: definir la conversaci\xF3n"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// Instalar el plugin de conversaciones."),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"conversations"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// Salir siempre de cualquier conversaci\xF3n tras /cancelar"),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"command"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"cancel"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"ctx"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Saliendo."'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),s("conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// Salir siempre de la conversaci\xF3n de la `movie` "),s(`
`),n("span",{class:"token comment"},"// cuando se pulsa el bot\xF3n de `cancel` del teclado en l\xEDnea."),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"callbackQuery"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"cancel"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"ctx"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"answerCallbackQuery"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Dejando la conversaci\xF3n"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),s("conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"movie"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"createConversation"),n("span",{class:"token punctuation"},"("),s("movie"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
bot`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"command"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"movie"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"ctx"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" ctx"),n("span",{class:"token punctuation"},"."),s("conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"enter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"movie"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Mn=n("p",null,[s("Tenga en cuenta que el orden es importante aqu\xED. Primero debes instalar el plugin de conversaciones (l\xEDnea 6) antes de poder llamar a "),n("code",null,[s("await ctx"),n("wbr"),s(".conversation"),n("wbr"),s(".exit()")]),s(". Adem\xE1s, los manejadores de cancelaci\xF3n gen\xE9ricos deben ser instalados antes de que las conversaciones reales (l\xEDnea 21) sean registradas.")],-1),An=n("h2",{id:"esperar-a-las-actualizaciones",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#esperar-a-las-actualizaciones","aria-hidden":"true"},"#"),s(" Esperar a las actualizaciones")],-1),Tn=n("p",null,[s("Puedes usar el manejador de conversaci\xF3n "),n("code",null,"conversation"),s(" para esperar la siguiente actualizaci\xF3n en este chat en particular.")],-1),Pn=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"waitForMe"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// Espere a la pr\xF3xima actualizaci\xF3n:"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" newContext "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"wait"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Fn=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"waitForMe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// Espere a la pr\xF3xima actualizaci\xF3n:"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" newContext "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"wait"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),In=s("Una actualizaci\xF3n puede significar que se ha enviado un mensaje de texto, o que se ha pulsado un bot\xF3n, o que se ha editado algo, o pr\xE1cticamente cualquier otra acci\xF3n realizada por el usuario. Consulta la lista completa en los documentos de Telegram "),Dn={href:"https://core.telegram.org/bots/api#update",target:"_blank",rel:"noopener noreferrer"},Bn=s("aqu\xED"),Jn=s("."),On=s("Normalmente, fuera del plugin de conversaciones, cada una de estas actualizaciones ser\xEDa manejada por el "),Ln=s("sistema de middleware"),Rn=s(" de tu bot. Por lo tanto, tu bot manejar\xEDa la actualizaci\xF3n a trav\xE9s de un objeto de contexto que se pasa a tus manejadores."),Gn=n("p",null,[s("En las conversaciones, obtendr\xE1 este nuevo objeto de contexto de la llamada "),n("code",null,"wait"),s(". A su vez, puedes manejar diferentes actualizaciones de manera diferente en base a este objeto. Por ejemplo, puedes comprobar si hay mensajes de texto:")],-1),Nn=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"waitForText"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// Espere a la pr\xF3xima actualizaci\xF3n:"),s(`
  ctx `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"wait"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token comment"},"// Comprueba el texto:"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},"."),s("message"),n("span",{class:"token operator"},"?."),s("text"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// ..."),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Vn=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"waitForText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// Espere a la pr\xF3xima actualizaci\xF3n:"),s(`
  ctx `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"wait"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token comment"},"// Comprueba el texto:"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},"."),s("message"),n("span",{class:"token operator"},"?."),s("text"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// ..."),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Hn=s("Adem\xE1s, existen otros m\xE9todos junto a "),Qn=n("code",null,"wait",-1),$n=s(" que permiten esperar s\xF3lo actualizaciones espec\xEDficas. Un ejemplo es "),Un=n("code",null,[s("wait"),n("wbr"),s("For")],-1),Yn=s(" que toma una "),Wn=s("consulta de filtro"),Kn=s(" y luego s\xF3lo espera las actualizaciones que coincidan con la consulta proporcionada. Esto es especialmente potente en combinaci\xF3n con "),Xn={href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment",target:"_blank",rel:"noopener noreferrer"},Zn=s("desestructuraci\xF3n de objetos"),ns=s(":"),ss=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"waitForText"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// Espere a la siguiente actualizaci\xF3n de los mensajes de texto:"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" msg"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(" text "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"waitFor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"message:text"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),as=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"waitForText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// Espere a la siguiente actualizaci\xF3n de los mensajes de texto:"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"msg"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(" text "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"waitFor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"message:text"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),es=s("Consulta la "),ts={href:"https://doc.deno.land/https://deno.land/x/grammy_conversations/mod.ts/~/ConversationHandle#wait",target:"_blank",rel:"noopener noreferrer"},os=s("referencia de la API"),cs=s(" para ver todos los m\xE9todos disponibles que son similares a "),is=n("code",null,"wait",-1),ps=s("."),ls=c(`<p>Veamos ahora c\xF3mo funcionan realmente las llamadas wait. Como se mencion\xF3 anteriormente, <strong>no hacen <em>literalmente</em> que tu bot espere</strong>, aunque podemos programar las conversaciones como si ese fuera el caso.</p><h2 id="tres-reglas-de-oro-de-las-conversaciones" tabindex="-1"><a class="header-anchor" href="#tres-reglas-de-oro-de-las-conversaciones" aria-hidden="true">#</a> Tres reglas de oro de las conversaciones</h2><p>Hay tres reglas que se aplican al c\xF3digo que escribes dentro de una funci\xF3n constructora de conversaciones. Debes seguirlas si quieres que tu c\xF3digo se comporte correctamente.</p><p>Despl\xE1zate <a href="#como-funciona">hacia abajo</a> si quieres saber m\xE1s sobre <em>por qu\xE9</em> se aplican estas reglas, y qu\xE9 hacen realmente las llamadas <code>wait</code> internamente.</p><h3 id="regla-i-todos-los-efectos-secundarios-deben-estar-envueltos" tabindex="-1"><a class="header-anchor" href="#regla-i-todos-los-efectos-secundarios-deben-estar-envueltos" aria-hidden="true">#</a> Regla I: Todos los efectos secundarios deben estar envueltos</h3><p>El c\xF3digo que depende de un sistema externo, como bases de datos, APIs, archivos u otros recursos que podr\xEDan cambiar de una ejecuci\xF3n a otra, debe ser envuelto en llamadas <code>conversation<wbr>.external()</code>.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// MAL</span>
<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">externalApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// BIEN</span>
<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">external</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">externalApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Esto incluye tanto la lectura de datos como la realizaci\xF3n de efectos secundarios (como la escritura en una base de datos).</p><div class="custom-container tip"><p class="custom-container-title">Comparable a React</p><p>Si est\xE1s familiarizado con React, puede que conozcas un concepto comparable de <code>use<wbr>Effect</code>.</p></div><h3 id="regla-ii-todo-comportamiento-aleatorio-debe-estar-envuelto" tabindex="-1"><a class="header-anchor" href="#regla-ii-todo-comportamiento-aleatorio-debe-estar-envuelto" aria-hidden="true">#</a> Regla II: Todo comportamiento aleatorio debe estar envuelto</h3><p>El c\xF3digo que depende de la aleatoriedad o del estado global que podr\xEDa cambiar, debe envolver todo el acceso a \xE9l en llamadas a <code>conversation<wbr>.external()</code>, o utilizar la funci\xF3n de conveniencia <code>conversation<wbr>.random()</code>.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// MAL</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* hace cosas */</span> <span class="token punctuation">}</span>
<span class="token comment">// BIEN</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>conversation<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* hace cosas */</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="regla-iii-usar-funciones-de-conveniencia" tabindex="-1"><a class="header-anchor" href="#regla-iii-usar-funciones-de-conveniencia" aria-hidden="true">#</a> Regla III: Usar funciones de conveniencia</h3><p>Hay un mont\xF3n de cosas instaladas en <code>conversaci\xF3n</code> que pueden ayudarte mucho. Tu c\xF3digo no se rompe exactamente si no las usas, pero puede ser lento o comportarse de forma confusa. Sin embargo, el usuario final puede no notar la diferencia.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Dormir a trav\xE9s de la conversaci\xF3n, mejora masiva del rendimiento</span>
<span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3 segundos</span>

<span class="token comment">// Depurar el registro a trav\xE9s de la conversaci\xF3n, no imprime registros confusos</span>
conversation<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hola, mundo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,15),us=s("Ten en cuenta que puedes hacer todo lo anterior a trav\xE9s de "),rs=n("code",null,[s("conversation"),n("wbr"),s(".external()")],-1),ds=s(", pero esto puede ser tedioso de escribir, as\xED que es m\xE1s f\xE1cil usar las funciones de conveniencia ("),ks={href:"https://doc.deno.land/https://deno.land/x/grammy_conversations/mod.ts/~/ConversationHandle#Methods",target:"_blank",rel:"noopener noreferrer"},ms=s("referencia de la API"),vs=s(")."),bs=c(`<h2 id="variables-bifurcaciones-y-bucles" tabindex="-1"><a class="header-anchor" href="#variables-bifurcaciones-y-bucles" aria-hidden="true">#</a> Variables, bifurcaciones y bucles</h2><p>Si sigues las tres reglas anteriores, eres completamente libre de usar el c\xF3digo que quieras. Ahora repasaremos algunos conceptos que ya conoces de programaci\xF3n, y mostraremos c\xF3mo se traducen en conversaciones limpias y legibles.</p><p>Imagina que todo el c\xF3digo de abajo est\xE1 escrito dentro de una funci\xF3n de construcci\xF3n de conversaci\xF3n.</p><p>Puedes declarar variables y hacer lo que quieras con ellas:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;\xA1Env\xEDame tus n\xFAmeros favoritos, separados por comas!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token string">&quot;message:text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> suma <span class="token operator">=</span> message<span class="token punctuation">.</span>texto
  <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;La suma de estos n\xFAmeros es: &quot;</span> <span class="token operator">+</span> suma<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>La ramificaci\xF3n tambi\xE9n funciona:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;\xA1Env\xEDame una foto!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token operator">?.</span>photo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;\xA1Eso no es una foto! \xA1Estoy fuera!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tambi\xE9n lo hacen los bucles:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">do</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;\xA1Env\xEDame una foto!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>message<span class="token operator">?.</span>text <span class="token operator">===</span> <span class="token string">&quot;/cancel&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;\xA1Cancelado, me voy!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>ctx<span class="token punctuation">.</span>message<span class="token operator">?.</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="funciones-y-recursion" tabindex="-1"><a class="header-anchor" href="#funciones-y-recursion" aria-hidden="true">#</a> Funciones y recursi\xF3n</h2><p>Tambi\xE9n puedes dividir tu c\xF3digo en varias funciones, y reutilizarlas. Por ejemplo, as\xED es como puedes definir un captcha reutilizable.</p>`,11),gs=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"captcha"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Demuestra que eres humano! \xBFCu\xE1l es la respuesta a todo?"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" message "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"wait"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"return"),s(" message"),n("span",{class:"token operator"},"?."),s("texto "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},'"42"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),ys=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"captcha"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Demuestra que eres humano! \xBFCu\xE1l es la respuesta a todo?"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" message "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"wait"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"return"),s(" message"),n("span",{class:"token operator"},"?."),s("texto "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},'"42"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),fs=n("p",null,[s("Devuelve "),n("code",null,"true"),s(" si el usuario puede pasar, y "),n("code",null,"false"),s(" en caso contrario. Ahora puedes usarlo en tu funci\xF3n principal del constructor de conversaci\xF3n as\xED:")],-1),hs=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"enterGroup"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" ok "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"captcha"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("ok"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Bienvenido!"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"banChatMember"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),ws=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"enterGroup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" ok "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"captcha"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("ok"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Bienvenido!"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"banChatMember"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_s=c('<p>Vea c\xF3mo la funci\xF3n captcha puede ser reutilizada en diferentes lugares de su c\xF3digo.</p><blockquote><p>Este sencillo ejemplo s\xF3lo pretende ilustrar c\xF3mo funcionan las funciones. En realidad, puede funcionar mal porque s\xF3lo espera una nueva actualizaci\xF3n del chat respectivo, pero sin verificar que realmente proviene del mismo usuario que se uni\xF3. Si quieres crear un captcha real, puedes usar <a href="#conversaciones-paralelas">conversaciones paralelas</a>.</p></blockquote><p>Si quieres, tambi\xE9n puedes dividir tu c\xF3digo en m\xE1s funciones, o usar recursi\xF3n, recursi\xF3n mutua, generadores, etc. (S\xF3lo aseg\xFArese de que todas las funciones siguen las <a href="#tres-reglas-de-oro-de-las-conversaciones">tres reglas</a>.</p><p>Naturalmente, tambi\xE9n puedes usar el manejo de errores en tus funciones. Las declaraciones regulares <code>try</code>/<code>catch</code> funcionan bien, tambi\xE9n en las funciones. Despu\xE9s de todo, las conversaciones son s\xF3lo JavaScript.</p><p>Si la funci\xF3n de conversaci\xF3n principal arroja un error, el error se propagar\xE1 m\xE1s all\xE1 en los [mecanismos de manejo de errores] (\u2026/guide/errors.md) de tu bot.</p><h2 id="modulos-y-clases" tabindex="-1"><a class="header-anchor" href="#modulos-y-clases" aria-hidden="true">#</a> M\xF3dulos y clases</h2><p>Naturalmente, puedes mover tus funciones a trav\xE9s de los m\xF3dulos. De esta manera, puedes definir algunas funciones en un archivo, <code>exportarlas</code>, y luego <code>importarlas</code> y usarlas en otro archivo.</p><p>Si quieres, tambi\xE9n puedes definir clases.</p>',8),xs=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Auth"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"public"),s(" token"),n("span",{class:"token operator"},"?"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"string"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"private"),s(" conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"authenticate"),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" link "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"getAuthLink"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// obtener el enlace de autentificaci\xF3n de su sistema"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),s(`
      `),n("span",{class:"token string"},'"Abre este enlace para obtener una ficha, y env\xEDamela: "'),s(),n("span",{class:"token operator"},"+"),s(" link"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    ctx `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"wait"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("token "),n("span",{class:"token operator"},"="),s(" ctx"),n("span",{class:"token punctuation"},"."),s("message"),n("span",{class:"token operator"},"?."),s("text"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"isAuthenticated"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"this"),s(),n("span",{class:"token keyword"},"is"),s(" Auth "),n("span",{class:"token operator"},"&"),s(),n("span",{class:"token punctuation"},"{"),s(" token"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"string"),s(),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("token "),n("span",{class:"token operator"},"!=="),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"askForToken"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" auth "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Auth"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" auth"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"authenticate"),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("auth"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isAuthenticated"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" token "),n("span",{class:"token operator"},"="),s(" auth"),n("span",{class:"token punctuation"},"."),s("token"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// haz cosas con el token"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),qs=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Auth"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"conversation"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("#conversation "),n("span",{class:"token operator"},"="),s(" conversation"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"authenticate"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"ctx"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" link "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"getAuthLink"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// obtener el enlace de autentificaci\xF3n de su sistema"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),s(`
      `),n("span",{class:"token string"},'"Abre este enlace para obtener una ficha, y env\xEDamela: "'),s(),n("span",{class:"token operator"},"+"),s(" link"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    ctx `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("#conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"wait"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("token "),n("span",{class:"token operator"},"="),s(" ctx"),n("span",{class:"token punctuation"},"."),s("message"),n("span",{class:"token operator"},"?."),s("text"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"isAuthenticated"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("token "),n("span",{class:"token operator"},"!=="),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"askForToken"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" auth "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Auth"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" auth"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"authenticate"),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("auth"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isAuthenticated"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" token "),n("span",{class:"token operator"},"="),s(" auth"),n("span",{class:"token punctuation"},"."),s("token"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// haz cosas con el token"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),js=c('<p>El punto aqu\xED no es tanto que recomendemos estrictamente hacer esto. Se trata m\xE1s bien de un ejemplo de c\xF3mo puede utilizar las infinitas flexibilidades de JavaScript para estructurar su c\xF3digo.</p><h2 id="formularios" tabindex="-1"><a class="header-anchor" href="#formularios" aria-hidden="true">#</a> Formularios</h2><p>Como se mencion\xF3 <a href="#esperar-a-las-actualizaciones">anteriormente</a>, hay varias funciones de utilidad diferentes en el manejador de la conversaci\xF3n, como <code>await conversation<wbr>.wait<wbr>For(&#39;message:<wbr>text&#39;)</code> que s\xF3lo devuelve las actualizaciones de los mensajes de texto.</p><p>Si estos m\xE9todos no son suficientes, el plugin de conversaciones proporciona a\xFAn m\xE1s funciones de ayuda para construir formularios a trav\xE9s de <code>conversation<wbr>.form</code>.</p>',4),Cs=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"waitForMe"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xBFQu\xE9 edad tienes?"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" age"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"number"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),s("form"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"number"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),zs=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"waitForMe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xBFQu\xE9 edad tienes?"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" age "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),s("form"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"number"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Ss=s("Como siempre, consulte la "),Es={href:"https://doc.deno.land/https://deno.land/x/grammy_conversations/mod.ts/~/ConversationForm",target:"_blank",rel:"noopener noreferrer"},Ms=s("referencia de la API"),As=s(" para ver qu\xE9 m\xE9todos est\xE1n disponibles."),Ts=c('<h2 id="conversaciones-paralelas" tabindex="-1"><a class="header-anchor" href="#conversaciones-paralelas" aria-hidden="true">#</a> Conversaciones paralelas</h2><p>Naturalmente, el plugin de conversaciones puede ejecutar cualquier n\xFAmero de conversaciones en paralelo en diferentes chats.</p><p>Sin embargo, si tu bot se a\xF1ade a un chat de grupo, puede querer tener conversaciones con varios usuarios diferentes en paralelo <em>en el mismo chat</em>. Por ejemplo, si tu bot tiene un captcha que quiere enviar a todos los nuevos miembros. Si dos miembros se unen al mismo tiempo, el bot deber\xEDa ser capaz de mantener dos conversaciones independientes con ellos.</p><p>Por eso el plugin de conversaciones permite introducir varias conversaciones al mismo tiempo para cada chat. Por ejemplo, es posible tener cinco conversaciones diferentes con cinco nuevos usuarios, y al mismo tiempo chatear con un administrador sobre la nueva configuraci\xF3n del chat.</p><h3 id="como-funciona-entre-bastidores" tabindex="-1"><a class="header-anchor" href="#como-funciona-entre-bastidores" aria-hidden="true">#</a> C\xF3mo funciona entre bastidores</h3><p>Cada actualizaci\xF3n entrante s\xF3lo ser\xE1 manejada por una de las conversaciones activas en un chat. Comparable a los manejadores de middleware, las conversaciones ser\xE1n llamadas en el orden en que son registradas. Si una conversaci\xF3n se inicia varias veces, estas instancias de la conversaci\xF3n ser\xE1n llamadas en orden cronol\xF3gico.</p><p>Cada conversaci\xF3n puede entonces manejar la actualizaci\xF3n, o puede llamar a <code>await conversation<wbr>.skip()</code>. En el primer caso, la actualizaci\xF3n simplemente se consumir\xE1 mientras la conversaci\xF3n la maneja. En el segundo caso, la conversaci\xF3n deshar\xE1 efectivamente la recepci\xF3n de la actualizaci\xF3n, y la pasar\xE1 a la siguiente conversaci\xF3n. Si todas las conversaciones omiten una actualizaci\xF3n, el flujo de control ser\xE1 devuelto al sistema de middleware, y ejecutar\xE1 cualquier manejador posterior.</p><p>Esto permite iniciar una nueva conversaci\xF3n desde el middleware regular.</p><h3 id="como-se-puede-utilizar" tabindex="-1"><a class="header-anchor" href="#como-se-puede-utilizar" aria-hidden="true">#</a> C\xF3mo se puede utilizar</h3><p>En la pr\xE1ctica, nunca necesitas llamar a <code>await conversation<wbr>.skip()</code> en absoluto. En su lugar, puedes usar cosas como <code>await conversation<wbr>.wait<wbr>From(user<wbr>Id)</code>, que se encargar\xE1 de los detalles por ti. Esto te permite chatear con un solo usuario en un chat de grupo.</p><p>Por ejemplo, vamos a implementar el ejemplo del captcha de aqu\xED arriba de nuevo, pero esta vez con conversaciones paralelas.</p>',11),Ps=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"captcha"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},"."),s("from "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Demuestra que eres humano! \xBFCu\xE1l es la respuesta a todo?"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" message "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"waitFrom"),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},"."),s("from"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"return"),s(" message"),n("span",{class:"token operator"},"?."),s("text "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},'"42"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"enterGroup"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token operator"},":"),s(" MyConversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token operator"},":"),s(" MyContext"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" ok "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"captcha"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("ok"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Bienvenido!"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"banChatMember"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Fs=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"captcha"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},"."),s("from "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Demuestra que eres humano! \xBFCu\xE1l es la respuesta a todo?"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" message "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(" conversation"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"waitFrom"),n("span",{class:"token punctuation"},"("),s("ctx"),n("span",{class:"token punctuation"},"."),s("from"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"return"),s(" message"),n("span",{class:"token operator"},"?."),s("text "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},'"42"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"enterGroup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" ok "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"captcha"),n("span",{class:"token punctuation"},"("),s("conversation"),n("span",{class:"token punctuation"},","),s(" ctx"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("ok"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"reply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"\xA1Bienvenido!"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token keyword"},"await"),s(" ctx"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"banChatMember"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"\xA0"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Is=c(`<p>Observa c\xF3mo s\xF3lo esperamos los mensajes de un usuario en particular.</p><p>Ahora podemos tener un simple manejador que entra en la conversaci\xF3n cuando un nuevo miembro se une.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;chat_member&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>chatMember<span class="token punctuation">.</span>old_chat_member<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;left&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>chatMember<span class="token punctuation">.</span>new_chat_member<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;member&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;enterGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="inspeccion-de-conversaciones-activas" tabindex="-1"><a class="header-anchor" href="#inspeccion-de-conversaciones-activas" aria-hidden="true">#</a> Inspecci\xF3n de conversaciones activas</h3><p>Puede ver cu\xE1ntas conversaciones con qu\xE9 identificador se est\xE1n ejecutando.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> stats <span class="token operator">=</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span>active<span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { &quot;enterGroup&quot;: 1 }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Esto se proporcionar\xE1 como un objeto que tiene los identificadores de conversaci\xF3n como claves, y un n\xFAmero que indica el n\xFAmero de conversaciones en curso para cada identificador.</p><h2 id="como-funciona" tabindex="-1"><a class="header-anchor" href="#como-funciona" aria-hidden="true">#</a> C\xF3mo funciona</h2><blockquote><p><a href="#tres-reglas-de-oro-de-las-conversaciones">Recuerda</a> que el c\xF3digo dentro de tus funciones de construcci\xF3n de conversaciones debe seguir tres reglas. Ahora vamos a ver <em>por qu\xE9</em> necesitas construirlas de esa manera.</p></blockquote><p>Primero vamos a ver c\xF3mo funciona este plugin conceptualmente, antes de elaborar algunos detalles.</p><h3 id="como-funcionan-las-llamadas-wait" tabindex="-1"><a class="header-anchor" href="#como-funcionan-las-llamadas-wait" aria-hidden="true">#</a> C\xF3mo funcionan las llamadas <code>wait</code></h3><p>Cambiemos de perspectiva por un momento, y hagamos una pregunta desde el punto de vista de un desarrollador de plugins. \xBFC\xF3mo implementar una llamada <code>wait</code> en el plugin?</p><p>El enfoque ingenuo para implementar una llamada <code>wait</code> en el plugin de conversaciones ser\xEDa crear una nueva promesa, y esperar hasta que llegue el siguiente objeto de contexto. Tan pronto como lo haga, resolvemos la promesa, y la conversaci\xF3n puede continuar.</p><p>Sin embargo, esto es una mala idea por varias razones.</p><p><strong>P\xE9rdida de datos.</strong> \xBFQu\xE9 pasa si tu servidor se cae mientras esperas un objeto de contexto? En ese caso, perdemos toda la informaci\xF3n sobre el estado de la conversaci\xF3n. B\xE1sicamente, el bot pierde su tren de pensamiento, y el usuario tiene que empezar de nuevo. Esto es un mal dise\xF1o y molesto.</p><p><strong>Bloqueo.</strong> Si las llamadas de espera se bloquean hasta que llega la siguiente actualizaci\xF3n, significa que la ejecuci\xF3n del middleware para la primera actualizaci\xF3n no puede completarse hasta que la conversaci\xF3n entera se complete.</p>`,16),Ds=n("li",null,"Para el sondeo incorporado, esto significa que no se pueden procesar m\xE1s actualizaciones hasta que la actual haya terminado. Por lo tanto, el bot simplemente se bloquear\xEDa para siempre.",-1),Bs=s("Para "),Js=s("grammY runner"),Os=s(", el bot no se bloquear\xEDa. Sin embargo, al procesar miles de conversaciones en paralelo con diferentes usuarios, consumir\xEDa cantidades potencialmente muy grandes de memoria. Si muchos usuarios dejan de responder, esto deja al bot atascado en medio de innumerables conversaciones."),Ls=s("Los webhooks tienen su propia "),Rs=s("categor\xEDa de problemas"),Gs=s(" con middleware de larga duraci\xF3n."),Ns=c(`<p><strong>Estado.</strong> En la infraestructura sin servidor, como las funciones en la nube, no podemos asumir que la misma instancia maneja dos actualizaciones posteriores del mismo usuario. Por lo tanto, si fu\xE9ramos a crear conversaciones con estado, podr\xEDan romperse aleatoriamente todo el tiempo, ya que algunas llamadas <code>wait</code> no se resuelven, pero alg\xFAn otro middleware se ejecuta de repente. El resultado es una abundancia de bugs aleatorios y caos.</p><p>Hay m\xE1s problemas, pero se entiende la idea.</p><p>En consecuencia, el plugin de conversaciones hace las cosas de forma diferente. Muy diferente.</p><p>El plugin de conversaciones rastrea la ejecuci\xF3n de su funci\xF3n. Cuando se alcanza una llamada de espera, serializa el estado de ejecuci\xF3n en la sesi\xF3n, y lo almacena de forma segura en una base de datos. Cuando llega la siguiente actualizaci\xF3n, primero inspecciona los datos de la sesi\xF3n. Si encuentra que lo dej\xF3 en medio de una conversaci\xF3n, deserializa el estado de ejecuci\xF3n, toma su funci\xF3n constructora de conversaci\xF3n y la reproduce hasta el punto de la \xFAltima llamada <code>wait</code>. A continuaci\xF3n, reanuda la ejecuci\xF3n ordinaria de tu funci\xF3n, hasta que se alcanza la siguiente llamada <code>wait</code>, y la ejecuci\xF3n debe ser detenida de nuevo.</p><p>\xBFQu\xE9 entendemos por estado de ejecuci\xF3n? En pocas palabras, consiste en tres cosas</p><ol><li>Las actualizaciones entrantes</li><li>Las llamadas salientes a la API</li><li>Eventos y efectos externos, como la aleatoriedad o las llamadas a APIs o bases de datos externas</li></ol><p>\xBFQu\xE9 entendemos por repetici\xF3n? Reproducir significa simplemente llamar a la funci\xF3n regularmente desde el principio, pero cuando hace cosas como llamar a <code>wait</code> o realizar llamadas a la API, en realidad no hacemos nada de eso. En su lugar, comprobamos o registramos de una ejecuci\xF3n anterior qu\xE9 valores fueron devueltos. A continuaci\xF3n, inyectamos estos valores para que la funci\xF3n de construcci\xF3n de la conversaci\xF3n simplemente se ejecute muy r\xE1pido - hasta que nuestros registros se agoten. En ese momento, cambiamos de nuevo al modo de ejecuci\xF3n normal, que es s\xF3lo una forma elegante de decir que dejamos de inyectar cosas, y empezamos a realizar realmente las llamadas a la API de nuevo.</p><p>Por eso el plugin tiene que hacer un seguimiento de todas las actualizaciones entrantes, as\xED como de todas las llamadas a la API de los bots. (V\xE9anse los puntos 1 y 2 anteriores). Sin embargo, el plugin no tiene control sobre los eventos externos, los efectos secundarios o la aleatoriedad. Por ejemplo, podr\xEDa esto:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// hacer una cosa</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// hacer otra cosa</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>En ese caso, al llamar a la funci\xF3n, puede que de repente se comporte de forma diferente cada vez, por lo que la reproducci\xF3n de la funci\xF3n se romper\xE1. Podr\xEDa funcionar aleatoriamente de forma diferente a la ejecuci\xF3n original. Por eso existe el punto 3, y hay que seguir las <a href="#tres-reglas-de-oro-de-las-conversaciones">Tres Reglas de Oro</a>.</p><h3 id="como-interceptar-la-ejecucion-de-una-funcion" tabindex="-1"><a class="header-anchor" href="#como-interceptar-la-ejecucion-de-una-funcion" aria-hidden="true">#</a> C\xF3mo interceptar la ejecuci\xF3n de una funci\xF3n</h3>`,11),Vs=s("Conceptualmente hablando, las palabras clave "),Hs=n("code",null,"async",-1),Qs=s(" y "),$s=n("code",null,"await",-1),Us=s(" nos dan el control sobre el lugar en el que el hilo es "),Ys={href:"https://en.wikipedia.org/wiki/Preemption_(computing)",target:"_blank",rel:"noopener noreferrer"},Ws=s("preempted"),Ks=s(". Por lo tanto, si alguien llama a la conversaci\xF3n "),Xs=n("code",null,[s("await"),n("wbr"),s(".wait()")],-1),Zs=s(", que es una funci\xF3n de nuestra biblioteca, se nos da el poder de adelantarnos a la ejecuci\xF3n."),na=c(`<p>Concretamente, la primitiva secreta del n\xFAcleo que nos permite interrumpir la ejecuci\xF3n de una funci\xF3n es una <code>Promise</code> que nunca se resuelve.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">never</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// BOOM</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Si esperas una promesa de este tipo en cualquier archivo JavaScript, tu tiempo de ejecuci\xF3n terminar\xE1 instant\xE1neamente. (Si\xE9ntase libre de pegar el c\xF3digo anterior en un archivo y probarlo).</p><p>Como obviamente no queremos matar el runtime de JS, tenemos que atrapar esto de nuevo. \xBFC\xF3mo lo har\xEDas? (Si\xE9ntase libre de revisar el c\xF3digo fuente del plugin si esto no es inmediatamente obvio para usted).</p><h2 id="resumen-del-plugin" tabindex="-1"><a class="header-anchor" href="#resumen-del-plugin" aria-hidden="true">#</a> Resumen del plugin</h2>`,5),sa=n("li",null,[s("Name: "),n("code",null,"conversations")],-1),aa=s("Source: "),ea={href:"https://github.com/grammyjs/conversations",target:"_blank",rel:"noopener noreferrer"},ta=s("https://"),oa=n("wbr",null,null,-1),ca=s("github"),ia=n("wbr",null,null,-1),pa=s(".com"),la=n("wbr",null,null,-1),ua=s("/grammyjs"),ra=n("wbr",null,null,-1),da=s("/conversations"),ka=s("Reference: "),ma={href:"https://doc.deno.land/https://deno.land/x/grammy_conversations/mod.ts",target:"_blank",rel:"noopener noreferrer"},va=c("https://<wbr>doc<wbr>.deno<wbr>.land<wbr>/https://<wbr>deno<wbr>.land<wbr>/x<wbr>/grammy<wbr>_conversations<wbr>/mod<wbr>.ts",23);function ba(ga,ya){const u=l("Tag"),r=l("TagGroup"),i=l("RouterLink"),t=l("CodeGroupItem"),o=l("CodeGroup"),p=l("ExternalLinkIcon");return k(),m("div",null,[b,a(r,null,{default:e(()=>[a(u,{type:"official",text:"OFICIAL"})]),_:1}),g,y,f,h,n("p",null,[w,a(i,{to:"/es/guide/middleware.html"},{default:e(()=>[_]),_:1}),x,a(i,{to:"/es/guide/context.html"},{default:e(()=>[q]),_:1}),j]),C,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[z]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[S]),_:1}),a(t,{title:"Deno"},{default:e(()=>[E]),_:1})]),_:1}),M,n("p",null,[A,T,P,F,a(i,{to:"/es/guide/context.html#customizing-the-context-object"},{default:e(()=>[I]),_:1}),D,B,J,a(i,{to:"/es/guide/context.html#additive-context-flavors"},{default:e(()=>[O]),_:1}),L,R,G]),n("p",null,[N,V,H,Q,$,U,n("a",Y,[W,a(p)]),K,X,Z,a(i,{to:"/es/guide/context.html#customizing-the-context-object"},{default:e(()=>[nn]),_:1}),sn,an,en]),tn,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[on]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[cn]),_:1})]),_:1}),pn,ln,n("p",null,[un,rn,dn,a(i,{to:"/es/plugins/session.html"},{default:e(()=>[kn]),_:1}),mn]),vn,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[bn]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[gn]),_:1}),a(t,{title:"Deno"},{default:e(()=>[yn]),_:1})]),_:1}),fn,hn,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[wn]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[_n]),_:1})]),_:1}),xn,n("p",null,[qn,a(i,{to:"/es/guide/errors.html"},{default:e(()=>[jn]),_:1}),Cn]),zn,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[Sn]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[En]),_:1})]),_:1}),Mn,An,Tn,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[Pn]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[Fn]),_:1})]),_:1}),n("p",null,[In,n("a",Dn,[Bn,a(p)]),Jn]),n("p",null,[On,a(i,{to:"/es/guide/middleware.html"},{default:e(()=>[Ln]),_:1}),Rn]),Gn,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[Nn]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[Vn]),_:1})]),_:1}),n("p",null,[Hn,Qn,$n,Un,Yn,a(i,{to:"/es/guide/filter-queries.html"},{default:e(()=>[Wn]),_:1}),Kn,n("a",Xn,[Zn,a(p)]),ns]),a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[ss]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[as]),_:1})]),_:1}),n("p",null,[es,n("a",ts,[os,a(p)]),cs,is,ps]),ls,n("p",null,[us,rs,ds,n("a",ks,[ms,a(p)]),vs]),bs,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[gs]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[ys]),_:1})]),_:1}),fs,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[hs]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[ws]),_:1})]),_:1}),_s,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[xs]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[qs]),_:1})]),_:1}),js,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[Cs]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[zs]),_:1})]),_:1}),n("p",null,[Ss,n("a",Es,[Ms,a(p)]),As]),Ts,a(o,null,{default:e(()=>[a(t,{title:"TypeScript",active:""},{default:e(()=>[Ps]),_:1}),a(t,{title:"JavaScript"},{default:e(()=>[Fs]),_:1})]),_:1}),Is,n("ul",null,[Ds,n("li",null,[Bs,a(i,{to:"/es/plugins/runner.html"},{default:e(()=>[Js]),_:1}),Os]),n("li",null,[Ls,a(i,{to:"/es/guide/deployment-types.html#terminar-las-solicitudes-de-webhooks-a-tiempo"},{default:e(()=>[Rs]),_:1}),Gs])]),Ns,n("p",null,[Vs,Hs,Qs,$s,Us,n("a",Ys,[Ws,a(p)]),Ks,Xs,Zs]),na,n("ul",null,[sa,n("li",null,[aa,n("a",ea,[ta,oa,ca,ia,pa,la,ua,ra,da,a(p)])]),n("li",null,[ka,n("a",ma,[va,a(p)])])])])}const ha=d(v,[["render",ba],["__file","conversations.html.vue"]]);export{ha as default};
