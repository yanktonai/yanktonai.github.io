import{_ as r,r as t,o as d,c as u,b as s,w as l,a as n,d as o,e as a}from"./app.34388d32.js";const h={},k=n("h1",{id:"hosting-deno-deploy",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#hosting-deno-deploy","aria-hidden":"true"},"#"),o(" Hosting: Deno Deploy")],-1),_=o("This guide tells you about the ways you can host your grammY bots on "),m={href:"https://deno.com/deploy",target:"_blank",rel:"noopener noreferrer"},b=o("Deno Deploy"),y=o("."),g=o("Please note that this guide is only for Deno users, and you need to have a "),f={href:"https://github.com",target:"_blank",rel:"noopener noreferrer"},v=o("Git"),w=n("wbr",null,null,-1),D=o("Hub"),q=o(" account for creating a "),x={href:"https://deno.com/deploy",target:"_blank",rel:"noopener noreferrer"},j=o("Deno Deploy"),T=o(" account."),C=n("p",null,"Deno Deploy is ideal for most simple bots, and you should note that not all Deno features are available for apps running on Deno Deploy. For example, there is no file system on Deno Deploy. It\u2019s just like the other many serverless platforms, but dedicated for Deno apps.",-1),R=o("The result of this tutorial "),L={href:"https://github.com/grammyjs/examples/tree/main/deno-deploy",target:"_blank",rel:"noopener noreferrer"},G=o("can be seen in our example bots repository"),I=o("."),U=n("h2",{id:"preparing-your-code",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#preparing-your-code","aria-hidden":"true"},"#"),o(" Preparing Your Code")],-1),H=o("Remember that you need to "),N=o("run your bot on webhooks"),P=o(", so you should use "),E=n("code",null,[o("webhook"),n("wbr"),o("Callback")],-1),V=o(" and not call "),A=n("code",null,[o("bot"),n("wbr"),o(".start()")],-1),B=o(" in your code."),M=a(`<ol><li>Make sure that you have a file which exports your <code>Bot</code> object, so that you can import it later to run it.</li><li>Create a file named <code>mod<wbr>.ts</code> or <code>mod<wbr>.js</code>, or actually any name you like (but you should be remembering and using this as the main file to deploy), with the following content:</li></ol><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> serve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://deno.land/std@0.158.0/http/server.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> webhookCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://deno.land/x/grammy@v1.11.1/mod.ts&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// You might modify this to the correct way to import your \`Bot\` object.</span>
<span class="token keyword">import</span> bot <span class="token keyword">from</span> <span class="token string">&quot;./bot.ts&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> handleUpdate <span class="token operator">=</span> <span class="token function">webhookCallback</span><span class="token punctuation">(</span>bot<span class="token punctuation">,</span> <span class="token string">&quot;std/http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">serve</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> bot<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">handleUpdate</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We advise you to have your handler on some secret path rather than the root (<code>/</code>). Here, we are using the bot token (<code>/&lt;bot token&gt;</code>).</p><h2 id="deploying" tabindex="-1"><a class="header-anchor" href="#deploying" aria-hidden="true">#</a> Deploying</h2><h3 id="method-1-with-github" tabindex="-1"><a class="header-anchor" href="#method-1-with-github" aria-hidden="true">#</a> Method 1: With GitHub</h3><blockquote><p>This is the recommended method, and the easiest one to go with. The main advantage of following this method is that Deno Deploy will watch for changes in your repository which includes your bot code, and it will deploy new versions automatically.</p></blockquote><ol><li>Create a repository on GitHub, it can be either private or public.</li><li>Push your code.</li></ol><blockquote><p>It is recommended that you have a single stable branch and you do your testing stuff in other branches, so that you won\u2019t get some unexpected things happen.</p></blockquote>`,8),W={start:"3"},Y=o("Visit your "),S={href:"https://dash.deno.com/projects",target:"_blank",rel:"noopener noreferrer"},z=o("Deno Deploy dashboard"),F=o("."),O=n("li",null,"Click on \u201CNew Project\u201D, and go to the \u201CDeploy from GitHub repository\u201D section.",-1),J=n("li",null,"Install the GitHub app on your account or organization, and choose your repository.",-1),K=n("li",null,[o("Select the branch you want to deploy, and then choose your "),n("code",null,[o("mod"),n("wbr"),o(".ts")]),o(" file to be deployed.")],-1),Q=n("h3",{id:"method-2-with-deployctl",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#method-2-with-deployctl","aria-hidden":"true"},"#"),o(" Method 2: With "),n("code",null,"deployctl")],-1),X=n("blockquote",null,[n("p",null,"This is a method for more advanced users. It allows you to deploy the project via the command line or Github Actions.")],-1),Z=o("Visit your "),$={href:"https://dash.deno.com/projects",target:"_blank",rel:"noopener noreferrer"},nn=o("Deno Deploy dashboard"),on=o("."),sn=n("li",null,"Click \u201CNew Project\u201D, and then \u201CEmpty Project\u201D.",-1),en=o("Install "),tn={href:"https://github.com/denoland/deployctl",target:"_blank",rel:"noopener noreferrer"},an=n("code",null,"deployctl",-1),ln=o("."),pn={href:"https://dash.deno.com/user/access-tokens",target:"_blank",rel:"noopener noreferrer"},cn=o("Create an access token"),rn=o("."),dn=n("li",null,"Run the following command:",-1),un=a(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>deployctl deploy <span class="token parameter variable">--project</span> <span class="token operator">&lt;</span>project<span class="token operator">&gt;</span> ./mod.ts <span class="token parameter variable">--prod</span> <span class="token parameter variable">--token</span> <span class="token operator">&lt;</span>token<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1),hn={start:"6"},kn=o("To set up Github Actions, refer to "),_n={href:"https://github.com/denoland/deployctl/blob/main/action/README.md",target:"_blank",rel:"noopener noreferrer"},mn=o("this"),bn=o("."),yn=a(`<h3 id="method-3-with-url" tabindex="-1"><a class="header-anchor" href="#method-3-with-url" aria-hidden="true">#</a> Method 3: With URL</h3><blockquote><p>All you need for following this method to deploy your grammY bot, is a public URL to your <code>mod<wbr>.ts</code> file.</p></blockquote><ol><li>Create a new project on Deno Deploy.</li><li>Click \u201CDeploy URL\u201D.</li><li>Input the public URL to your <code>mod<wbr>.ts</code> file, and click \u201CDeploy\u201D.</li></ol><h3 id="note" tabindex="-1"><a class="header-anchor" href="#note" aria-hidden="true">#</a> Note</h3><p>After getting your app running, you should configure your bot\u2019s webhook settings to point to your app. To do that, send a request to</p><div class="language-markdown ext-md"><pre class="language-markdown"><code>https://api.telegram.org/bot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>token</span><span class="token punctuation">&gt;</span></span>/setWebhook?url=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>replacing <code>&lt;token&gt;</code> with your bot\u2019s token, and <code>&lt;url&gt;</code> with the full URL of your app along with the path to the webhook handler.</p>`,7);function gn(fn,vn){const p=t("Tag"),c=t("TagGroup"),e=t("ExternalLinkIcon"),i=t("RouterLink");return d(),u("div",null,[k,s(c,null,{default:l(()=>[s(p,{type:"deno",desc:"This setup is able to run Deno bots"})]),_:1}),n("p",null,[_,n("a",m,[b,s(e)]),y]),n("p",null,[g,n("a",f,[v,w,D,s(e)]),q,n("a",x,[j,s(e)]),T]),C,n("p",null,[R,n("a",L,[G,s(e)]),I]),U,n("blockquote",null,[n("p",null,[H,s(i,{to:"/guide/deployment-types.html#how-to-use-webhooks"},{default:l(()=>[N]),_:1}),P,E,V,A,B])]),M,n("ol",W,[n("li",null,[Y,n("a",S,[z,s(e)]),F]),O,J,K]),Q,X,n("ol",null,[n("li",null,[Z,n("a",$,[nn,s(e)]),on]),sn,n("li",null,[en,n("a",tn,[an,s(e)]),ln]),n("li",null,[n("a",pn,[cn,s(e)]),rn]),dn]),un,n("ol",hn,[n("li",null,[kn,n("a",_n,[mn,s(e)]),bn])]),yn])}const Dn=r(h,[["render",gn],["__file","deno-deploy.html.vue"]]);export{Dn as default};
