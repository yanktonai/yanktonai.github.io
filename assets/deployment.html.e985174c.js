import{_ as l,r as i,o as a,c as d,a as o,b as t,w as n,d as e}from"./app.81c9d145.js";const h={},_=o("h1",{id:"deployment-checklist",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#deployment-checklist","aria-hidden":"true"},"#"),e(" Deployment Checklist")],-1),c=o("p",null,"Here is a list of things that you may want to keep in mind when hosting a large bot.",-1),u=o("blockquote",null,[o("p",null,[e("You may also be interested in our guides for hosting a bot. Check out "),o("strong",null,"Hosting / Tutorials"),e(" at the top of the page to see some of the platforms that already have dedicated guides.")])],-1),m=o("h2",{id:"errors",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#errors","aria-hidden":"true"},"#"),e(" Errors")],-1),g=e("Install an error handler with "),p=o("code",null,[e("bot"),o("wbr"),e(".catch")],-1),f=e(" (long polling) or on your web framework (webhooks)."),b=o("li",null,[e("Use "),o("code",null,"await"),e(" on all promises and install "),o("strong",null,"linting"),e(", with rules that enforce this, so that you never forget.")],-1),y=o("h2",{id:"message-sending",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#message-sending","aria-hidden":"true"},"#"),e(" Message Sending")],-1),w=e("Send files by path or "),k=o("code",null,"Buffer",-1),v=e(" instead of by stream, or at least make sure you "),x=e("know the pitfalls"),C=e("."),T=e("Use "),U=o("code",null,[e("bot"),o("wbr"),e('.on("callback'),o("wbr"),e("_query:"),o("wbr"),e('data")')],-1),I=e(" as the fallback handler to "),q=e("react to all callback queries"),S=e("."),P=e("Use the "),B=o("code",null,[e("transformer"),o("wbr"),e("-throttler")],-1),A=e(" plugin"),L=e(" to avoid hitting rate limits."),M=o("strong",null,"Optional.",-1),z=e(" Consider using the "),E=o("code",null,[e("auto"),o("wbr"),e("-retry")],-1),W=e(" plugin"),Y=e(" to automatically handle flood wait errors."),j=o("h2",{id:"scaling",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#scaling","aria-hidden":"true"},"#"),e(" Scaling")],-1),N=o("p",null,"This depends on your deployment type.",-1),V=o("h3",{id:"long-polling",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#long-polling","aria-hidden":"true"},"#"),e(" Long Polling")],-1),D=e("Use grammY runner"),H=o("wbr",null,null,-1),R=e("."),F=e("Use "),G=o("code",null,"sequentialize",-1),K=e(" with the same session key resolver function as your session middleware."),O=e("Go through the configuration options of "),J=o("code",null,"run",-1),Q=e(" ("),X={href:"https://doc.deno.land/https://deno.land/x/grammy_runner/mod.ts/~/run",target:"_blank",rel:"noopener noreferrer"},Z=e("API reference"),$=e(") and make sure they fit your needs, or even consider composing your own runner out of "),ee={href:"https://doc.deno.land/https://deno.land/x/grammy_runner/mod.ts/~/UpdateSource",target:"_blank",rel:"noopener noreferrer"},oe=e("sources"),te=e(" and "),se={href:"https://doc.deno.land/https://deno.land/x/grammy_runner/mod.ts/~/UpdateSink",target:"_blank",rel:"noopener noreferrer"},ne=e("sinks"),re=e(". The main thing to consider is the maximum load you want to apply to your server, i.e. how many updates may be processed at the same time."),ie=e("Consider implementing "),le=e("graceful shutdown"),ae=e(" in order to stop your bot when you want to terminate it (i.e. to switch to a new version)."),de=o("h3",{id:"webhooks",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#webhooks","aria-hidden":"true"},"#"),e(" Webhooks")],-1),he=e("Make sure you do not perform any long-running operations in your middleware, such as large file transfers. "),_e=e("This leads to timeout errors"),ce=e(" for the webhooks, and duplicate update processing as Telegram will re-send non-acknowledged updates. Consider using a task queuing system instead."),ue=e("Make yourself familiar with the configuration of "),me=o("code",null,[e("webhook"),o("wbr"),e("Callback")],-1),ge=e(" ("),pe={href:"https://doc.deno.land/https://deno.land/x/grammy/mod.ts/~/webhookCallback",target:"_blank",rel:"noopener noreferrer"},fe=e("API reference"),be=e(")."),ye=e("If you adjusted the "),we=o("code",null,[e("get"),o("wbr"),e("Session"),o("wbr"),e("Key")],-1),ke=e(" option for your session, "),ve=e("use "),xe=o("code",null,"sequentialize",-1),Ce=e(" with the same session key resolver function as your session middleware"),Te=e("."),Ue=e("If you are running on a serverless or autoscaling platform, "),Ie={href:"https://doc.deno.land/https://deno.land/x/grammy/mod.ts/~/BotConfig",target:"_blank",rel:"noopener noreferrer"},qe=e("set the bot information"),Se=e(" to prevent excessive "),Pe=o("code",null,[e("get"),o("wbr"),e("Me")],-1),Be=e(" calls."),Ae=e("Consider using "),Le=e("webhook replies"),Me=e("."),ze=o("h2",{id:"sessions",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#sessions","aria-hidden":"true"},"#"),e(" Sessions")],-1),Ee=e("Consider using "),We=o("code",null,[e("lazy"),o("wbr"),e("Sessions")],-1),Ye=e(" as explained "),je=e("here"),Ne=e("."),Ve=o("li",null,[e("Use the "),o("code",null,"storage"),e(" option to set your storage adapter, otherwise all data will be lost when the bot process stops.")],-1),De=o("h2",{id:"testing",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#testing","aria-hidden":"true"},"#"),e(" Testing")],-1),He=o("p",null,"Write tests for your bot. This can be done with grammY like so:",-1),Re=e("Mock outgoing API requests using "),Fe=e("transformer functions"),Ge=e("."),Ke=e("Define and send sample update objects to your bot via "),Oe=o("code",null,[e("bot"),o("wbr"),e(".handle"),o("wbr"),e("Update")],-1),Je=e(" ("),Qe={href:"https://doc.deno.land/https://deno.land/x/grammy/mod.ts/~/Bot#handleUpdate",target:"_blank",rel:"noopener noreferrer"},Xe=e("API reference"),Ze=e("). Consider to take some inspiration from "),$e={href:"https://core.telegram.org/bots/webhooks#testing-your-bot-with-updates",target:"_blank",rel:"noopener noreferrer"},eo=e("these update objects"),oo=e(" provided by the Telegram team."),to={class:"custom-container tip"},so=o("p",{class:"custom-container-title"},"Contribute a Testing Framework",-1),no=o("p",null,"While grammY provides the necessary hooks to start writing tests, it would be very helpful to have a testing framework for bots. This is novel territory, such testing frameworks largely do not exist. We look forward to your contributions!",-1),ro=e("An example on how tests could be done "),io={href:"https://github.com/PavelPolyakov/grammy-with-tests",target:"_blank",rel:"noopener noreferrer"},lo=e("can be found here"),ao=e(".");function ho(_o,co){const s=i("RouterLink"),r=i("ExternalLinkIcon");return a(),d("div",null,[_,c,u,m,o("ol",null,[o("li",null,[t(s,{to:"/guide/errors.html"},{default:n(()=>[g,p,f]),_:1})]),b]),y,o("ol",null,[o("li",null,[w,k,v,t(s,{to:"/advanced/transformers.html#use-cases-of-transformer-functions"},{default:n(()=>[x]),_:1}),C]),o("li",null,[T,U,I,t(s,{to:"/plugins/keyboard.html#responding-to-clicks"},{default:n(()=>[q]),_:1}),S]),o("li",null,[P,t(s,{to:"/plugins/transformer-throttler.html"},{default:n(()=>[B,A]),_:1}),L]),o("li",null,[M,z,t(s,{to:"/plugins/auto-retry.html"},{default:n(()=>[E,W]),_:1}),Y])]),j,N,V,o("ol",null,[o("li",null,[t(s,{to:"/plugins/runner.html"},{default:n(()=>[D,H,R]),_:1})]),o("li",null,[t(s,{to:"/advanced/scaling.html#concurrency-is-hard"},{default:n(()=>[F,G,K]),_:1})]),o("li",null,[O,J,Q,o("a",X,[Z,t(r)]),$,o("a",ee,[oe,t(r)]),te,o("a",se,[ne,t(r)]),re]),o("li",null,[ie,t(s,{to:"/advanced/reliability.html#graceful-shutdown"},{default:n(()=>[le]),_:1}),ae])]),de,o("ol",null,[o("li",null,[he,t(s,{to:"/guide/deployment-types.html#ending-webhook-requests-in-time"},{default:n(()=>[_e]),_:1}),ce]),o("li",null,[ue,me,ge,o("a",pe,[fe,t(r)]),be]),o("li",null,[ye,we,ke,t(s,{to:"/advanced/scaling.html#concurrency-is-hard"},{default:n(()=>[ve,xe,Ce]),_:1}),Te]),o("li",null,[Ue,o("a",Ie,[qe,t(r)]),Se,Pe,Be]),o("li",null,[Ae,t(s,{to:"/guide/deployment-types.html#webhook-reply"},{default:n(()=>[Le]),_:1}),Me])]),ze,o("ol",null,[o("li",null,[Ee,We,Ye,t(s,{to:"/plugins/session.html#lazy-sessions"},{default:n(()=>[je]),_:1}),Ne]),Ve]),De,He,o("ol",null,[o("li",null,[Re,t(s,{to:"/advanced/transformers.html"},{default:n(()=>[Fe]),_:1}),Ge]),o("li",null,[Ke,Oe,Je,o("a",Qe,[Xe,t(r)]),Ze,o("a",$e,[eo,t(r)]),oo])]),o("div",to,[so,no,o("p",null,[ro,o("a",io,[lo,t(r)]),ao])])])}const mo=l(h,[["render",ho],["__file","deployment.html.vue"]]);export{mo as default};
