import{_ as c,r as i,o as u,c as l,a,b as s,w as t,d as n,e as o}from"./app.1137d7ac.js";const r={},d=a("h1",{id:"transformer-api-bot",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#transformer-api-bot","aria-hidden":"true"},"#"),n(" Transformer API Bot")],-1),m=a("p",null,"Middleware adalah sebuah function yang menangani sebuah object context, misalnya data yang masuk.",-1),k=a("p",null,[n("grammY juga menyediakan kebalikannya. "),a("em",null,"Function transformer"),n(" adalah sebuah function yang menangani data yang keluar, contohnya:")],-1),g=a("ul",null,[a("li",null,"Pemanggilan method API Bot, serta"),a("li",null,"Object payload yang cocok dengan suatu method tertentu.")],-1),b=n("Alih-alih memasukkan "),h=a("code",null,"next",-1),v=n(" sebagai argument terakhir untuk memanggil middleware hilir (downstream), kamu akan menerima "),f=a("code",null,"prev",-1),_=n(" sebagai argument pertama untuk memanfaatkan function transformer hulu (upstream). Kalau dilihat dari "),y=a("em",null,"type signature",-1),x=n("-nya "),w=a("code",null,"Transformer",-1),j=n(" ("),P={href:"https://doc.deno.land/https://deno.land/x/grammy/mod.ts/~/Transformer",target:"_blank",rel:"noopener noreferrer"},A=n("referensi API grammY"),I=n("), kita bisa melihat bagaimana ia diimplentasikan. Perlu diketahui bahwa "),q=a("code",null,[n("Payload<M"),a("wbr"),n(", R>")],-1),F=n(" merujuk ke object payload yang akan dicocokkan dengan method yang diberikan, serta "),M=a("code",null,[n("Api"),a("wbr"),n("Response<Api"),a("wbr"),n("Call"),a("wbr"),n("Result<M"),a("wbr"),n(", R>>")],-1),B=n(" adalah type pengembalian dari method yang dipanggil."),C=o(`<p>Function transformer yang terakhir dipanggil adalah pemanggilan bawaan yang melakukan beberapa hal seperti <em>JSON serialization</em> untuk field tertentu dan terkadang juga memanggil <code>fetch</code>.</p><p>Function transformer tidak memiliki sebuah class yang setara dengan <code>Composer</code>. Tetapi, jika kamu membutuhkannya, kamu bisa membuatnya sendiri. Kami siap menerima pull request-mu! \u{1F609}</p><h2 id="memasang-function-transformer" tabindex="-1"><a class="header-anchor" href="#memasang-function-transformer" aria-hidden="true">#</a> Memasang Function Transformer</h2><p>Function Transformer bisa dipasang di <code>bot<wbr>.api</code>. Berikut contoh function transformer yang tidak melakukan apapun:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Meneruskan ke function transformer</span>
bot<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> method<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> signal<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">prev</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> signal<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Perbandingan jika diteruskan ke middleware</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Berikut contoh function transformer yang mencegah semua pemanggilan API:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Mengembalikan undefined alih-alih type object yang bersangkutan.</span>
bot<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> method<span class="token punctuation">,</span> payload<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">undefined</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Kamu juga bisa memasang function transformer di object API milik object context. Function transformer hanya akan digunakan sementara untuk request API yang dilakukan di object context tersebut, sehingga pemanggilan <code>bot<wbr>.api</code> tidak terpengaruh. Pemanggilan melalui object context dari middleware yang berjalan secara bersamaan (concurrent) juga tidak terpengaruh. Segera setelah middleware yang bersangkutan selesai, function transformer tersebut langsung dibuang.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Pasang di semua object context yang memproses pesan.</span>
  ctx<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> method<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> signal<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token function">prev</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> signal<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Parameter <code>signal</code> harus selalu diteruskan ke <code>prev</code>. Ia diperlukan untuk membatalkan request serta menjaga agar <code>bot<wbr>.stop</code> bekerja dengan baik.</p></blockquote><p>Function transformer yang dipasang di <code>bot<wbr>.api</code> juga akan terpasang di setiap object <code>ctx<wbr>.api</code>. Sehingga, pemanggilan <code>ctx<wbr>.api</code> akan ditransformasikan oleh kedua transformer baik di <code>ctx<wbr>.api</code> maupun di <code>bot<wbr>.api</code>.</p><h2 id="penggunaan-function-transformer" tabindex="-1"><a class="header-anchor" href="#penggunaan-function-transformer" aria-hidden="true">#</a> Penggunaan Function Transformer</h2><p>Function transformer sama fleksibelnya dengan middleware, serta penerapannya pun juga beragam.</p>`,13),S=n("Sebagai contoh, "),T=n("plugin menu grammY"),N=n(" menggunakan sebuah function transformer untuk mengubah output instance menu menjadi payload yang sesuai. Kamu juga bisa bisa menggunakannya untuk:"),R=n("Mengimplementasikan "),Y=n("pengaturan flood"),K=n(","),L=a("li",null,[a("em",null,"Mock"),n(" request API selama pengetesan,")],-1),V=n("Mengatur "),E=n("perilaku retry"),G=n(","),O=a("li",null,"Dan lain-lain.",-1),D=o('<p>Namun, perlu diperhatikan bahwa mengulang kembali (retry) pemanggilan API bisa memiliki efek samping yang aneh, contohnya disaat kamu memanggil <code>send<wbr>Document</code> dan meneruskan instance stream ke <code>Input<wbr>File</code>, maka stream akan dibaca saat pertama kali request dicoba. Jika kamu memanggil <code>prev</code> lagi, stream tersebut mungkin sudah (sebagian) terpakai, sehingga file menjadi rusak. Oleh karena itu, cara yang lebih baik adalah dengan meneruskan path file ke <code>Input<wbr>File</code>, sehingga grammY bisa membuat ulang stream jika diperlukan.</p><h2 id="menggunakan-api-flavor" tabindex="-1"><a class="header-anchor" href="#menggunakan-api-flavor" aria-hidden="true">#</a> Menggunakan API Flavor</h2>',2),J=n("grammY memiliki fitur "),z=n("context flavor"),H=o(" yang bisa digunakan untuk mengatur type context. Flavor juga bisa digunakan di method API, baik yang secara langsung ada di object context seperti <code>ctx<wbr>.reply</code> maupun semua method di <code>ctx<wbr>.api</code> dan <code>ctx<wbr>.api<wbr>.raw</code>. Tetapi, kamu tidak bisa mengatur type <code>bot<wbr>.api</code> dan <code>bot<wbr>.api<wbr>.raw</code> melalui context flavor.",11),Q=o(`<p>Itulah kenapa grammY mendukung <em>API flavor</em>. Ia dapat menyelesaikan permasalahan berikut:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Api<span class="token punctuation">,</span> Bot<span class="token punctuation">,</span> Context <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;grammy&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SomeApiFlavor<span class="token punctuation">,</span> SomeContextFlavor<span class="token punctuation">,</span> somePlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;myPlugin&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Buat Context flavor.</span>
<span class="token keyword">type</span> <span class="token class-name">MyContext</span> <span class="token operator">=</span> Context <span class="token operator">&amp;</span> SomeContextFlavor<span class="token punctuation">;</span>
<span class="token comment">// Buat API flavor.</span>
<span class="token keyword">type</span> <span class="token class-name">MyApi</span> <span class="token operator">=</span> Api <span class="token operator">&amp;</span> SomeApiFlavor<span class="token punctuation">;</span>

<span class="token comment">// Gunakan kedua flavor.</span>
<span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bot<span class="token operator">&lt;</span>MyContext<span class="token punctuation">,</span> MyApi<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;my-token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Gunakan sebuah plugin.</span>
bot<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">somePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sekarang panggil \`bot.api\` dengan type yang sudah disesuaikan dari API flavor.</span>
bot<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">somePluginMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Gunakan juga type yang sudah disesuaikan dari context flavor.</span>
bot<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">somePluginMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),U=n("API flavor berjalan sama persis seperti context flavor. Baik jenis "),W=a("em",null,"additive",-1),X=n(" maupun "),Z=a("em",null,"transformative",-1),$=n(" juga tersedia, dan berbagai macam API flavor juga bisa dikombinasikan sama halnya dengan yang kamu lakukan dengan context flavor. Kalau kamu belum paham bagaimana cara menggunakannya, baca kembali "),nn=n("materi tentang context flavor"),an=n(".");function sn(en,tn){const p=i("ExternalLinkIcon"),e=i("RouterLink");return u(),l("div",null,[d,m,k,g,a("p",null,[b,h,v,f,_,y,x,w,j,a("a",P,[A,s(p)]),I,q,F,M,B]),C,a("p",null,[S,s(e,{to:"/id/plugins/menu.html"},{default:t(()=>[T]),_:1}),N]),a("ul",null,[a("li",null,[R,s(e,{to:"/id/plugins/transformer-throttler.html"},{default:t(()=>[Y]),_:1}),K]),L,a("li",null,[V,s(e,{to:"/id/plugins/auto-retry.html"},{default:t(()=>[E]),_:1}),G]),O]),D,a("p",null,[J,s(e,{to:"/id/guide/context.html#context-flavor"},{default:t(()=>[z]),_:1}),H]),Q,a("p",null,[U,W,X,Z,$,s(e,{to:"/id/guide/context.html#context-flavor"},{default:t(()=>[nn]),_:1}),an])])}const pn=c(r,[["render",sn],["__file","transformers.html.vue"]]);export{pn as default};
