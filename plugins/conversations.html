<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Conversations (conversations) | grammY</title><meta name="description" content="The Telegram Bot Framework.">
    <link rel="modulepreload" href="/assets/app.34388d32.js"><link rel="modulepreload" href="/assets/conversations.html.79800f29.js"><link rel="modulepreload" href="/assets/conversations.html.542d4ede.js"><link rel="prefetch" href="/assets/index.html.0429b483.js"><link rel="prefetch" href="/assets/index.html.2401d292.js"><link rel="prefetch" href="/assets/deployment.html.820945fa.js"><link rel="prefetch" href="/assets/flood.html.064205fe.js"><link rel="prefetch" href="/assets/middleware.html.992dcb0e.js"><link rel="prefetch" href="/assets/proxy.html.c404e72a.js"><link rel="prefetch" href="/assets/reliability.html.5a572dfa.js"><link rel="prefetch" href="/assets/scaling.html.fe634161.js"><link rel="prefetch" href="/assets/structuring.html.1e8ebd48.js"><link rel="prefetch" href="/assets/transformers.html.3e1cae77.js"><link rel="prefetch" href="/assets/index.html.e45b3ea7.js"><link rel="prefetch" href="/assets/index.html.fb39b504.js"><link rel="prefetch" href="/assets/examples.html.4b7b6125.js"><link rel="prefetch" href="/assets/index.html.172886ab.js"><link rel="prefetch" href="/assets/api.html.d34afc0f.js"><link rel="prefetch" href="/assets/basics.html.65923044.js"><link rel="prefetch" href="/assets/commands.html.c2610c77.js"><link rel="prefetch" href="/assets/context.html.d7289dc7.js"><link rel="prefetch" href="/assets/deployment-types.html.346b4d4f.js"><link rel="prefetch" href="/assets/errors.html.d567f2e9.js"><link rel="prefetch" href="/assets/files.html.5df1fdf3.js"><link rel="prefetch" href="/assets/filter-queries.html.ff3c15e1.js"><link rel="prefetch" href="/assets/games.html.ebb92d65.js"><link rel="prefetch" href="/assets/getting-started.html.3aad9f5a.js"><link rel="prefetch" href="/assets/inline-queries.html.9fa5435e.js"><link rel="prefetch" href="/assets/introduction.html.d062e0ed.js"><link rel="prefetch" href="/assets/middleware.html.c32c1afb.js"><link rel="prefetch" href="/assets/comparison.html.864b515f.js"><link rel="prefetch" href="/assets/deno-deploy.html.33fda6ac.js"><link rel="prefetch" href="/assets/gcf.html.94978e12.js"><link rel="prefetch" href="/assets/heroku.html.f4861855.js"><link rel="prefetch" href="/assets/supabase.html.f931ecc3.js"><link rel="prefetch" href="/assets/vps.html.f8b61457.js"><link rel="prefetch" href="/assets/index.html.564f39e8.js"><link rel="prefetch" href="/assets/index.html.cc711d93.js"><link rel="prefetch" href="/assets/auto-retry.html.76b5ce1b.js"><link rel="prefetch" href="/assets/autoquote.html.f8611f7b.js"><link rel="prefetch" href="/assets/command-filter.html.12deb6e8.js"><link rel="prefetch" href="/assets/console-time.html.bbb18311.js"><link rel="prefetch" href="/assets/emoji.html.96b685bd.js"><link rel="prefetch" href="/assets/files.html.59f0953c.js"><link rel="prefetch" href="/assets/fluent.html.93e75a53.js"><link rel="prefetch" href="/assets/guide.html.4a675f4a.js"><link rel="prefetch" href="/assets/hydrate.html.4d6c9f6e.js"><link rel="prefetch" href="/assets/i18n.html.b886c9b6.js"><link rel="prefetch" href="/assets/keyboard.html.5d3ef392.js"><link rel="prefetch" href="/assets/menu.html.97fd78f5.js"><link rel="prefetch" href="/assets/middlewares.html.4527fc91.js"><link rel="prefetch" href="/assets/parse-mode.html.5fea1fba.js"><link rel="prefetch" href="/assets/ratelimiter.html.09dbf6ad.js"><link rel="prefetch" href="/assets/router.html.02606ebd.js"><link rel="prefetch" href="/assets/runner.html.fb3b00e6.js"><link rel="prefetch" href="/assets/session.html.a3ebd553.js"><link rel="prefetch" href="/assets/stateless-question.html.acdd39e3.js"><link rel="prefetch" href="/assets/transformer-throttler.html.009b0e9c.js"><link rel="prefetch" href="/assets/about.html.e9ce3575.js"><link rel="prefetch" href="/assets/comparison.html.5589e0a7.js"><link rel="prefetch" href="/assets/faq.html.4a46d2bc.js"><link rel="prefetch" href="/assets/index.html.8d516f91.js"><link rel="prefetch" href="/assets/index.html.0ea21131.js"><link rel="prefetch" href="/assets/deployment.html.947cfd03.js"><link rel="prefetch" href="/assets/flood.html.adb704f3.js"><link rel="prefetch" href="/assets/middleware.html.62700685.js"><link rel="prefetch" href="/assets/proxy.html.d9e32858.js"><link rel="prefetch" href="/assets/reliability.html.214116d2.js"><link rel="prefetch" href="/assets/scaling.html.17ebd1a5.js"><link rel="prefetch" href="/assets/structuring.html.b2cc831f.js"><link rel="prefetch" href="/assets/transformers.html.0d715264.js"><link rel="prefetch" href="/assets/index.html.655275db.js"><link rel="prefetch" href="/assets/examples.html.4da510e2.js"><link rel="prefetch" href="/assets/index.html.b68e7c4e.js"><link rel="prefetch" href="/assets/api.html.864221a5.js"><link rel="prefetch" href="/assets/basics.html.d83b67aa.js"><link rel="prefetch" href="/assets/commands.html.0c654628.js"><link rel="prefetch" href="/assets/context.html.684cfc10.js"><link rel="prefetch" href="/assets/deployment-types.html.66bb2eb6.js"><link rel="prefetch" href="/assets/errors.html.3bd197a1.js"><link rel="prefetch" href="/assets/files.html.b3f5719d.js"><link rel="prefetch" href="/assets/filter-queries.html.2fc848b9.js"><link rel="prefetch" href="/assets/games.html.ed2eeb11.js"><link rel="prefetch" href="/assets/getting-started.html.bee7700c.js"><link rel="prefetch" href="/assets/inline-queries.html.3dd234a2.js"><link rel="prefetch" href="/assets/introduction.html.2c38a111.js"><link rel="prefetch" href="/assets/middleware.html.956472a4.js"><link rel="prefetch" href="/assets/comparison.html.62a530ba.js"><link rel="prefetch" href="/assets/deno-deploy.html.9ad88492.js"><link rel="prefetch" href="/assets/gcf.html.dbb08649.js"><link rel="prefetch" href="/assets/heroku.html.1a7f1f38.js"><link rel="prefetch" href="/assets/supabase.html.4ce4dd3e.js"><link rel="prefetch" href="/assets/vps.html.7964c3ff.js"><link rel="prefetch" href="/assets/index.html.d277051d.js"><link rel="prefetch" href="/assets/auto-retry.html.627c099e.js"><link rel="prefetch" href="/assets/autoquote.html.931147c8.js"><link rel="prefetch" href="/assets/command-filter.html.24250ac2.js"><link rel="prefetch" href="/assets/console-time.html.c602475c.js"><link rel="prefetch" href="/assets/conversations.html.34bdf713.js"><link rel="prefetch" href="/assets/emoji.html.4340fe04.js"><link rel="prefetch" href="/assets/files.html.0ce1beed.js"><link rel="prefetch" href="/assets/fluent.html.2312cffa.js"><link rel="prefetch" href="/assets/guide.html.cdc01534.js"><link rel="prefetch" href="/assets/hydrate.html.e78bac27.js"><link rel="prefetch" href="/assets/i18n.html.7a67a704.js"><link rel="prefetch" href="/assets/keyboard.html.6c1187da.js"><link rel="prefetch" href="/assets/menu.html.2390f9b0.js"><link rel="prefetch" href="/assets/middlewares.html.8fb2b4c6.js"><link rel="prefetch" href="/assets/parse-mode.html.6084b065.js"><link rel="prefetch" href="/assets/ratelimiter.html.e9ab9086.js"><link rel="prefetch" href="/assets/router.html.49ad6cc8.js"><link rel="prefetch" href="/assets/runner.html.2e392816.js"><link rel="prefetch" href="/assets/session.html.bc00753b.js"><link rel="prefetch" href="/assets/stateless-question.html.840ef874.js"><link rel="prefetch" href="/assets/transformer-throttler.html.a0519c22.js"><link rel="prefetch" href="/assets/about.html.6acc59e5.js"><link rel="prefetch" href="/assets/comparison.html.19d2b82f.js"><link rel="prefetch" href="/assets/faq.html.525026ef.js"><link rel="prefetch" href="/assets/index.html.c671af3a.js"><link rel="prefetch" href="/assets/deployment.html.890ba700.js"><link rel="prefetch" href="/assets/flood.html.99fc87f0.js"><link rel="prefetch" href="/assets/middleware.html.93e739dc.js"><link rel="prefetch" href="/assets/proxy.html.a206407d.js"><link rel="prefetch" href="/assets/reliability.html.77f11b74.js"><link rel="prefetch" href="/assets/scaling.html.b0186def.js"><link rel="prefetch" href="/assets/structuring.html.431bf13f.js"><link rel="prefetch" href="/assets/transformers.html.76eb6336.js"><link rel="prefetch" href="/assets/index.html.629ca643.js"><link rel="prefetch" href="/assets/examples.html.cea54aec.js"><link rel="prefetch" href="/assets/index.html.374cf0b5.js"><link rel="prefetch" href="/assets/api.html.a789ac69.js"><link rel="prefetch" href="/assets/basics.html.a5f54cb2.js"><link rel="prefetch" href="/assets/commands.html.f5bc337a.js"><link rel="prefetch" href="/assets/context.html.e94c9f2e.js"><link rel="prefetch" href="/assets/deployment-types.html.d3d220f8.js"><link rel="prefetch" href="/assets/errors.html.cb531b7a.js"><link rel="prefetch" href="/assets/files.html.1cbd9c21.js"><link rel="prefetch" href="/assets/filter-queries.html.18865e77.js"><link rel="prefetch" href="/assets/games.html.019dc6f4.js"><link rel="prefetch" href="/assets/getting-started.html.cdb13cc0.js"><link rel="prefetch" href="/assets/inline-queries.html.02267dd2.js"><link rel="prefetch" href="/assets/introduction.html.e8487eb7.js"><link rel="prefetch" href="/assets/middleware.html.beeb4db0.js"><link rel="prefetch" href="/assets/comparison.html.ece5207a.js"><link rel="prefetch" href="/assets/deno-deploy.html.8cd18a25.js"><link rel="prefetch" href="/assets/gcf.html.bf1ad988.js"><link rel="prefetch" href="/assets/heroku.html.200ca6ee.js"><link rel="prefetch" href="/assets/supabase.html.aca1ac1d.js"><link rel="prefetch" href="/assets/vps.html.40de5172.js"><link rel="prefetch" href="/assets/index.html.567ecd8c.js"><link rel="prefetch" href="/assets/auto-retry.html.be745936.js"><link rel="prefetch" href="/assets/autoquote.html.5c46e2d3.js"><link rel="prefetch" href="/assets/command-filter.html.fa1f4413.js"><link rel="prefetch" href="/assets/console-time.html.0d2bc762.js"><link rel="prefetch" href="/assets/conversations.html.778561d7.js"><link rel="prefetch" href="/assets/emoji.html.601be2b6.js"><link rel="prefetch" href="/assets/files.html.13f0053f.js"><link rel="prefetch" href="/assets/fluent.html.47d160d5.js"><link rel="prefetch" href="/assets/guide.html.381a5a51.js"><link rel="prefetch" href="/assets/hydrate.html.426ed716.js"><link rel="prefetch" href="/assets/i18n.html.afb30866.js"><link rel="prefetch" href="/assets/keyboard.html.19037e93.js"><link rel="prefetch" href="/assets/menu.html.e70d11ec.js"><link rel="prefetch" href="/assets/middlewares.html.5bc684e5.js"><link rel="prefetch" href="/assets/parse-mode.html.0e2027aa.js"><link rel="prefetch" href="/assets/ratelimiter.html.f1aaea8c.js"><link rel="prefetch" href="/assets/router.html.1476dda9.js"><link rel="prefetch" href="/assets/runner.html.ce50a49c.js"><link rel="prefetch" href="/assets/session.html.fe8e3213.js"><link rel="prefetch" href="/assets/stateless-question.html.b8a43883.js"><link rel="prefetch" href="/assets/transformer-throttler.html.45a66fc5.js"><link rel="prefetch" href="/assets/about.html.4abcfa07.js"><link rel="prefetch" href="/assets/comparison.html.8ed17bd9.js"><link rel="prefetch" href="/assets/faq.html.0dd6c2c4.js"><link rel="prefetch" href="/assets/index.html.45898178.js"><link rel="prefetch" href="/assets/deployment.html.75afc00d.js"><link rel="prefetch" href="/assets/flood.html.71e88b3b.js"><link rel="prefetch" href="/assets/middleware.html.afa5db3b.js"><link rel="prefetch" href="/assets/proxy.html.b70254e4.js"><link rel="prefetch" href="/assets/reliability.html.2858f460.js"><link rel="prefetch" href="/assets/scaling.html.ae951df2.js"><link rel="prefetch" href="/assets/structuring.html.d2ff17dd.js"><link rel="prefetch" href="/assets/transformers.html.6f5b57b6.js"><link rel="prefetch" href="/assets/index.html.74522b16.js"><link rel="prefetch" href="/assets/examples.html.24e682eb.js"><link rel="prefetch" href="/assets/index.html.9de295a7.js"><link rel="prefetch" href="/assets/api.html.8ed7866f.js"><link rel="prefetch" href="/assets/basics.html.7afbeb28.js"><link rel="prefetch" href="/assets/commands.html.131d044b.js"><link rel="prefetch" href="/assets/context.html.f1f04579.js"><link rel="prefetch" href="/assets/deployment-types.html.6efb3c25.js"><link rel="prefetch" href="/assets/errors.html.0c95dbb6.js"><link rel="prefetch" href="/assets/files.html.c53a8155.js"><link rel="prefetch" href="/assets/filter-queries.html.dab2ea34.js"><link rel="prefetch" href="/assets/games.html.60a32e8c.js"><link rel="prefetch" href="/assets/getting-started.html.7d3308dc.js"><link rel="prefetch" href="/assets/inline-queries.html.c644e6f2.js"><link rel="prefetch" href="/assets/introduction.html.2b2e7021.js"><link rel="prefetch" href="/assets/middleware.html.8e8a095a.js"><link rel="prefetch" href="/assets/comparison.html.65d3d0d9.js"><link rel="prefetch" href="/assets/deno-deploy.html.b3d0c42c.js"><link rel="prefetch" href="/assets/gcf.html.8a35f9f5.js"><link rel="prefetch" href="/assets/heroku.html.8ba42f90.js"><link rel="prefetch" href="/assets/supabase.html.ee2b455f.js"><link rel="prefetch" href="/assets/vps.html.6fe75bcb.js"><link rel="prefetch" href="/assets/index.html.f9a366b7.js"><link rel="prefetch" href="/assets/auto-retry.html.e870a1fc.js"><link rel="prefetch" href="/assets/autoquote.html.afc82797.js"><link rel="prefetch" href="/assets/command-filter.html.d5692cab.js"><link rel="prefetch" href="/assets/console-time.html.a509e6b6.js"><link rel="prefetch" href="/assets/conversations.html.c2a1214f.js"><link rel="prefetch" href="/assets/emoji.html.346d49b0.js"><link rel="prefetch" href="/assets/files.html.97985794.js"><link rel="prefetch" href="/assets/fluent.html.497a7165.js"><link rel="prefetch" href="/assets/guide.html.6086fd79.js"><link rel="prefetch" href="/assets/hydrate.html.f3bc28bb.js"><link rel="prefetch" href="/assets/i18n.html.42762cf9.js"><link rel="prefetch" href="/assets/keyboard.html.9ccac385.js"><link rel="prefetch" href="/assets/menu.html.05b22f9d.js"><link rel="prefetch" href="/assets/middlewares.html.b0d76949.js"><link rel="prefetch" href="/assets/parse-mode.html.377b539d.js"><link rel="prefetch" href="/assets/ratelimiter.html.f7e73ee7.js"><link rel="prefetch" href="/assets/router.html.401950f2.js"><link rel="prefetch" href="/assets/runner.html.da15a490.js"><link rel="prefetch" href="/assets/session.html.79028198.js"><link rel="prefetch" href="/assets/stateless-question.html.e542bb65.js"><link rel="prefetch" href="/assets/transformer-throttler.html.7d448db6.js"><link rel="prefetch" href="/assets/about.html.41287b90.js"><link rel="prefetch" href="/assets/comparison.html.162bdf02.js"><link rel="prefetch" href="/assets/faq.html.abba6af1.js"><link rel="prefetch" href="/assets/404.html.d2dc3323.js"><link rel="prefetch" href="/assets/index.html.357992f6.js"><link rel="prefetch" href="/assets/index.html.acba8d46.js"><link rel="prefetch" href="/assets/deployment.html.c44754e8.js"><link rel="prefetch" href="/assets/flood.html.e7408a13.js"><link rel="prefetch" href="/assets/middleware.html.3a2f69d4.js"><link rel="prefetch" href="/assets/proxy.html.3efdcd13.js"><link rel="prefetch" href="/assets/reliability.html.e18c4351.js"><link rel="prefetch" href="/assets/scaling.html.7e876cc0.js"><link rel="prefetch" href="/assets/structuring.html.14919643.js"><link rel="prefetch" href="/assets/transformers.html.456f6a7d.js"><link rel="prefetch" href="/assets/index.html.a33ababc.js"><link rel="prefetch" href="/assets/index.html.6d65a724.js"><link rel="prefetch" href="/assets/examples.html.0300c338.js"><link rel="prefetch" href="/assets/index.html.a9061dc4.js"><link rel="prefetch" href="/assets/api.html.4159297a.js"><link rel="prefetch" href="/assets/basics.html.a88e8522.js"><link rel="prefetch" href="/assets/commands.html.4f6730e6.js"><link rel="prefetch" href="/assets/context.html.f7615b9d.js"><link rel="prefetch" href="/assets/deployment-types.html.9af29538.js"><link rel="prefetch" href="/assets/errors.html.3515a1fd.js"><link rel="prefetch" href="/assets/files.html.00e45f76.js"><link rel="prefetch" href="/assets/filter-queries.html.8c74b9d3.js"><link rel="prefetch" href="/assets/games.html.fa02ba6f.js"><link rel="prefetch" href="/assets/getting-started.html.9a8ae606.js"><link rel="prefetch" href="/assets/inline-queries.html.b2046db3.js"><link rel="prefetch" href="/assets/introduction.html.d0ac1923.js"><link rel="prefetch" href="/assets/middleware.html.fd68d4e6.js"><link rel="prefetch" href="/assets/comparison.html.022d5798.js"><link rel="prefetch" href="/assets/deno-deploy.html.431e3d26.js"><link rel="prefetch" href="/assets/gcf.html.37c0be75.js"><link rel="prefetch" href="/assets/heroku.html.442113a6.js"><link rel="prefetch" href="/assets/supabase.html.48a5283f.js"><link rel="prefetch" href="/assets/vps.html.0c6b1afb.js"><link rel="prefetch" href="/assets/index.html.1f3490d2.js"><link rel="prefetch" href="/assets/index.html.bea728a2.js"><link rel="prefetch" href="/assets/auto-retry.html.7534bf51.js"><link rel="prefetch" href="/assets/autoquote.html.51d903c7.js"><link rel="prefetch" href="/assets/command-filter.html.3fa6b1dd.js"><link rel="prefetch" href="/assets/console-time.html.fb63ad42.js"><link rel="prefetch" href="/assets/emoji.html.e08079df.js"><link rel="prefetch" href="/assets/files.html.6fa138ff.js"><link rel="prefetch" href="/assets/fluent.html.735c18ea.js"><link rel="prefetch" href="/assets/guide.html.ea315a39.js"><link rel="prefetch" href="/assets/hydrate.html.ac34d0c3.js"><link rel="prefetch" href="/assets/i18n.html.480bbfa7.js"><link rel="prefetch" href="/assets/keyboard.html.ddbae4c0.js"><link rel="prefetch" href="/assets/menu.html.a49745ed.js"><link rel="prefetch" href="/assets/middlewares.html.770b4686.js"><link rel="prefetch" href="/assets/parse-mode.html.da102183.js"><link rel="prefetch" href="/assets/ratelimiter.html.43394de0.js"><link rel="prefetch" href="/assets/router.html.657006c9.js"><link rel="prefetch" href="/assets/runner.html.7f1a3b20.js"><link rel="prefetch" href="/assets/session.html.1683af74.js"><link rel="prefetch" href="/assets/stateless-question.html.b35bbc05.js"><link rel="prefetch" href="/assets/transformer-throttler.html.c5f83547.js"><link rel="prefetch" href="/assets/about.html.df58fd3e.js"><link rel="prefetch" href="/assets/comparison.html.80654514.js"><link rel="prefetch" href="/assets/faq.html.7c01604e.js"><link rel="prefetch" href="/assets/index.html.a9c65d3c.js"><link rel="prefetch" href="/assets/index.html.b7224f14.js"><link rel="prefetch" href="/assets/deployment.html.0eb16dd4.js"><link rel="prefetch" href="/assets/flood.html.8256528c.js"><link rel="prefetch" href="/assets/middleware.html.1b3a04da.js"><link rel="prefetch" href="/assets/proxy.html.05aa0656.js"><link rel="prefetch" href="/assets/reliability.html.d74d3598.js"><link rel="prefetch" href="/assets/scaling.html.da9c4b45.js"><link rel="prefetch" href="/assets/structuring.html.62db5e30.js"><link rel="prefetch" href="/assets/transformers.html.5a5d0c19.js"><link rel="prefetch" href="/assets/index.html.a0d0c6c3.js"><link rel="prefetch" href="/assets/examples.html.6dbf4c5a.js"><link rel="prefetch" href="/assets/index.html.d1e0b7d4.js"><link rel="prefetch" href="/assets/api.html.d2818837.js"><link rel="prefetch" href="/assets/basics.html.77283be3.js"><link rel="prefetch" href="/assets/commands.html.4cb5046c.js"><link rel="prefetch" href="/assets/context.html.06c44cf6.js"><link rel="prefetch" href="/assets/deployment-types.html.58fe1946.js"><link rel="prefetch" href="/assets/errors.html.0f41c006.js"><link rel="prefetch" href="/assets/files.html.73bb742b.js"><link rel="prefetch" href="/assets/filter-queries.html.384d5102.js"><link rel="prefetch" href="/assets/games.html.1296a9e9.js"><link rel="prefetch" href="/assets/getting-started.html.0d729395.js"><link rel="prefetch" href="/assets/inline-queries.html.aebb6dcc.js"><link rel="prefetch" href="/assets/introduction.html.27ecc3b5.js"><link rel="prefetch" href="/assets/middleware.html.114567f7.js"><link rel="prefetch" href="/assets/comparison.html.509381c5.js"><link rel="prefetch" href="/assets/deno-deploy.html.f15595cf.js"><link rel="prefetch" href="/assets/gcf.html.c68b5b47.js"><link rel="prefetch" href="/assets/heroku.html.22bb0e79.js"><link rel="prefetch" href="/assets/supabase.html.586a7981.js"><link rel="prefetch" href="/assets/vps.html.bfdac4da.js"><link rel="prefetch" href="/assets/index.html.3fba2289.js"><link rel="prefetch" href="/assets/auto-retry.html.baf3fe45.js"><link rel="prefetch" href="/assets/autoquote.html.1eab1ac1.js"><link rel="prefetch" href="/assets/command-filter.html.b0aaf792.js"><link rel="prefetch" href="/assets/console-time.html.64f61c7d.js"><link rel="prefetch" href="/assets/conversations.html.0fec81d8.js"><link rel="prefetch" href="/assets/emoji.html.fd35562f.js"><link rel="prefetch" href="/assets/files.html.ebdac89b.js"><link rel="prefetch" href="/assets/fluent.html.64688e36.js"><link rel="prefetch" href="/assets/guide.html.15a5a28e.js"><link rel="prefetch" href="/assets/hydrate.html.b2fd741f.js"><link rel="prefetch" href="/assets/i18n.html.84e44992.js"><link rel="prefetch" href="/assets/keyboard.html.257ad054.js"><link rel="prefetch" href="/assets/menu.html.703b8445.js"><link rel="prefetch" href="/assets/middlewares.html.44d2e25f.js"><link rel="prefetch" href="/assets/parse-mode.html.a1cd1ede.js"><link rel="prefetch" href="/assets/ratelimiter.html.db5dd7a6.js"><link rel="prefetch" href="/assets/router.html.17a3f352.js"><link rel="prefetch" href="/assets/runner.html.97d3420c.js"><link rel="prefetch" href="/assets/session.html.08737339.js"><link rel="prefetch" href="/assets/stateless-question.html.268ef847.js"><link rel="prefetch" href="/assets/transformer-throttler.html.47e6f22c.js"><link rel="prefetch" href="/assets/about.html.6f79d7a4.js"><link rel="prefetch" href="/assets/comparison.html.3fb6b10b.js"><link rel="prefetch" href="/assets/faq.html.3fc7c7b9.js"><link rel="prefetch" href="/assets/index.html.c0b42797.js"><link rel="prefetch" href="/assets/deployment.html.f019abbb.js"><link rel="prefetch" href="/assets/flood.html.df08864e.js"><link rel="prefetch" href="/assets/middleware.html.3709d735.js"><link rel="prefetch" href="/assets/proxy.html.f6a1487a.js"><link rel="prefetch" href="/assets/reliability.html.4716b388.js"><link rel="prefetch" href="/assets/scaling.html.be7c2ff8.js"><link rel="prefetch" href="/assets/structuring.html.fb516af5.js"><link rel="prefetch" href="/assets/transformers.html.d67739c1.js"><link rel="prefetch" href="/assets/index.html.dc60e3f2.js"><link rel="prefetch" href="/assets/examples.html.cb26a183.js"><link rel="prefetch" href="/assets/index.html.c25291cf.js"><link rel="prefetch" href="/assets/api.html.399372b7.js"><link rel="prefetch" href="/assets/basics.html.8b832c54.js"><link rel="prefetch" href="/assets/commands.html.22bd9607.js"><link rel="prefetch" href="/assets/context.html.0145be9c.js"><link rel="prefetch" href="/assets/deployment-types.html.2d6d124c.js"><link rel="prefetch" href="/assets/errors.html.1555a3a8.js"><link rel="prefetch" href="/assets/files.html.db9deced.js"><link rel="prefetch" href="/assets/filter-queries.html.a1512e4b.js"><link rel="prefetch" href="/assets/games.html.62487f59.js"><link rel="prefetch" href="/assets/getting-started.html.8503e7bc.js"><link rel="prefetch" href="/assets/inline-queries.html.d3cb93cd.js"><link rel="prefetch" href="/assets/introduction.html.61ec5df8.js"><link rel="prefetch" href="/assets/middleware.html.b097c7a3.js"><link rel="prefetch" href="/assets/comparison.html.d12e7ed3.js"><link rel="prefetch" href="/assets/deno-deploy.html.f6ffd9d5.js"><link rel="prefetch" href="/assets/gcf.html.f312b02f.js"><link rel="prefetch" href="/assets/heroku.html.7c8b6d05.js"><link rel="prefetch" href="/assets/supabase.html.60848f24.js"><link rel="prefetch" href="/assets/vps.html.887ba030.js"><link rel="prefetch" href="/assets/index.html.4508f6a0.js"><link rel="prefetch" href="/assets/auto-retry.html.293b9c95.js"><link rel="prefetch" href="/assets/autoquote.html.5350d6ae.js"><link rel="prefetch" href="/assets/command-filter.html.80ecb08c.js"><link rel="prefetch" href="/assets/console-time.html.59573adb.js"><link rel="prefetch" href="/assets/conversations.html.458dae6a.js"><link rel="prefetch" href="/assets/emoji.html.1e1b0108.js"><link rel="prefetch" href="/assets/files.html.4e58e8c0.js"><link rel="prefetch" href="/assets/fluent.html.a2d7ff14.js"><link rel="prefetch" href="/assets/guide.html.48de19d6.js"><link rel="prefetch" href="/assets/hydrate.html.c3d6e380.js"><link rel="prefetch" href="/assets/i18n.html.b61f1101.js"><link rel="prefetch" href="/assets/keyboard.html.3a3d33a4.js"><link rel="prefetch" href="/assets/menu.html.3f64c0ea.js"><link rel="prefetch" href="/assets/middlewares.html.087ef5da.js"><link rel="prefetch" href="/assets/parse-mode.html.b60340f8.js"><link rel="prefetch" href="/assets/ratelimiter.html.f6cb8cff.js"><link rel="prefetch" href="/assets/router.html.e5304463.js"><link rel="prefetch" href="/assets/runner.html.8aba670d.js"><link rel="prefetch" href="/assets/session.html.74950553.js"><link rel="prefetch" href="/assets/stateless-question.html.ec46a9f6.js"><link rel="prefetch" href="/assets/transformer-throttler.html.8ad1b3af.js"><link rel="prefetch" href="/assets/about.html.8f728512.js"><link rel="prefetch" href="/assets/comparison.html.c5d78d80.js"><link rel="prefetch" href="/assets/faq.html.f8f868ba.js"><link rel="prefetch" href="/assets/index.html.65e61f69.js"><link rel="prefetch" href="/assets/deployment.html.75523419.js"><link rel="prefetch" href="/assets/flood.html.2a4c24ab.js"><link rel="prefetch" href="/assets/middleware.html.6855e31c.js"><link rel="prefetch" href="/assets/proxy.html.fa148d86.js"><link rel="prefetch" href="/assets/reliability.html.12eb5ab0.js"><link rel="prefetch" href="/assets/scaling.html.6cfeb451.js"><link rel="prefetch" href="/assets/structuring.html.3597efb0.js"><link rel="prefetch" href="/assets/transformers.html.4b6988f5.js"><link rel="prefetch" href="/assets/index.html.2f5383c0.js"><link rel="prefetch" href="/assets/examples.html.d1139739.js"><link rel="prefetch" href="/assets/index.html.b6be373b.js"><link rel="prefetch" href="/assets/api.html.7b8078e2.js"><link rel="prefetch" href="/assets/basics.html.b9c06802.js"><link rel="prefetch" href="/assets/commands.html.82d30c80.js"><link rel="prefetch" href="/assets/context.html.e94e2495.js"><link rel="prefetch" href="/assets/deployment-types.html.c5b385d5.js"><link rel="prefetch" href="/assets/errors.html.6d970a2f.js"><link rel="prefetch" href="/assets/files.html.a792d7d0.js"><link rel="prefetch" href="/assets/filter-queries.html.4faf7ff1.js"><link rel="prefetch" href="/assets/games.html.a36e14cd.js"><link rel="prefetch" href="/assets/getting-started.html.3fc1ea60.js"><link rel="prefetch" href="/assets/inline-queries.html.c3eee4dc.js"><link rel="prefetch" href="/assets/introduction.html.a0a7bc09.js"><link rel="prefetch" href="/assets/middleware.html.e45ea0bf.js"><link rel="prefetch" href="/assets/comparison.html.909b6280.js"><link rel="prefetch" href="/assets/deno-deploy.html.3b7b4e6a.js"><link rel="prefetch" href="/assets/gcf.html.91cda73b.js"><link rel="prefetch" href="/assets/heroku.html.6e6ec6be.js"><link rel="prefetch" href="/assets/supabase.html.bcfe8479.js"><link rel="prefetch" href="/assets/vps.html.c966a725.js"><link rel="prefetch" href="/assets/index.html.e7705942.js"><link rel="prefetch" href="/assets/auto-retry.html.807688fe.js"><link rel="prefetch" href="/assets/autoquote.html.499b97bb.js"><link rel="prefetch" href="/assets/command-filter.html.8508ffda.js"><link rel="prefetch" href="/assets/console-time.html.5bdfa92d.js"><link rel="prefetch" href="/assets/conversations.html.f6a86b74.js"><link rel="prefetch" href="/assets/emoji.html.e35a6793.js"><link rel="prefetch" href="/assets/files.html.48e8cdac.js"><link rel="prefetch" href="/assets/fluent.html.c292c7b3.js"><link rel="prefetch" href="/assets/guide.html.95a17794.js"><link rel="prefetch" href="/assets/hydrate.html.85f631f5.js"><link rel="prefetch" href="/assets/i18n.html.c9452bb4.js"><link rel="prefetch" href="/assets/keyboard.html.1e1c5f83.js"><link rel="prefetch" href="/assets/menu.html.d9c386c2.js"><link rel="prefetch" href="/assets/middlewares.html.7d8f1ece.js"><link rel="prefetch" href="/assets/parse-mode.html.036d78c5.js"><link rel="prefetch" href="/assets/ratelimiter.html.78c55b1d.js"><link rel="prefetch" href="/assets/router.html.32502b5c.js"><link rel="prefetch" href="/assets/runner.html.28e621a5.js"><link rel="prefetch" href="/assets/session.html.b316d92e.js"><link rel="prefetch" href="/assets/stateless-question.html.8da1cb9a.js"><link rel="prefetch" href="/assets/transformer-throttler.html.9825a105.js"><link rel="prefetch" href="/assets/about.html.2e47b58a.js"><link rel="prefetch" href="/assets/comparison.html.604337eb.js"><link rel="prefetch" href="/assets/faq.html.a7131057.js"><link rel="prefetch" href="/assets/404.html.4b9d5e8a.js">
    <link rel="stylesheet" href="/assets/style.177b0b6b.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/Y.png" alt="grammY"><span class="site-name can-hide">grammY</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/guide/" class="" aria-label="Guide"><!--[--><!--]--><span>Guide <!--v-if--></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Learn"><span class="title">Learn</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Learn"><span class="title">Learn</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Guide <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/guide/" class="" aria-label="Overview"><!--[--><!--]--><span>Overview <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/introduction.html" class="" aria-label="Introduction"><!--[--><!--]--><span>Introduction <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/getting-started.html" class="" aria-label="Getting Started"><!--[--><!--]--><span>Getting Started <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/basics.html" class="" aria-label="Sending and Receiving Messages"><!--[--><!--]--><span>Sending and Receiving Messages <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/context.html" class="" aria-label="Context"><!--[--><!--]--><span>Context <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/api.html" class="" aria-label="Bot API"><!--[--><!--]--><span>Bot API <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/filter-queries.html" class="" aria-label="Filter Queries and bot.on()"><!--[--><!--]--><span>Filter Queries and bot.on() <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/commands.html" class="" aria-label="Commands"><!--[--><!--]--><span>Commands <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/middleware.html" class="" aria-label="Middleware"><!--[--><!--]--><span>Middleware <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/errors.html" class="" aria-label="Error Handling"><!--[--><!--]--><span>Error Handling <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/inline-queries.html" class="" aria-label="Inline Queries"><!--[--><!--]--><span>Inline Queries <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/files.html" class="" aria-label="File Handling"><!--[--><!--]--><span>File Handling <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/games.html" class="" aria-label="Games"><!--[--><!--]--><span>Games <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/deployment-types.html" class="" aria-label="Long Polling vs. Webhooks"><!--[--><!--]--><span>Long Polling vs. Webhooks <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Advanced <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/advanced/" class="" aria-label="Overview"><!--[--><!--]--><span>Overview <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/middleware.html" class="" aria-label="Middleware Redux"><!--[--><!--]--><span>Middleware Redux <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/structuring.html" class="" aria-label="Scaling Up I: Large Codebase"><!--[--><!--]--><span>Scaling Up I: Large Codebase <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/scaling.html" class="" aria-label="Scaling Up II: High Load"><!--[--><!--]--><span>Scaling Up II: High Load <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/reliability.html" class="" aria-label="Scaling Up III: Reliability"><!--[--><!--]--><span>Scaling Up III: Reliability <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/flood.html" class="" aria-label="Scaling Up IV: Flood Limits"><!--[--><!--]--><span>Scaling Up IV: Flood Limits <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/transformers.html" class="" aria-label="Bot API Transformers"><!--[--><!--]--><span>Bot API Transformers <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/proxy.html" class="" aria-label="Proxy Support"><!--[--><!--]--><span>Proxy Support <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/deployment.html" class="" aria-label="Deployment Checklist"><!--[--><!--]--><span>Deployment Checklist <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Plugins"><span class="title">Plugins</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Plugins"><span class="title">Plugins</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Introduction <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/plugins/" class="" aria-label="About Plugins"><!--[--><!--]--><span>About Plugins <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/guide.html" class="" aria-label="How to Write a Plugin"><!--[--><!--]--><span>How to Write a Plugin <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Built-in <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/plugins/session.html" class="" aria-label="Sessions and Storing Data"><!--[--><!--]--><span>Sessions and Storing Data <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/keyboard.html" class="" aria-label="Inline and Custom Keyboards"><!--[--><!--]--><span>Inline and Custom Keyboards <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Official <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/plugins/conversations.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Conversations (conversations)"><!--[--><!--]--><span>Conversations (conversations) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/menu.html" class="" aria-label="Interactive Menus (menu)"><!--[--><!--]--><span>Interactive Menus (menu) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/stateless-question.html" class="" aria-label="Stateless Question (stateless-question)"><!--[--><!--]--><span>Stateless Question (stateless-question) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/runner.html" class="" aria-label="Concurrency (runner)"><!--[--><!--]--><span>Concurrency (runner) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/hydrate.html" class="" aria-label="Hydration (hydrate)"><!--[--><!--]--><span>Hydration (hydrate) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/auto-retry.html" class="" aria-label="Retry API Requests (auto-retry)"><!--[--><!--]--><span>Retry API Requests (auto-retry) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/transformer-throttler.html" class="" aria-label="Flood Control (transformer-throttler)"><!--[--><!--]--><span>Flood Control (transformer-throttler) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/ratelimiter.html" class="" aria-label="Rate Limit Users (ratelimiter)"><!--[--><!--]--><span>Rate Limit Users (ratelimiter) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/files.html" class="" aria-label="Files (files)"><!--[--><!--]--><span>Files (files) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/i18n.html" class="" aria-label="Internationalization (i18n)"><!--[--><!--]--><span>Internationalization (i18n) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/fluent.html" class="" aria-label="Internationalization (fluent)"><!--[--><!--]--><span>Internationalization (fluent) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/router.html" class="" aria-label="Router (router)"><!--[--><!--]--><span>Router (router) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/emoji.html" class="" aria-label="Emoji (emoji)"><!--[--><!--]--><span>Emoji (emoji) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/parse-mode.html" class="" aria-label="Parse Mode (parse-mode)"><!--[--><!--]--><span>Parse Mode (parse-mode) <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Third-party <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/plugins/console-time.html" class="" aria-label="Console Time"><!--[--><!--]--><span>Console Time <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/middlewares.html" class="" aria-label="Useful Middleware"><!--[--><!--]--><span>Useful Middleware <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/autoquote.html" class="" aria-label="Autoquote"><!--[--><!--]--><span>Autoquote <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/#create-your-own-plugins" class="" aria-label="[Submit your PR!]"><!--[--><!--]--><span>[Submit your PR!] <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Examples"><span class="title">Examples</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Examples"><span class="title">Examples</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Examples <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://github.com/grammyjs/awesome-grammY" rel="noopener noreferrer" target="_blank" aria-label="Awesome grammY"><!--[--><!--]--><span>Awesome grammY <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://github.com/grammyjs/examples" rel="noopener noreferrer" target="_blank" aria-label="Example Bots Repository"><!--[--><!--]--><span>Example Bots Repository <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Resources"><span class="title">Resources</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Resources"><span class="title">Resources</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>grammY <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/resources/about.html" class="" aria-label="About grammY"><!--[--><!--]--><span>About grammY <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs" rel="noopener noreferrer" target="_blank" aria-label="Community Chat (English)"><!--[--><!--]--><span>Community Chat (English) <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs_ru" rel="noopener noreferrer" target="_blank" aria-label="Community Chat (Russian)"><!--[--><!--]--><span>Community Chat (Russian) <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs_news" rel="noopener noreferrer" target="_blank" aria-label="News"><!--[--><!--]--><span>News <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://twitter.com/grammy_js" rel="noopener noreferrer" target="_blank" aria-label="Twitter"><!--[--><!--]--><span>Twitter <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/resources/faq.html" class="" aria-label="FAQ"><!--[--><!--]--><span>FAQ <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/resources/comparison.html" class="" aria-label="Comparison to Other Frameworks"><!--[--><!--]--><span>Comparison to Other Frameworks <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Telegram <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots" rel="noopener noreferrer" target="_blank" aria-label="Introduction for Developers"><!--[--><!--]--><span>Introduction for Developers <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/faq" rel="noopener noreferrer" target="_blank" aria-label="Bots FAQ"><!--[--><!--]--><span>Bots FAQ <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/api" rel="noopener noreferrer" target="_blank" aria-label="Bot API Reference"><!--[--><!--]--><span>Bot API Reference <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/webhooks#testing-your-bot-with-updates" rel="noopener noreferrer" target="_blank" aria-label="Example Updates"><!--[--><!--]--><span>Example Updates <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Hosting"><span class="title">Hosting</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Hosting"><span class="title">Hosting</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Overview <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/hosting/comparison.html" class="" aria-label="Comparison"><!--[--><!--]--><span>Comparison <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Tutorials <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/hosting/deno-deploy.html" class="" aria-label="Deno Deploy"><!--[--><!--]--><span>Deno Deploy <div class="tag-group" style=""><!--[--><!--[--><!----><!--]--><!--]--></div></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hosting/supabase.html" class="" aria-label="Supabase Edge Functions"><!--[--><!--]--><span>Supabase Edge Functions <div class="tag-group" style=""><!--[--><!--[--><!----><!--]--><!--]--></div></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hosting/heroku.html" class="" aria-label="Heroku"><!--[--><!--]--><span>Heroku <div class="tag-group" style=""><!--[--><!--[--><!----><!----><!--]--><!--]--></div></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hosting/gcf.html" class="" aria-label="Google Cloud Functions"><!--[--><!--]--><span>Google Cloud Functions <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hosting/vps.html" class="" aria-label="Virtual Private Server"><!--[--><!--]--><span>Virtual Private Server <div class="tag-group" style=""><!--[--><!--[--><!----><!----><!--]--><!--]--></div></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://doc.deno.land/https://deno.land/x/grammy/mod.ts" rel="noopener noreferrer" target="_blank" aria-label="API Reference"><!--[--><!--]--><span>API Reference <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/plugins/conversations.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--><span>English <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/plugins/conversations.html" class="" aria-label="Español"><!--[--><!--]--><span>Español <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/plugins/conversations.html" class="" aria-label="Indonesia"><!--[--><!--]--><span>Indonesia <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/plugins/conversations.html" class="" aria-label="简体中文"><!--[--><!--]--><span>简体中文 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/grammyjs/grammY" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--><span>GitHub <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/guide/" class="" aria-label="Guide"><!--[--><!--]--><span>Guide <!--v-if--></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Learn"><span class="title">Learn</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Learn"><span class="title">Learn</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Guide <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/guide/" class="" aria-label="Overview"><!--[--><!--]--><span>Overview <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/introduction.html" class="" aria-label="Introduction"><!--[--><!--]--><span>Introduction <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/getting-started.html" class="" aria-label="Getting Started"><!--[--><!--]--><span>Getting Started <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/basics.html" class="" aria-label="Sending and Receiving Messages"><!--[--><!--]--><span>Sending and Receiving Messages <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/context.html" class="" aria-label="Context"><!--[--><!--]--><span>Context <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/api.html" class="" aria-label="Bot API"><!--[--><!--]--><span>Bot API <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/filter-queries.html" class="" aria-label="Filter Queries and bot.on()"><!--[--><!--]--><span>Filter Queries and bot.on() <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/commands.html" class="" aria-label="Commands"><!--[--><!--]--><span>Commands <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/middleware.html" class="" aria-label="Middleware"><!--[--><!--]--><span>Middleware <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/errors.html" class="" aria-label="Error Handling"><!--[--><!--]--><span>Error Handling <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/inline-queries.html" class="" aria-label="Inline Queries"><!--[--><!--]--><span>Inline Queries <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/files.html" class="" aria-label="File Handling"><!--[--><!--]--><span>File Handling <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/games.html" class="" aria-label="Games"><!--[--><!--]--><span>Games <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/guide/deployment-types.html" class="" aria-label="Long Polling vs. Webhooks"><!--[--><!--]--><span>Long Polling vs. Webhooks <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Advanced <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/advanced/" class="" aria-label="Overview"><!--[--><!--]--><span>Overview <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/middleware.html" class="" aria-label="Middleware Redux"><!--[--><!--]--><span>Middleware Redux <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/structuring.html" class="" aria-label="Scaling Up I: Large Codebase"><!--[--><!--]--><span>Scaling Up I: Large Codebase <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/scaling.html" class="" aria-label="Scaling Up II: High Load"><!--[--><!--]--><span>Scaling Up II: High Load <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/reliability.html" class="" aria-label="Scaling Up III: Reliability"><!--[--><!--]--><span>Scaling Up III: Reliability <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/flood.html" class="" aria-label="Scaling Up IV: Flood Limits"><!--[--><!--]--><span>Scaling Up IV: Flood Limits <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/transformers.html" class="" aria-label="Bot API Transformers"><!--[--><!--]--><span>Bot API Transformers <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/proxy.html" class="" aria-label="Proxy Support"><!--[--><!--]--><span>Proxy Support <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/deployment.html" class="" aria-label="Deployment Checklist"><!--[--><!--]--><span>Deployment Checklist <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Plugins"><span class="title">Plugins</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Plugins"><span class="title">Plugins</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Introduction <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/plugins/" class="" aria-label="About Plugins"><!--[--><!--]--><span>About Plugins <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/guide.html" class="" aria-label="How to Write a Plugin"><!--[--><!--]--><span>How to Write a Plugin <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Built-in <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/plugins/session.html" class="" aria-label="Sessions and Storing Data"><!--[--><!--]--><span>Sessions and Storing Data <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/keyboard.html" class="" aria-label="Inline and Custom Keyboards"><!--[--><!--]--><span>Inline and Custom Keyboards <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Official <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/plugins/conversations.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Conversations (conversations)"><!--[--><!--]--><span>Conversations (conversations) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/menu.html" class="" aria-label="Interactive Menus (menu)"><!--[--><!--]--><span>Interactive Menus (menu) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/stateless-question.html" class="" aria-label="Stateless Question (stateless-question)"><!--[--><!--]--><span>Stateless Question (stateless-question) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/runner.html" class="" aria-label="Concurrency (runner)"><!--[--><!--]--><span>Concurrency (runner) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/hydrate.html" class="" aria-label="Hydration (hydrate)"><!--[--><!--]--><span>Hydration (hydrate) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/auto-retry.html" class="" aria-label="Retry API Requests (auto-retry)"><!--[--><!--]--><span>Retry API Requests (auto-retry) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/transformer-throttler.html" class="" aria-label="Flood Control (transformer-throttler)"><!--[--><!--]--><span>Flood Control (transformer-throttler) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/ratelimiter.html" class="" aria-label="Rate Limit Users (ratelimiter)"><!--[--><!--]--><span>Rate Limit Users (ratelimiter) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/files.html" class="" aria-label="Files (files)"><!--[--><!--]--><span>Files (files) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/i18n.html" class="" aria-label="Internationalization (i18n)"><!--[--><!--]--><span>Internationalization (i18n) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/fluent.html" class="" aria-label="Internationalization (fluent)"><!--[--><!--]--><span>Internationalization (fluent) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/router.html" class="" aria-label="Router (router)"><!--[--><!--]--><span>Router (router) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/emoji.html" class="" aria-label="Emoji (emoji)"><!--[--><!--]--><span>Emoji (emoji) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/parse-mode.html" class="" aria-label="Parse Mode (parse-mode)"><!--[--><!--]--><span>Parse Mode (parse-mode) <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Third-party <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/plugins/console-time.html" class="" aria-label="Console Time"><!--[--><!--]--><span>Console Time <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/middlewares.html" class="" aria-label="Useful Middleware"><!--[--><!--]--><span>Useful Middleware <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/autoquote.html" class="" aria-label="Autoquote"><!--[--><!--]--><span>Autoquote <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/plugins/#create-your-own-plugins" class="" aria-label="[Submit your PR!]"><!--[--><!--]--><span>[Submit your PR!] <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Examples"><span class="title">Examples</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Examples"><span class="title">Examples</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Examples <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://github.com/grammyjs/awesome-grammY" rel="noopener noreferrer" target="_blank" aria-label="Awesome grammY"><!--[--><!--]--><span>Awesome grammY <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://github.com/grammyjs/examples" rel="noopener noreferrer" target="_blank" aria-label="Example Bots Repository"><!--[--><!--]--><span>Example Bots Repository <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Resources"><span class="title">Resources</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Resources"><span class="title">Resources</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>grammY <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/resources/about.html" class="" aria-label="About grammY"><!--[--><!--]--><span>About grammY <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs" rel="noopener noreferrer" target="_blank" aria-label="Community Chat (English)"><!--[--><!--]--><span>Community Chat (English) <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs_ru" rel="noopener noreferrer" target="_blank" aria-label="Community Chat (Russian)"><!--[--><!--]--><span>Community Chat (Russian) <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs_news" rel="noopener noreferrer" target="_blank" aria-label="News"><!--[--><!--]--><span>News <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://twitter.com/grammy_js" rel="noopener noreferrer" target="_blank" aria-label="Twitter"><!--[--><!--]--><span>Twitter <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/resources/faq.html" class="" aria-label="FAQ"><!--[--><!--]--><span>FAQ <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/resources/comparison.html" class="" aria-label="Comparison to Other Frameworks"><!--[--><!--]--><span>Comparison to Other Frameworks <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Telegram <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots" rel="noopener noreferrer" target="_blank" aria-label="Introduction for Developers"><!--[--><!--]--><span>Introduction for Developers <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/faq" rel="noopener noreferrer" target="_blank" aria-label="Bots FAQ"><!--[--><!--]--><span>Bots FAQ <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/api" rel="noopener noreferrer" target="_blank" aria-label="Bot API Reference"><!--[--><!--]--><span>Bot API Reference <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/webhooks#testing-your-bot-with-updates" rel="noopener noreferrer" target="_blank" aria-label="Example Updates"><!--[--><!--]--><span>Example Updates <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Hosting"><span class="title">Hosting</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Hosting"><span class="title">Hosting</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Overview <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/hosting/comparison.html" class="" aria-label="Comparison"><!--[--><!--]--><span>Comparison <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Tutorials <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/hosting/deno-deploy.html" class="" aria-label="Deno Deploy"><!--[--><!--]--><span>Deno Deploy <div class="tag-group" style=""><!--[--><!--[--><!----><!--]--><!--]--></div></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hosting/supabase.html" class="" aria-label="Supabase Edge Functions"><!--[--><!--]--><span>Supabase Edge Functions <div class="tag-group" style=""><!--[--><!--[--><!----><!--]--><!--]--></div></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hosting/heroku.html" class="" aria-label="Heroku"><!--[--><!--]--><span>Heroku <div class="tag-group" style=""><!--[--><!--[--><!----><!----><!--]--><!--]--></div></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hosting/gcf.html" class="" aria-label="Google Cloud Functions"><!--[--><!--]--><span>Google Cloud Functions <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/hosting/vps.html" class="" aria-label="Virtual Private Server"><!--[--><!--]--><span>Virtual Private Server <div class="tag-group" style=""><!--[--><!--[--><!----><!----><!--]--><!--]--></div></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://doc.deno.land/https://deno.land/x/grammy/mod.ts" rel="noopener noreferrer" target="_blank" aria-label="API Reference"><!--[--><!--]--><span>API Reference <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/plugins/conversations.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--><span>English <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/plugins/conversations.html" class="" aria-label="Español"><!--[--><!--]--><span>Español <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/plugins/conversations.html" class="" aria-label="Indonesia"><!--[--><!--]--><span>Indonesia <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/plugins/conversations.html" class="" aria-label="简体中文"><!--[--><!--]--><span>简体中文 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/grammyjs/grammY" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--><span>GitHub <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Conversations (conversations) <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/plugins/conversations.html#introduction" class="router-link-active router-link-exact-active sidebar-item" aria-label="Introduction"><!--[--><!--]--><span>Introduction <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#simple-example" class="router-link-active router-link-exact-active sidebar-item" aria-label="Simple Example"><!--[--><!--]--><span>Simple Example <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#conversation-builder-functions" class="router-link-active router-link-exact-active sidebar-item" aria-label="Conversation Builder Functions"><!--[--><!--]--><span>Conversation Builder Functions <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#installing-and-entering-a-conversation" class="router-link-active router-link-exact-active sidebar-item" aria-label="Installing and Entering a Conversation"><!--[--><!--]--><span>Installing and Entering a Conversation <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#leaving-a-conversation" class="router-link-active router-link-exact-active sidebar-item" aria-label="Leaving a Conversation"><!--[--><!--]--><span>Leaving a Conversation <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#waiting-for-updates" class="router-link-active router-link-exact-active sidebar-item" aria-label="Waiting for Updates"><!--[--><!--]--><span>Waiting for Updates <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#three-golden-rules-of-conversations" class="router-link-active router-link-exact-active sidebar-item" aria-label="Three Golden Rules of Conversations"><!--[--><!--]--><span>Three Golden Rules of Conversations <!--v-if--></span><!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/plugins/conversations.html#rule-i-all-side-effects-must-be-wrapped" class="router-link-active router-link-exact-active sidebar-item" aria-label="Rule I: All Side-effects Must Be Wrapped"><!--[--><!--]--><span>Rule I: All Side-effects Must Be Wrapped <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#rule-ii-all-random-behavior-must-be-wrapped" class="router-link-active router-link-exact-active sidebar-item" aria-label="Rule II: All Random Behavior Must Be Wrapped"><!--[--><!--]--><span>Rule II: All Random Behavior Must Be Wrapped <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#rule-iii-use-convenience-functions" class="router-link-active router-link-exact-active sidebar-item" aria-label="Rule III: Use Convenience Functions"><!--[--><!--]--><span>Rule III: Use Convenience Functions <!--v-if--></span><!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/plugins/conversations.html#variables-branching-and-loops" class="router-link-active router-link-exact-active sidebar-item" aria-label="Variables, Branching, and Loops"><!--[--><!--]--><span>Variables, Branching, and Loops <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#functions-and-recursion" class="router-link-active router-link-exact-active sidebar-item" aria-label="Functions and Recursion"><!--[--><!--]--><span>Functions and Recursion <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#modules-and-classes" class="router-link-active router-link-exact-active sidebar-item" aria-label="Modules and Classes"><!--[--><!--]--><span>Modules and Classes <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#forms" class="router-link-active router-link-exact-active sidebar-item" aria-label="Forms"><!--[--><!--]--><span>Forms <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#parallel-conversations" class="router-link-active router-link-exact-active sidebar-item" aria-label="Parallel Conversations"><!--[--><!--]--><span>Parallel Conversations <!--v-if--></span><!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/plugins/conversations.html#how-it-works-behind-the-scenes" class="router-link-active router-link-exact-active sidebar-item" aria-label="How It Works Behind the Scenes"><!--[--><!--]--><span>How It Works Behind the Scenes <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#how-you-can-use-it" class="router-link-active router-link-exact-active sidebar-item" aria-label="How You Can Use It"><!--[--><!--]--><span>How You Can Use It <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#inspecting-active-conversations" class="router-link-active router-link-exact-active sidebar-item" aria-label="Inspecting Active Conversations"><!--[--><!--]--><span>Inspecting Active Conversations <!--v-if--></span><!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/plugins/conversations.html#how-it-works" class="router-link-active router-link-exact-active sidebar-item" aria-label="How It Works"><!--[--><!--]--><span>How It Works <!--v-if--></span><!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/plugins/conversations.html#how-wait-calls-work" class="router-link-active router-link-exact-active sidebar-item" aria-label="How wait Calls Work"><!--[--><!--]--><span>How wait Calls Work <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/plugins/conversations.html#how-to-intercept-function-execution" class="router-link-active router-link-exact-active sidebar-item" aria-label="How to Intercept Function Execution"><!--[--><!--]--><span>How to Intercept Function Execution <!--v-if--></span><!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/plugins/conversations.html#plugin-summary" class="router-link-active router-link-exact-active sidebar-item" aria-label="Plugin Summary"><!--[--><!--]--><span>Plugin Summary <!--v-if--></span><!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="conversations-conversations" tabindex="-1"><a class="header-anchor" href="#conversations-conversations" aria-hidden="true">#</a> Conversations (<code>conversations</code>)</h1><div class="tag-group" style=""><!--[--><!----><!--]--></div><p>Create powerful conversational interfaces with ease.</p><h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h2><p>Most chats consist of more than just one single message. (duh)</p><p>For example, you may want to ask the user a question, and then wait for the response. This may even go back and forth several times, so that a conversation unfolds.</p><p>When you think about <a href="/guide/middleware.html" class="">middleware</a>, you will notice that everything is based around a single <a href="/guide/context.html" class="">context object</a> per handler. This means that you always only handle a single message in isolation. It is not easy to write something like “check the text three messages ago” or something.</p><p><strong>This plugin comes to the rescue:</strong> It provides an extremely flexible way to define conversations between your bot and your users.</p><p>Many bot frameworks make you define large configuration objects with steps and stages and jumps and wizard flows and what have you. This leads to a lot of boilerplate code, and makes it hard to follow along. <strong>This plugin does not work that way.</strong></p><p>Instead, with this plugin, you will use something much more powerful: <strong>code</strong>. Basically, you simply define a normal JavaScript function which lets you define how the conversation evolves. As the bot and the user talk to each other, the function will be executed statement by statement.</p><p>(To be fair, that’s not actually how it works under the hood. But it is very helpful to think of it that way! In reality, your function will be executed a bit differently, but we’ll get to that <a href="#waiting-for-updates">later</a>.)</p><h2 id="simple-example" tabindex="-1"><a class="header-anchor" href="#simple-example" aria-hidden="true">#</a> Simple Example</h2><p>Before we dive into how you can create conversations, have a look at a short JavaScript example of how a conversation will look.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Hi there! What is your name?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Welcome to the chat, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this conversation, the bot will first greet the user, and ask for their name. Then it will wait until the user sends their name. Lastly, the bot welcomes the user to the chat, repeating the name.</p><p>Easy, right? Let’s see how it’s done!</p><h2 id="conversation-builder-functions" tabindex="-1"><a class="header-anchor" href="#conversation-builder-functions" aria-hidden="true">#</a> Conversation Builder Functions</h2><p>First of all, lets import a few things.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Deno</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> <span class="token class-name">Conversation</span><span class="token punctuation">,</span>
  <span class="token keyword">type</span> <span class="token class-name">ConversationFlavor</span><span class="token punctuation">,</span>
  conversations<span class="token punctuation">,</span>
  createConversation<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@grammyjs/conversations&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  conversations<span class="token punctuation">,</span>
  createConversation<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@grammyjs/conversations&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> <span class="token class-name">Conversation</span><span class="token punctuation">,</span>
  <span class="token keyword">type</span> <span class="token class-name">ConversationFlavor</span><span class="token punctuation">,</span>
  conversations<span class="token punctuation">,</span>
  createConversation<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://deno.land/x/grammy_conversations@v1.0.3/mod.ts&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>With that out of the way, we can now have a look at how to define conversational interfaces.</p><p>The main element of a conversation is a function with two arguments. We call this the <em>conversation builder function</em>.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO: code the conversation</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Let’s see what the two parameters are.</p><p><strong>The second parameter</strong> is not that interesting, it is just a regular context object. As always, it is called <code>ctx</code> and uses your <a href="/guide/context.html#customizing-the-context-object" class="">custom context type</a> (maybe called <code>My<wbr>Context</code>). The conversations plugin exports a <a href="/guide/context.html#additive-context-flavors" class="">context flavor</a> called <code>Conversation<wbr>Flavor</code>.</p><p><strong>The first parameter</strong> is the central element of this plugin. It is commonly named <code>conversation</code>, and it has the type <code>Conversation</code> (<a href="https://doc.deno.land/https://deno.land/x/grammy_conversations/mod.ts/~/Conversation" target="_blank" rel="noopener noreferrer">API reference<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>). It can be used as a handle to control the conversation, such as waiting for user input, and more. The type <code>Conversation</code> expects your <a href="/guide/context.html#customizing-the-context-object" class="">custom context type</a> as a type parameter, so you would often use <code>Conversation&lt;My<wbr>Context&gt;</code>.</p><p>In summary, in TypeScript, your conversation builder function will look like this.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">MyContext</span> <span class="token operator">=</span> Context <span class="token operator">&amp;</span> ConversationFlavor<span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">MyConversation</span> <span class="token operator">=</span> Conversation<span class="token operator">&lt;</span>MyContext<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO: code the conversation</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Inside of your conversation builder function, you can now define how the conversation should look. Before we go in depth about every feature of this plugin, let’s have a look at a more complex example than the <a href="#simple-example">simple one</a> above.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">movie</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;How many favorite movies do you have?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> movies<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Tell me number </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> titleCtx <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token string">&quot;:text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    movies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>titleCtx<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Here is a better ranking!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  movies<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span>movies<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>m<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">movie</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;How many favorite movies do you have?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> movies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Tell me number </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> titleCtx <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token string">&quot;:text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    movies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>titleCtx<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Here is a better ranking!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  movies<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span>movies<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>m<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>Can you figure out how this bot will work?</p><h2 id="installing-and-entering-a-conversation" tabindex="-1"><a class="header-anchor" href="#installing-and-entering-a-conversation" aria-hidden="true">#</a> Installing and Entering a Conversation</h2><p>First of all, you <strong>must</strong> use the <a href="/plugins/session.html" class="">session plugin</a> if you want to use the conversations plugin. You also have to install the conversations plugin itself, before you can register individual conversations on your bot.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Install the session plugin.</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">initial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// return empty object for now</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Install the conversations plugin.</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">conversations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Next, you can install the conversation builder function as middleware on your bot object by wrapping it inside <code>create<wbr>Conversation</code>.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createConversation</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Now that your conversation is registered on the bot, you can enter the conversation from any handler. Make sure to use <code>await</code> for all methods on <code>ctx<wbr>.conversation</code>—otherwise your code will break.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;greeting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As soon as the user sends <code>/start</code> to the bot, the conversation will be entered. The current context object is passed as the second argument to the conversation builder function. For example, if you start your conversation with <code>await ctx<wbr>.reply(ctx<wbr>.message<wbr>.text)</code>, it will contain the update that contains <code>/start</code>.</p><div class="custom-container tip"><p class="custom-container-title">Change the Conversation Identifier</p><p>By default, you have to pass the name of the function to <code>ctx<wbr>.conversation<wbr>.enter()</code>. However, if you prefer to use a different identifier, you can specify it like so:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createConversation</span><span class="token punctuation">(</span>greeting<span class="token punctuation">,</span> <span class="token string">&quot;new-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>In turn, you can enter the conversation with it:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;new-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>In total, your code should now roughly look like this:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Deno</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Bot<span class="token punctuation">,</span> Context<span class="token punctuation">,</span> session <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;grammy&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> <span class="token class-name">Conversation</span><span class="token punctuation">,</span>
  <span class="token keyword">type</span> <span class="token class-name">ConversationFlavor</span><span class="token punctuation">,</span>
  conversations<span class="token punctuation">,</span>
  createConversation<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@grammyjs/conversations&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">MyContext</span> <span class="token operator">=</span> Context <span class="token operator">&amp;</span> ConversationFlavor<span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">MyConversation</span> <span class="token operator">=</span> Conversation<span class="token operator">&lt;</span>MyContext<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bot<span class="token operator">&lt;</span>MyContext<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">initial</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">conversations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** Defines the conversation */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO: code the conversation</span>
<span class="token punctuation">}</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createConversation</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// enter the function &quot;greeting&quot; you declared</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;greeting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Bot<span class="token punctuation">,</span> Context<span class="token punctuation">,</span> session <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;grammy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
  conversations<span class="token punctuation">,</span>
  createConversation<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@grammyjs/conversations&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bot</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">initial</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">conversations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** Defines the conversation */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO: code the conversation</span>
<span class="token punctuation">}</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createConversation</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// enter the function &quot;greeting&quot; you declared</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;greeting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Bot<span class="token punctuation">,</span> Context<span class="token punctuation">,</span> session <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://deno.land/x/grammy@v1.11.1/mod.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> <span class="token class-name">Conversation</span><span class="token punctuation">,</span>
  <span class="token keyword">type</span> <span class="token class-name">ConversationFlavor</span><span class="token punctuation">,</span>
  conversations<span class="token punctuation">,</span>
  createConversation<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://deno.land/x/grammy_conversations@v1.0.3/mod.ts&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">MyContext</span> <span class="token operator">=</span> Context <span class="token operator">&amp;</span> ConversationFlavor<span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">MyConversation</span> <span class="token operator">=</span> Conversation<span class="token operator">&lt;</span>MyContext<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bot<span class="token operator">&lt;</span>MyContext<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">initial</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">conversations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** Defines the conversation */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO: code the conversation</span>
<span class="token punctuation">}</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createConversation</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// enter the function &quot;greeting&quot; you declared</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;greeting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><h2 id="leaving-a-conversation" tabindex="-1"><a class="header-anchor" href="#leaving-a-conversation" aria-hidden="true">#</a> Leaving a Conversation</h2><p>The conversation will run until your conversation builder function completes. This means that you can simply leave a conversation by using <code>return</code>.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">hiAndBye</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Hi! And Bye!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Leave the conversation:</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">hiAndBye</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Hi! And Bye!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Leave the conversation:</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>(Yes, putting a <code>return</code> at the end of the function is a bit pointless, but you get the idea.)</p><p>You can also throw an error. This will likewise exit the conversation. Remember to <a href="/guide/errors.html" class="">install an error handler</a> on your bot.</p><p>If you want to hard-kill the conversation while it is waiting for user input, you can also use <code>await ctx<wbr>.conversation<wbr>.exit()</code>. It’s often better to stick with simply returning from the function, but there are a few examples where using <code>await ctx<wbr>.conversation<wbr>.exit()</code> is convenient. Remember that you must <code>await</code> the call.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">movie</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO: code the conversation</span>
<span class="token punctuation">}</span>

<span class="token comment">// Install the conversations plugin.</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">conversations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Always exit any conversation upon /cancel</span>
bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;cancel&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Leaving.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Always exit the `movie` conversation </span>
<span class="token comment">// when the inline keyboard&#39;s `cancel` button is pressed.</span>
bot<span class="token punctuation">.</span><span class="token function">callbackQuery</span><span class="token punctuation">(</span><span class="token string">&quot;cancel&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">answerCallbackQuery</span><span class="token punctuation">(</span><span class="token string">&quot;Left conversation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">&quot;movie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createConversation</span><span class="token punctuation">(</span>movie<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;movie&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;movie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">movie</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO: code the conversation</span>
<span class="token punctuation">}</span>

<span class="token comment">// Install the conversations plugin.</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">conversations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Always exit any conversation upon /cancel</span>
bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;cancel&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Leaving.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Always exit the `movie` conversation </span>
<span class="token comment">// when the inline keyboard&#39;s `cancel` button is pressed.</span>
bot<span class="token punctuation">.</span><span class="token function">callbackQuery</span><span class="token punctuation">(</span><span class="token string">&quot;cancel&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">answerCallbackQuery</span><span class="token punctuation">(</span><span class="token string">&quot;Left conversation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">&quot;movie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createConversation</span><span class="token punctuation">(</span>movie<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;movie&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;movie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>Note that the order matters here. You must first install the conversations plugin (line 6) before you can call <code>await ctx<wbr>.conversation<wbr>.exit()</code>. Also, the generic cancel handlers must be installed before the actual conversations (line 21) are registered.</p><h2 id="waiting-for-updates" tabindex="-1"><a class="header-anchor" href="#waiting-for-updates" aria-hidden="true">#</a> Waiting for Updates</h2><p>You can use the conversation handle <code>conversation</code> to wait for the next update in this particular chat.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">waitForMe</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Wait for the next update:</span>
  <span class="token keyword">const</span> newContext <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">waitForMe</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Wait for the next update:</span>
  <span class="token keyword">const</span> newContext <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>An update can mean that a text message was sent, or a button was pressed, or something was edited, or virtually any other action was performed by the user. Check out the full list in the Telegram docs <a href="https://core.telegram.org/bots/api#update" target="_blank" rel="noopener noreferrer">here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>Usually, outside of the conversations plugin, each of these updates would be handled by the <a href="/guide/middleware.html" class="">middleware system</a> of your bot. Hence, your bot would handle the update via a context object which gets passed to your handlers.</p><p>In conversations, you will obtain this new context object from the <code>wait</code> call. In turn, you can handle different updates differently based on this object. For example, you can check for text messages:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">waitForText</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Wait for the next update:</span>
  ctx <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Check for text:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>message<span class="token operator">?.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">waitForText</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Wait for the next update:</span>
  ctx <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Check for text:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>message<span class="token operator">?.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>In addition, there are a number of other methods alongside <code>wait</code> that let you wait for specific updates only. One example is <code>wait<wbr>For</code> which takes a <a href="/guide/filter-queries.html" class="">filter query</a> and then only waits for updates that match the provided query. This is especially powerful in combination with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" target="_blank" rel="noopener noreferrer">object destructuring<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">waitForText</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Wait for the next text message update:</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> msg<span class="token operator">:</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token string">&quot;message:text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">waitForText</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Wait for the next text message update:</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token string">&quot;message:text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>Check out the <a href="https://doc.deno.land/https://deno.land/x/grammy_conversations/mod.ts/~/ConversationHandle#wait" target="_blank" rel="noopener noreferrer">API reference<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to see all available methods that are similar to <code>wait</code>.</p><h2 id="three-golden-rules-of-conversations" tabindex="-1"><a class="header-anchor" href="#three-golden-rules-of-conversations" aria-hidden="true">#</a> Three Golden Rules of Conversations</h2><p>There are three rules that apply to the code you write inside a conversation builder function. You must follow them if you want your code to behave correctly.</p><p>Scroll <a href="#how-it-works">down</a> if you want to know more about <em>why</em> these rules apply, and what <code>wait</code> calls really do internally.</p><h3 id="rule-i-all-side-effects-must-be-wrapped" tabindex="-1"><a class="header-anchor" href="#rule-i-all-side-effects-must-be-wrapped" aria-hidden="true">#</a> Rule I: All Side-effects Must Be Wrapped</h3><p>Code that depends on external system such as databases, APIs, files, or other resources which could change from one execution to the next must be wrapped in <code>conversation<wbr>.external()</code> calls.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// BAD</span>
<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">externalApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// GOOD</span>
<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">external</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">externalApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This includes both reading data, as well as performing side-effects (such as writing to a database).</p><div class="custom-container tip"><p class="custom-container-title">Comparable to React</p><p>If you are familiar with React, you may know a comparable concept from <code>use<wbr>Effect</code>.</p></div><h3 id="rule-ii-all-random-behavior-must-be-wrapped" tabindex="-1"><a class="header-anchor" href="#rule-ii-all-random-behavior-must-be-wrapped" aria-hidden="true">#</a> Rule II: All Random Behavior Must Be Wrapped</h3><p>Code that depends on randomness or on global state which could change, must wrap all access to it in <code>conversation<wbr>.external()</code> calls, or use the <code>conversation<wbr>.random()</code> convenience function.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// BAD</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* do stuff */</span> <span class="token punctuation">}</span>
<span class="token comment">// GOOD</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>conversation<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* do stuff */</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rule-iii-use-convenience-functions" tabindex="-1"><a class="header-anchor" href="#rule-iii-use-convenience-functions" aria-hidden="true">#</a> Rule III: Use Convenience Functions</h3><p>There are a bunch of things installed on <code>conversation</code> which may greatly help you. Your code doesn’t exactly break if you don’t use them, but it can be slow or behave in a confusing way. The end user might not notice a difference, though.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Sleep via conversation, massive performance improvement</span>
<span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3 seconds</span>

<span class="token comment">// Debug logging via conversation, does not print confusing logs</span>
conversation<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note that you can do all of the above via <code>conversation<wbr>.external()</code>, but this can be tedious to type, so it’s just easier to use the convenience functions (<a href="https://doc.deno.land/https://deno.land/x/grammy_conversations/mod.ts/~/ConversationHandle#Methods" target="_blank" rel="noopener noreferrer">API reference<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>).</p><h2 id="variables-branching-and-loops" tabindex="-1"><a class="header-anchor" href="#variables-branching-and-loops" aria-hidden="true">#</a> Variables, Branching, and Loops</h2><p>If you follow the three rules above, you are completely free to use any code you like. We will now go through a few concepts that you already know from programming, and show how they translate to clean and readable conversations.</p><p>Imagine that all code below is written inside a conversation builder function.</p><p>You can declare variables and do whatever you want with them:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Send me your favorite numbers, separated by commas!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token string">&quot;message:text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sum <span class="token operator">=</span> message<span class="token punctuation">.</span>text
  <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;The sum of these numbers is: &quot;</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Branching works, too:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Send me a photo!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token operator">?.</span>photo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;That is not a photo! I&#39;m out!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>So do loops:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">do</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Send me a photo!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>message<span class="token operator">?.</span>text <span class="token operator">===</span> <span class="token string">&quot;/cancel&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Cancelled, leaving!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>ctx<span class="token punctuation">.</span>message<span class="token operator">?.</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="functions-and-recursion" tabindex="-1"><a class="header-anchor" href="#functions-and-recursion" aria-hidden="true">#</a> Functions and Recursion</h2><p>You can also split up your code in several functions, and reuse them. For example, this is how you can define a reusable captcha.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">captcha</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Prove you are human! What is the answer to everything?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> message<span class="token operator">?.</span>text <span class="token operator">===</span> <span class="token string">&quot;42&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">captcha</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Prove you are human! What is the answer to everything?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> message<span class="token operator">?.</span>text <span class="token operator">===</span> <span class="token string">&quot;42&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>It returns <code>true</code> if the user may pass, and <code>false</code> otherwise. You can now use it in your main conversation builder function like this:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">enterGroup</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ok <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">captcha</span><span class="token punctuation">(</span>conversation<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">banChatMember</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">enterGroup</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ok <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">captcha</span><span class="token punctuation">(</span>conversation<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">banChatMember</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>See how the captcha function can be reused in different places in your code.</p><blockquote><p>This simple example is only meant to illustrate how functions work. In reality, it may work poorly because it only waits for a new update from the respective chat, but without verifying that it actually comes from the same user who joined. If you want to create a real captcha, you may want to use <a href="#parallel-conversations">parallel conversations</a>.</p></blockquote><p>If you want, you can also split your code across even more functions, or use recursion, mutual recursion, generators, and so on. (Just make sure that all functions follow the <a href="#three-golden-rules-of-conversations">three rules</a>.)</p><p>Naturally, you can use error handling in your functions, too. Regular <code>try</code>/<code>catch</code> statements work just fine, also across functions. After all, conversations are just JavaScript.</p><p>If the main conversation function throws an error, the error will propagate further into the <a href="/guide/errors.html" class="">error handling mechanisms</a> of your bot.</p><h2 id="modules-and-classes" tabindex="-1"><a class="header-anchor" href="#modules-and-classes" aria-hidden="true">#</a> Modules and Classes</h2><p>Naturally, you can just move your functions across modules. That way, you can define some functions in one file, <code>export</code> them, and then <code>import</code> and use them in another file.</p><p>If you want, you can also define classes.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Auth</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> token<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">authenticate</span><span class="token punctuation">(</span>ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> link <span class="token operator">=</span> <span class="token function">getAuthLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// get auth link from your system</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span>
      <span class="token string">&quot;Open this link to obtain a token, and sent it back to me: &quot;</span> <span class="token operator">+</span> link<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>token <span class="token operator">=</span> ctx<span class="token punctuation">.</span>message<span class="token operator">?.</span>text<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span> <span class="token keyword">is</span> Auth <span class="token operator">&amp;</span> <span class="token punctuation">{</span> token<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>token <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">askForToken</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Auth</span><span class="token punctuation">(</span>conversation<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> auth<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>auth<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> auth<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
    <span class="token comment">// do stuff with token</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Auth</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">conversation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#conversation <span class="token operator">=</span> conversation<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> link <span class="token operator">=</span> <span class="token function">getAuthLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// get auth link from your system</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span>
      <span class="token string">&quot;Open this link to obtain a token, and sent it back to me: &quot;</span> <span class="token operator">+</span> link<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#conversation<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>token <span class="token operator">=</span> ctx<span class="token punctuation">.</span>message<span class="token operator">?.</span>text<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>token <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">askForToken</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Auth</span><span class="token punctuation">(</span>conversation<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> auth<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>auth<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> auth<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
    <span class="token comment">// do stuff with token</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>The point here is not so much that we strictly recommend you to do this. It is rather meant as an example for how you can use the endless flexibilities of JavaScript to structure your code.</p><h2 id="forms" tabindex="-1"><a class="header-anchor" href="#forms" aria-hidden="true">#</a> Forms</h2><p>As mentioned <a href="#waiting-for-updates">earlier</a>, there are several different utility functions on the conversation handle, such as <code>await conversation<wbr>.wait<wbr>For(&#39;message:<wbr>text&#39;)</code> which only returns text message updates.</p><p>If these methods are not enough, the conversations plugin provides even more helper functions for building forms via <code>conversation<wbr>.form</code>.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">waitForMe</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;How old are you?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">waitForMe</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;How old are you?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>As always, check out the <a href="https://doc.deno.land/https://deno.land/x/grammy_conversations/mod.ts/~/ConversationForm" target="_blank" rel="noopener noreferrer">API reference<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to see which methods are available.</p><h2 id="parallel-conversations" tabindex="-1"><a class="header-anchor" href="#parallel-conversations" aria-hidden="true">#</a> Parallel Conversations</h2><p>Naturally, the conversations plugin can run any number of conversations in parallel in different chats.</p><p>However, if your bot gets added to a group chat, it may want to have conversations with several different users in parallel <em>in the same chat</em>. For example, if your bot features a captcha that it wants to send to all new members. If two members join at the same time, the bot should be able to have two independent conversations with them.</p><p>This is why the conversations plugin allows you to enter several conversations at the same time for every chat. For instance, it is possible to have five different conversations with five new users, and at the same time chat with an admin about new chat config.</p><h3 id="how-it-works-behind-the-scenes" tabindex="-1"><a class="header-anchor" href="#how-it-works-behind-the-scenes" aria-hidden="true">#</a> How It Works Behind the Scenes</h3><p>Every incoming update will only be handled by one of the active conversations in a chat. Comparable to middleware handlers, the conversations will be called in the order they are registered. If a conversation is started multiple times, these instances of the conversation will be called in chronological order.</p><p>Each conversation can then either handle the update, or it can call <code>await conversation<wbr>.skip()</code>. In the former case, the update will simply be consumed while the conversation is handling it. In the latter case, the conversation will effectively undo receiving the update, and pass it on to the next conversation. If all conversations skip an update, the control flow will be passed back to the middleware system, and run any subsequent handlers.</p><p>This allows you to start a new conversation from the regular middleware.</p><h3 id="how-you-can-use-it" tabindex="-1"><a class="header-anchor" href="#how-you-can-use-it" aria-hidden="true">#</a> How You Can Use It</h3><p>In practice, you never really need to call <code>await conversation<wbr>.skip()</code> at all. Instead, you can just use things like <code>await conversation<wbr>.wait<wbr>From(user<wbr>Id)</code>, which will take care of the details for you. This allows you to chat with a single user only in a group chat.</p><p>For instance, let’s implement the captcha example from up here again, but this time with parallel conversations.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">captcha</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>from <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Prove you are human! What is the answer to everything?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">waitFrom</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> message<span class="token operator">?.</span>text <span class="token operator">===</span> <span class="token string">&quot;42&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">enterGroup</span><span class="token punctuation">(</span>conversation<span class="token operator">:</span> MyConversation<span class="token punctuation">,</span> ctx<span class="token operator">:</span> MyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ok <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">captcha</span><span class="token punctuation">(</span>conversation<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">banChatMember</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">captcha</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>from <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Prove you are human! What is the answer to everything?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> conversation<span class="token punctuation">.</span><span class="token function">waitFrom</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> message<span class="token operator">?.</span>text <span class="token operator">===</span> <span class="token string">&quot;42&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">enterGroup</span><span class="token punctuation">(</span><span class="token parameter">conversation<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ok <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">captcha</span><span class="token punctuation">(</span>conversation<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">banChatMember</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>Note how we only wait for messages from a particular user.</p><p>We can now have a simple handler that enters the conversation when a new member joins.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;chat_member&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>chatMember<span class="token punctuation">.</span>old_chat_member<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;left&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>chatMember<span class="token punctuation">.</span>new_chat_member<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;member&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token string">&quot;enterGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="inspecting-active-conversations" tabindex="-1"><a class="header-anchor" href="#inspecting-active-conversations" aria-hidden="true">#</a> Inspecting Active Conversations</h3><p>You can see how many conversations with which identifier are running.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> stats <span class="token operator">=</span> ctx<span class="token punctuation">.</span>conversation<span class="token punctuation">.</span>active<span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { &quot;enterGroup&quot;: 1 }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>This will be provided as an object that has the conversation identifiers as keys, and a number indicating the number of running conversations for each identifier.</p><h2 id="how-it-works" tabindex="-1"><a class="header-anchor" href="#how-it-works" aria-hidden="true">#</a> How It Works</h2><blockquote><p><a href="#three-golden-rules-of-conversations">Remember</a> that the code inside your conversation builder functions must follow three rules. We are now going to see <em>why</em> you need to build them that way.</p></blockquote><p>We are first going to see how this plugin works conceptually, before we elaborate on some details.</p><h3 id="how-wait-calls-work" tabindex="-1"><a class="header-anchor" href="#how-wait-calls-work" aria-hidden="true">#</a> How <code>wait</code> Calls Work</h3><p>Let us switch perspectives for a while, and ask a question from a plugin developer’s point of view. How to implement a <code>wait</code> call in the plugin?</p><p>The naïve approach to implementing a <code>wait</code> call in the conversations plugin would be to create a new promise, and to wait until the next context object arrives. As soon as it does, we resolve the promise, and the conversation can continue.</p><p>However, this is a bad idea for several reasons.</p><p><strong>Data Loss.</strong> What if your server crashes while waiting for a context object? In that case, we lose all information about the state of the conversation. Basically, the bot loses its train of thought, and the user has to start over. This is a bad and annoying design.</p><p><strong>Blocking.</strong> If wait calls would block until the next update arrives, it means that the middleware execution for the first update can’t complete until the entire conversation completes.</p><ul><li>For built-in polling, this means that no further updates can be processed until the current one is done. Hence, the bot would simply be blocked forever.</li><li>For <a href="/plugins/runner.html" class="">grammY runner</a>, the bot would not be blocked. However, when processing thousands of conversations in parallel with different users, it would consume potentially very large amounts of memory. If many users stop responding, this leaves the bot stuck in the middle of countless conversations.</li><li>Webhooks have their own whole <a href="/guide/deployment-types.html#ending-webhook-requests-in-time" class="">category of problems</a> with long-running middleware.</li></ul><p><strong>State.</strong> On serverless infrastructure such as cloud functions, we cannot actually assume that the same instance handles two subsequent updates from the same user. Hence, if we were to create stateful conversations, they may randomly break all the time, as some <code>wait</code> calls don’t resolve, but some other middleware is suddenly executed. The result is an abundance of random bugs and chaos.</p><p>There are more problems, but you get the idea.</p><p>Consequently, the conversations plugin does things differently. Very differently. As mentioned earlier, <strong>they don’t <em>literally</em> make your bot wait</strong>, even though we can program conversations as if that was the case.</p><p>The conversations plugin tracks the execution of your function. When a wait call is reached, it serializes the state of execution into the session, and safely stores it in a database. When the next update arrives, it first inspects the session data. If it finds that it left off in the middle of a conversation, it deserializes the state of execution, takes your conversation builder function, and replays it up to the point of the last <code>wait</code> call. It then resumes ordinary execution of your function—until the next <code>wait</code> call is reached, and the execution must be halted again.</p><p>What do we mean by the state of execution? In a nutshell, it consists on three things:</p><ol><li>Incoming updates</li><li>Outgoing API calls</li><li>External events and effects, such as randomness or calls to external APIs or databases</li></ol><p>What do we mean by replaying? Replaying simply means calling the function regularly from the start, but when it does things like calling <code>wait</code> or performing API calls, we don’t actually do any of those. Instead, we check out or logs where we recorded from a previous run which values were returned. We then inject these values so that the conversation builder function simply runs through very fast—until our logs are exhausted. At that point, we switch back to normal execution mode, which is just a fancy way of saying that we stop injecting stuff, and start to actually perform API calls again.</p><p>This is why the plugin has to track all incoming updates as well as all Bot API calls. (See points 1 and 2 above.) However, the plugin has no control over external events, side-effects, or randomness. For example, you could this:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// do one thing</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// do another thing</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In that case, when calling the function, it may suddenly behave differently every time, so replaying the function will break! It could randomly work differently than the original execution. This is why point 3 exists, and the <a href="#three-golden-rules-of-conversations">Three Golden Rules</a> must be followed.</p><h3 id="how-to-intercept-function-execution" tabindex="-1"><a class="header-anchor" href="#how-to-intercept-function-execution" aria-hidden="true">#</a> How to Intercept Function Execution</h3><p>Conceptually speaking, the keywords <code>async</code> and <code>await</code> give us control over where the thread is <a href="https://en.wikipedia.org/wiki/Preemption_(computing)" target="_blank" rel="noopener noreferrer">preempted<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. Hence, if someone calls <code>await conversation<wbr>.wait()</code>, which is a function of our library, we are given the power to preempt the execution.</p><p>Concretely speaking, the secret core primitive that enables us to interrupt function execution is a <code>Promise</code> that never resolves.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">never</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// BOOM</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>If you <code>await</code> such a promise in any JavaScript file, your runtime will terminate instantly. (Feel free to paste the above code into a file and try it out.)</p><p>Since we obviously don’t want to kill the JS runtime, we have to catch this again. How would you go about this? (Feel free to check out the plugin’s source code if this isn’t immediately obvious to you.)</p><h2 id="plugin-summary" tabindex="-1"><a class="header-anchor" href="#plugin-summary" aria-hidden="true">#</a> Plugin Summary</h2><ul><li>Name: <code>conversations</code></li><li>Source: <a href="https://github.com/grammyjs/conversations" target="_blank" rel="noopener noreferrer">https://<wbr>github<wbr>.com<wbr>/grammyjs<wbr>/conversations<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>Reference: <a href="https://doc.deno.land/https://deno.land/x/grammy_conversations/mod.ts" target="_blank" rel="noopener noreferrer">https://<wbr>doc<wbr>.deno<wbr>.land<wbr>/https://<wbr>deno<wbr>.land<wbr>/x<wbr>/grammy<wbr>_conversations<wbr>/mod<wbr>.ts<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/grammyjs/website/edit/main/site/docs/plugins/conversations.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--><span>Edit this page on GitHub <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: git.fytyt@aleeas.com">Ciki Momogi</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: shtrog@gmail.com">KnorpelSenf</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: ez@roj.im">Roj</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 103267335+tonytkachenko@users.noreply.github.com">Tony Tkachenko</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 99770068+sartoshi-foot-dao@users.noreply.github.com">sartoshi-foot-dao</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.34388d32.js" defer></script>
  </body>
</html>
