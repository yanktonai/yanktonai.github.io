<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>中间件 | grammY</title><meta name="description" content="Telegram Bot 框架">
    <link rel="modulepreload" href="/assets/app.81c9d145.js"><link rel="modulepreload" href="/assets/middleware.html.6da491ad.js"><link rel="modulepreload" href="/assets/middleware.html.8e8a095a.js"><link rel="prefetch" href="/assets/index.html.0429b483.js"><link rel="prefetch" href="/assets/index.html.fb39b504.js"><link rel="prefetch" href="/assets/examples.html.4b7b6125.js"><link rel="prefetch" href="/assets/index.html.2401d292.js"><link rel="prefetch" href="/assets/deployment.html.820945fa.js"><link rel="prefetch" href="/assets/flood.html.064205fe.js"><link rel="prefetch" href="/assets/middleware.html.992dcb0e.js"><link rel="prefetch" href="/assets/proxy.html.c404e72a.js"><link rel="prefetch" href="/assets/reliability.html.5a572dfa.js"><link rel="prefetch" href="/assets/scaling.html.fe634161.js"><link rel="prefetch" href="/assets/structuring.html.1e8ebd48.js"><link rel="prefetch" href="/assets/transformers.html.3e1cae77.js"><link rel="prefetch" href="/assets/index.html.e45b3ea7.js"><link rel="prefetch" href="/assets/index.html.172886ab.js"><link rel="prefetch" href="/assets/api.html.d34afc0f.js"><link rel="prefetch" href="/assets/basics.html.65923044.js"><link rel="prefetch" href="/assets/commands.html.c2610c77.js"><link rel="prefetch" href="/assets/context.html.d7289dc7.js"><link rel="prefetch" href="/assets/deployment-types.html.346b4d4f.js"><link rel="prefetch" href="/assets/errors.html.d567f2e9.js"><link rel="prefetch" href="/assets/files.html.5df1fdf3.js"><link rel="prefetch" href="/assets/filter-queries.html.ff3c15e1.js"><link rel="prefetch" href="/assets/games.html.ebb92d65.js"><link rel="prefetch" href="/assets/getting-started.html.3aad9f5a.js"><link rel="prefetch" href="/assets/inline-queries.html.9fa5435e.js"><link rel="prefetch" href="/assets/introduction.html.d062e0ed.js"><link rel="prefetch" href="/assets/middleware.html.c32c1afb.js"><link rel="prefetch" href="/assets/comparison.html.864b515f.js"><link rel="prefetch" href="/assets/deno-deploy.html.33fda6ac.js"><link rel="prefetch" href="/assets/gcf.html.94978e12.js"><link rel="prefetch" href="/assets/heroku.html.f4861855.js"><link rel="prefetch" href="/assets/supabase.html.f931ecc3.js"><link rel="prefetch" href="/assets/vps.html.f8b61457.js"><link rel="prefetch" href="/assets/index.html.564f39e8.js"><link rel="prefetch" href="/assets/index.html.cc711d93.js"><link rel="prefetch" href="/assets/auto-retry.html.76b5ce1b.js"><link rel="prefetch" href="/assets/autoquote.html.f8611f7b.js"><link rel="prefetch" href="/assets/command-filter.html.12deb6e8.js"><link rel="prefetch" href="/assets/console-time.html.bbb18311.js"><link rel="prefetch" href="/assets/conversations.html.542d4ede.js"><link rel="prefetch" href="/assets/emoji.html.96b685bd.js"><link rel="prefetch" href="/assets/files.html.59f0953c.js"><link rel="prefetch" href="/assets/fluent.html.93e75a53.js"><link rel="prefetch" href="/assets/guide.html.4a675f4a.js"><link rel="prefetch" href="/assets/hydrate.html.4d6c9f6e.js"><link rel="prefetch" href="/assets/i18n.html.b886c9b6.js"><link rel="prefetch" href="/assets/keyboard.html.5d3ef392.js"><link rel="prefetch" href="/assets/menu.html.97fd78f5.js"><link rel="prefetch" href="/assets/middlewares.html.4527fc91.js"><link rel="prefetch" href="/assets/parse-mode.html.5fea1fba.js"><link rel="prefetch" href="/assets/ratelimiter.html.09dbf6ad.js"><link rel="prefetch" href="/assets/router.html.02606ebd.js"><link rel="prefetch" href="/assets/runner.html.fb3b00e6.js"><link rel="prefetch" href="/assets/session.html.a3ebd553.js"><link rel="prefetch" href="/assets/stateless-question.html.acdd39e3.js"><link rel="prefetch" href="/assets/transformer-throttler.html.009b0e9c.js"><link rel="prefetch" href="/assets/about.html.e9ce3575.js"><link rel="prefetch" href="/assets/comparison.html.5589e0a7.js"><link rel="prefetch" href="/assets/faq.html.4a46d2bc.js"><link rel="prefetch" href="/assets/index.html.8d516f91.js"><link rel="prefetch" href="/assets/index.html.0ea21131.js"><link rel="prefetch" href="/assets/deployment.html.947cfd03.js"><link rel="prefetch" href="/assets/flood.html.adb704f3.js"><link rel="prefetch" href="/assets/middleware.html.62700685.js"><link rel="prefetch" href="/assets/proxy.html.d9e32858.js"><link rel="prefetch" href="/assets/reliability.html.214116d2.js"><link rel="prefetch" href="/assets/scaling.html.17ebd1a5.js"><link rel="prefetch" href="/assets/structuring.html.b2cc831f.js"><link rel="prefetch" href="/assets/transformers.html.0d715264.js"><link rel="prefetch" href="/assets/index.html.655275db.js"><link rel="prefetch" href="/assets/examples.html.4da510e2.js"><link rel="prefetch" href="/assets/index.html.b68e7c4e.js"><link rel="prefetch" href="/assets/api.html.864221a5.js"><link rel="prefetch" href="/assets/basics.html.d83b67aa.js"><link rel="prefetch" href="/assets/commands.html.0c654628.js"><link rel="prefetch" href="/assets/context.html.684cfc10.js"><link rel="prefetch" href="/assets/deployment-types.html.66bb2eb6.js"><link rel="prefetch" href="/assets/errors.html.3bd197a1.js"><link rel="prefetch" href="/assets/files.html.b3f5719d.js"><link rel="prefetch" href="/assets/filter-queries.html.2fc848b9.js"><link rel="prefetch" href="/assets/games.html.ed2eeb11.js"><link rel="prefetch" href="/assets/getting-started.html.bee7700c.js"><link rel="prefetch" href="/assets/inline-queries.html.3dd234a2.js"><link rel="prefetch" href="/assets/introduction.html.2c38a111.js"><link rel="prefetch" href="/assets/middleware.html.956472a4.js"><link rel="prefetch" href="/assets/comparison.html.62a530ba.js"><link rel="prefetch" href="/assets/deno-deploy.html.9ad88492.js"><link rel="prefetch" href="/assets/gcf.html.dbb08649.js"><link rel="prefetch" href="/assets/heroku.html.1a7f1f38.js"><link rel="prefetch" href="/assets/supabase.html.4ce4dd3e.js"><link rel="prefetch" href="/assets/vps.html.7964c3ff.js"><link rel="prefetch" href="/assets/index.html.d277051d.js"><link rel="prefetch" href="/assets/auto-retry.html.627c099e.js"><link rel="prefetch" href="/assets/autoquote.html.931147c8.js"><link rel="prefetch" href="/assets/command-filter.html.24250ac2.js"><link rel="prefetch" href="/assets/console-time.html.c602475c.js"><link rel="prefetch" href="/assets/conversations.html.34bdf713.js"><link rel="prefetch" href="/assets/emoji.html.4340fe04.js"><link rel="prefetch" href="/assets/files.html.0ce1beed.js"><link rel="prefetch" href="/assets/fluent.html.2312cffa.js"><link rel="prefetch" href="/assets/guide.html.cdc01534.js"><link rel="prefetch" href="/assets/hydrate.html.e78bac27.js"><link rel="prefetch" href="/assets/i18n.html.7a67a704.js"><link rel="prefetch" href="/assets/keyboard.html.6c1187da.js"><link rel="prefetch" href="/assets/menu.html.2390f9b0.js"><link rel="prefetch" href="/assets/middlewares.html.8fb2b4c6.js"><link rel="prefetch" href="/assets/parse-mode.html.6084b065.js"><link rel="prefetch" href="/assets/ratelimiter.html.e9ab9086.js"><link rel="prefetch" href="/assets/router.html.49ad6cc8.js"><link rel="prefetch" href="/assets/runner.html.2e392816.js"><link rel="prefetch" href="/assets/session.html.bc00753b.js"><link rel="prefetch" href="/assets/stateless-question.html.840ef874.js"><link rel="prefetch" href="/assets/transformer-throttler.html.a0519c22.js"><link rel="prefetch" href="/assets/about.html.6acc59e5.js"><link rel="prefetch" href="/assets/comparison.html.19d2b82f.js"><link rel="prefetch" href="/assets/faq.html.525026ef.js"><link rel="prefetch" href="/assets/index.html.c671af3a.js"><link rel="prefetch" href="/assets/deployment.html.890ba700.js"><link rel="prefetch" href="/assets/flood.html.99fc87f0.js"><link rel="prefetch" href="/assets/middleware.html.93e739dc.js"><link rel="prefetch" href="/assets/proxy.html.a206407d.js"><link rel="prefetch" href="/assets/reliability.html.77f11b74.js"><link rel="prefetch" href="/assets/scaling.html.b0186def.js"><link rel="prefetch" href="/assets/structuring.html.431bf13f.js"><link rel="prefetch" href="/assets/transformers.html.76eb6336.js"><link rel="prefetch" href="/assets/index.html.629ca643.js"><link rel="prefetch" href="/assets/examples.html.cea54aec.js"><link rel="prefetch" href="/assets/index.html.374cf0b5.js"><link rel="prefetch" href="/assets/api.html.a789ac69.js"><link rel="prefetch" href="/assets/basics.html.a5f54cb2.js"><link rel="prefetch" href="/assets/commands.html.f5bc337a.js"><link rel="prefetch" href="/assets/context.html.e94c9f2e.js"><link rel="prefetch" href="/assets/deployment-types.html.d3d220f8.js"><link rel="prefetch" href="/assets/errors.html.cb531b7a.js"><link rel="prefetch" href="/assets/files.html.1cbd9c21.js"><link rel="prefetch" href="/assets/filter-queries.html.18865e77.js"><link rel="prefetch" href="/assets/games.html.019dc6f4.js"><link rel="prefetch" href="/assets/getting-started.html.cdb13cc0.js"><link rel="prefetch" href="/assets/inline-queries.html.02267dd2.js"><link rel="prefetch" href="/assets/introduction.html.e8487eb7.js"><link rel="prefetch" href="/assets/middleware.html.beeb4db0.js"><link rel="prefetch" href="/assets/comparison.html.ece5207a.js"><link rel="prefetch" href="/assets/deno-deploy.html.8cd18a25.js"><link rel="prefetch" href="/assets/gcf.html.bf1ad988.js"><link rel="prefetch" href="/assets/heroku.html.200ca6ee.js"><link rel="prefetch" href="/assets/supabase.html.aca1ac1d.js"><link rel="prefetch" href="/assets/vps.html.40de5172.js"><link rel="prefetch" href="/assets/index.html.567ecd8c.js"><link rel="prefetch" href="/assets/auto-retry.html.be745936.js"><link rel="prefetch" href="/assets/autoquote.html.5c46e2d3.js"><link rel="prefetch" href="/assets/command-filter.html.fa1f4413.js"><link rel="prefetch" href="/assets/console-time.html.0d2bc762.js"><link rel="prefetch" href="/assets/conversations.html.778561d7.js"><link rel="prefetch" href="/assets/emoji.html.601be2b6.js"><link rel="prefetch" href="/assets/files.html.13f0053f.js"><link rel="prefetch" href="/assets/fluent.html.47d160d5.js"><link rel="prefetch" href="/assets/guide.html.381a5a51.js"><link rel="prefetch" href="/assets/hydrate.html.426ed716.js"><link rel="prefetch" href="/assets/i18n.html.afb30866.js"><link rel="prefetch" href="/assets/keyboard.html.19037e93.js"><link rel="prefetch" href="/assets/menu.html.e70d11ec.js"><link rel="prefetch" href="/assets/middlewares.html.5bc684e5.js"><link rel="prefetch" href="/assets/parse-mode.html.0e2027aa.js"><link rel="prefetch" href="/assets/ratelimiter.html.f1aaea8c.js"><link rel="prefetch" href="/assets/router.html.1476dda9.js"><link rel="prefetch" href="/assets/runner.html.ce50a49c.js"><link rel="prefetch" href="/assets/session.html.fe8e3213.js"><link rel="prefetch" href="/assets/stateless-question.html.b8a43883.js"><link rel="prefetch" href="/assets/transformer-throttler.html.45a66fc5.js"><link rel="prefetch" href="/assets/about.html.4abcfa07.js"><link rel="prefetch" href="/assets/comparison.html.8ed17bd9.js"><link rel="prefetch" href="/assets/faq.html.0dd6c2c4.js"><link rel="prefetch" href="/assets/index.html.45898178.js"><link rel="prefetch" href="/assets/deployment.html.75afc00d.js"><link rel="prefetch" href="/assets/flood.html.71e88b3b.js"><link rel="prefetch" href="/assets/middleware.html.afa5db3b.js"><link rel="prefetch" href="/assets/proxy.html.b70254e4.js"><link rel="prefetch" href="/assets/reliability.html.2858f460.js"><link rel="prefetch" href="/assets/scaling.html.ae951df2.js"><link rel="prefetch" href="/assets/structuring.html.d2ff17dd.js"><link rel="prefetch" href="/assets/transformers.html.6f5b57b6.js"><link rel="prefetch" href="/assets/index.html.74522b16.js"><link rel="prefetch" href="/assets/examples.html.24e682eb.js"><link rel="prefetch" href="/assets/index.html.9de295a7.js"><link rel="prefetch" href="/assets/api.html.8ed7866f.js"><link rel="prefetch" href="/assets/basics.html.7afbeb28.js"><link rel="prefetch" href="/assets/commands.html.131d044b.js"><link rel="prefetch" href="/assets/context.html.f1f04579.js"><link rel="prefetch" href="/assets/deployment-types.html.6efb3c25.js"><link rel="prefetch" href="/assets/errors.html.0c95dbb6.js"><link rel="prefetch" href="/assets/files.html.c53a8155.js"><link rel="prefetch" href="/assets/filter-queries.html.dab2ea34.js"><link rel="prefetch" href="/assets/games.html.60a32e8c.js"><link rel="prefetch" href="/assets/getting-started.html.7d3308dc.js"><link rel="prefetch" href="/assets/inline-queries.html.c644e6f2.js"><link rel="prefetch" href="/assets/introduction.html.2b2e7021.js"><link rel="prefetch" href="/assets/comparison.html.65d3d0d9.js"><link rel="prefetch" href="/assets/deno-deploy.html.b3d0c42c.js"><link rel="prefetch" href="/assets/gcf.html.8a35f9f5.js"><link rel="prefetch" href="/assets/heroku.html.8ba42f90.js"><link rel="prefetch" href="/assets/supabase.html.ee2b455f.js"><link rel="prefetch" href="/assets/vps.html.6fe75bcb.js"><link rel="prefetch" href="/assets/index.html.f9a366b7.js"><link rel="prefetch" href="/assets/auto-retry.html.e870a1fc.js"><link rel="prefetch" href="/assets/autoquote.html.afc82797.js"><link rel="prefetch" href="/assets/command-filter.html.d5692cab.js"><link rel="prefetch" href="/assets/console-time.html.a509e6b6.js"><link rel="prefetch" href="/assets/conversations.html.c2a1214f.js"><link rel="prefetch" href="/assets/emoji.html.346d49b0.js"><link rel="prefetch" href="/assets/files.html.97985794.js"><link rel="prefetch" href="/assets/fluent.html.497a7165.js"><link rel="prefetch" href="/assets/guide.html.6086fd79.js"><link rel="prefetch" href="/assets/hydrate.html.f3bc28bb.js"><link rel="prefetch" href="/assets/i18n.html.42762cf9.js"><link rel="prefetch" href="/assets/keyboard.html.9ccac385.js"><link rel="prefetch" href="/assets/menu.html.05b22f9d.js"><link rel="prefetch" href="/assets/middlewares.html.b0d76949.js"><link rel="prefetch" href="/assets/parse-mode.html.377b539d.js"><link rel="prefetch" href="/assets/ratelimiter.html.f7e73ee7.js"><link rel="prefetch" href="/assets/router.html.401950f2.js"><link rel="prefetch" href="/assets/runner.html.da15a490.js"><link rel="prefetch" href="/assets/session.html.79028198.js"><link rel="prefetch" href="/assets/stateless-question.html.e542bb65.js"><link rel="prefetch" href="/assets/transformer-throttler.html.7d448db6.js"><link rel="prefetch" href="/assets/about.html.41287b90.js"><link rel="prefetch" href="/assets/comparison.html.162bdf02.js"><link rel="prefetch" href="/assets/faq.html.abba6af1.js"><link rel="prefetch" href="/assets/404.html.d2dc3323.js"><link rel="prefetch" href="/assets/index.html.506bd518.js"><link rel="prefetch" href="/assets/index.html.f73e7137.js"><link rel="prefetch" href="/assets/examples.html.94e2f736.js"><link rel="prefetch" href="/assets/index.html.96755d31.js"><link rel="prefetch" href="/assets/deployment.html.e985174c.js"><link rel="prefetch" href="/assets/flood.html.a1265c0a.js"><link rel="prefetch" href="/assets/middleware.html.83138b05.js"><link rel="prefetch" href="/assets/proxy.html.fd74d1ff.js"><link rel="prefetch" href="/assets/reliability.html.45366f2f.js"><link rel="prefetch" href="/assets/scaling.html.a68def9b.js"><link rel="prefetch" href="/assets/structuring.html.7af2fb7d.js"><link rel="prefetch" href="/assets/transformers.html.6fff2dd8.js"><link rel="prefetch" href="/assets/index.html.b496a7ad.js"><link rel="prefetch" href="/assets/index.html.d98f168f.js"><link rel="prefetch" href="/assets/api.html.a64e079e.js"><link rel="prefetch" href="/assets/basics.html.c61949bb.js"><link rel="prefetch" href="/assets/commands.html.88a25c28.js"><link rel="prefetch" href="/assets/context.html.62f529b5.js"><link rel="prefetch" href="/assets/deployment-types.html.66d56fb0.js"><link rel="prefetch" href="/assets/errors.html.ea45d9da.js"><link rel="prefetch" href="/assets/files.html.739b5465.js"><link rel="prefetch" href="/assets/filter-queries.html.94454c9b.js"><link rel="prefetch" href="/assets/games.html.021b514f.js"><link rel="prefetch" href="/assets/getting-started.html.d26fedef.js"><link rel="prefetch" href="/assets/inline-queries.html.9589f2c2.js"><link rel="prefetch" href="/assets/introduction.html.000bbac6.js"><link rel="prefetch" href="/assets/middleware.html.d339e00e.js"><link rel="prefetch" href="/assets/comparison.html.4e9bc257.js"><link rel="prefetch" href="/assets/deno-deploy.html.31e80a4b.js"><link rel="prefetch" href="/assets/gcf.html.50e1f2e2.js"><link rel="prefetch" href="/assets/heroku.html.11a50c3d.js"><link rel="prefetch" href="/assets/supabase.html.596e6499.js"><link rel="prefetch" href="/assets/vps.html.b7685121.js"><link rel="prefetch" href="/assets/index.html.750fa638.js"><link rel="prefetch" href="/assets/index.html.e11cf300.js"><link rel="prefetch" href="/assets/auto-retry.html.a115d028.js"><link rel="prefetch" href="/assets/autoquote.html.17c58163.js"><link rel="prefetch" href="/assets/command-filter.html.234d8353.js"><link rel="prefetch" href="/assets/console-time.html.b1fbedc9.js"><link rel="prefetch" href="/assets/conversations.html.ae4dabdd.js"><link rel="prefetch" href="/assets/emoji.html.8b513841.js"><link rel="prefetch" href="/assets/files.html.393e646e.js"><link rel="prefetch" href="/assets/fluent.html.cd245fde.js"><link rel="prefetch" href="/assets/guide.html.3c1f3f1d.js"><link rel="prefetch" href="/assets/hydrate.html.bb1272a6.js"><link rel="prefetch" href="/assets/i18n.html.5e582da1.js"><link rel="prefetch" href="/assets/keyboard.html.d449b0bc.js"><link rel="prefetch" href="/assets/menu.html.52271b65.js"><link rel="prefetch" href="/assets/middlewares.html.5a3da8fb.js"><link rel="prefetch" href="/assets/parse-mode.html.f0196fcf.js"><link rel="prefetch" href="/assets/ratelimiter.html.36ae8f68.js"><link rel="prefetch" href="/assets/router.html.9dac34b0.js"><link rel="prefetch" href="/assets/runner.html.a5ded8ac.js"><link rel="prefetch" href="/assets/session.html.9e37c174.js"><link rel="prefetch" href="/assets/stateless-question.html.20211588.js"><link rel="prefetch" href="/assets/transformer-throttler.html.4d82eb0f.js"><link rel="prefetch" href="/assets/about.html.13d58ed7.js"><link rel="prefetch" href="/assets/comparison.html.fce96edf.js"><link rel="prefetch" href="/assets/faq.html.ecd9df48.js"><link rel="prefetch" href="/assets/index.html.06962d44.js"><link rel="prefetch" href="/assets/index.html.ff01e651.js"><link rel="prefetch" href="/assets/deployment.html.0dbb5973.js"><link rel="prefetch" href="/assets/flood.html.548597e6.js"><link rel="prefetch" href="/assets/middleware.html.bff41f1d.js"><link rel="prefetch" href="/assets/proxy.html.9e2da649.js"><link rel="prefetch" href="/assets/reliability.html.29d5fce2.js"><link rel="prefetch" href="/assets/scaling.html.c202e4e0.js"><link rel="prefetch" href="/assets/structuring.html.3b0ea25b.js"><link rel="prefetch" href="/assets/transformers.html.e9394f28.js"><link rel="prefetch" href="/assets/index.html.164004f5.js"><link rel="prefetch" href="/assets/examples.html.c0335aa0.js"><link rel="prefetch" href="/assets/index.html.16b1273c.js"><link rel="prefetch" href="/assets/api.html.fff4d393.js"><link rel="prefetch" href="/assets/basics.html.4ae43ef7.js"><link rel="prefetch" href="/assets/commands.html.1df83ee6.js"><link rel="prefetch" href="/assets/context.html.b31db3a4.js"><link rel="prefetch" href="/assets/deployment-types.html.85530744.js"><link rel="prefetch" href="/assets/errors.html.2917374b.js"><link rel="prefetch" href="/assets/files.html.b6e890d8.js"><link rel="prefetch" href="/assets/filter-queries.html.2449601c.js"><link rel="prefetch" href="/assets/games.html.f03a0ae7.js"><link rel="prefetch" href="/assets/getting-started.html.5f6ffc21.js"><link rel="prefetch" href="/assets/inline-queries.html.336ff8d1.js"><link rel="prefetch" href="/assets/introduction.html.8a96310f.js"><link rel="prefetch" href="/assets/middleware.html.f7b2716e.js"><link rel="prefetch" href="/assets/comparison.html.c2d31601.js"><link rel="prefetch" href="/assets/deno-deploy.html.68ce180d.js"><link rel="prefetch" href="/assets/gcf.html.65d52c29.js"><link rel="prefetch" href="/assets/heroku.html.372d6c6f.js"><link rel="prefetch" href="/assets/supabase.html.69cb6e23.js"><link rel="prefetch" href="/assets/vps.html.3ca27174.js"><link rel="prefetch" href="/assets/index.html.d1ab1b17.js"><link rel="prefetch" href="/assets/auto-retry.html.43688119.js"><link rel="prefetch" href="/assets/autoquote.html.eab30649.js"><link rel="prefetch" href="/assets/command-filter.html.f91e0fb3.js"><link rel="prefetch" href="/assets/console-time.html.95a60e7a.js"><link rel="prefetch" href="/assets/conversations.html.ac5a9ff2.js"><link rel="prefetch" href="/assets/emoji.html.0ef3b386.js"><link rel="prefetch" href="/assets/files.html.35af7866.js"><link rel="prefetch" href="/assets/fluent.html.576af7e0.js"><link rel="prefetch" href="/assets/guide.html.b55e3396.js"><link rel="prefetch" href="/assets/hydrate.html.9eecaa46.js"><link rel="prefetch" href="/assets/i18n.html.2208938c.js"><link rel="prefetch" href="/assets/keyboard.html.3ce1498a.js"><link rel="prefetch" href="/assets/menu.html.6737f7cd.js"><link rel="prefetch" href="/assets/middlewares.html.e546065e.js"><link rel="prefetch" href="/assets/parse-mode.html.7a0956c8.js"><link rel="prefetch" href="/assets/ratelimiter.html.f506174d.js"><link rel="prefetch" href="/assets/router.html.02dd36cd.js"><link rel="prefetch" href="/assets/runner.html.9ba6959a.js"><link rel="prefetch" href="/assets/session.html.8b2d793e.js"><link rel="prefetch" href="/assets/stateless-question.html.db6ba7fa.js"><link rel="prefetch" href="/assets/transformer-throttler.html.f87ac27e.js"><link rel="prefetch" href="/assets/about.html.e2c928cd.js"><link rel="prefetch" href="/assets/comparison.html.8cd091bd.js"><link rel="prefetch" href="/assets/faq.html.ce4f887d.js"><link rel="prefetch" href="/assets/index.html.76be013c.js"><link rel="prefetch" href="/assets/deployment.html.14717062.js"><link rel="prefetch" href="/assets/flood.html.abac6875.js"><link rel="prefetch" href="/assets/middleware.html.0d5b4708.js"><link rel="prefetch" href="/assets/proxy.html.1899a2cc.js"><link rel="prefetch" href="/assets/reliability.html.cf5f3503.js"><link rel="prefetch" href="/assets/scaling.html.8ec58516.js"><link rel="prefetch" href="/assets/structuring.html.1f9e161c.js"><link rel="prefetch" href="/assets/transformers.html.b1099986.js"><link rel="prefetch" href="/assets/index.html.f669eb78.js"><link rel="prefetch" href="/assets/examples.html.95809395.js"><link rel="prefetch" href="/assets/index.html.d0a555cc.js"><link rel="prefetch" href="/assets/api.html.07ccbe73.js"><link rel="prefetch" href="/assets/basics.html.7a777984.js"><link rel="prefetch" href="/assets/commands.html.4ed48b93.js"><link rel="prefetch" href="/assets/context.html.bc67c69b.js"><link rel="prefetch" href="/assets/deployment-types.html.4caa42a8.js"><link rel="prefetch" href="/assets/errors.html.9b0e8f5d.js"><link rel="prefetch" href="/assets/files.html.7086c0c6.js"><link rel="prefetch" href="/assets/filter-queries.html.6d4c30cf.js"><link rel="prefetch" href="/assets/games.html.1676e5ab.js"><link rel="prefetch" href="/assets/getting-started.html.3fd51b83.js"><link rel="prefetch" href="/assets/inline-queries.html.bf0c3a59.js"><link rel="prefetch" href="/assets/introduction.html.3c83b16f.js"><link rel="prefetch" href="/assets/middleware.html.8012fa3e.js"><link rel="prefetch" href="/assets/comparison.html.dce765eb.js"><link rel="prefetch" href="/assets/deno-deploy.html.a670eb2d.js"><link rel="prefetch" href="/assets/gcf.html.9d10a12e.js"><link rel="prefetch" href="/assets/heroku.html.f6640b6a.js"><link rel="prefetch" href="/assets/supabase.html.f3d63327.js"><link rel="prefetch" href="/assets/vps.html.c24935ca.js"><link rel="prefetch" href="/assets/index.html.ce3e5648.js"><link rel="prefetch" href="/assets/auto-retry.html.3920fc5b.js"><link rel="prefetch" href="/assets/autoquote.html.2d544c6d.js"><link rel="prefetch" href="/assets/command-filter.html.583ef6bb.js"><link rel="prefetch" href="/assets/console-time.html.18f0105c.js"><link rel="prefetch" href="/assets/conversations.html.2018ed45.js"><link rel="prefetch" href="/assets/emoji.html.29403d7e.js"><link rel="prefetch" href="/assets/files.html.6e205a00.js"><link rel="prefetch" href="/assets/fluent.html.14253c82.js"><link rel="prefetch" href="/assets/guide.html.74eef78a.js"><link rel="prefetch" href="/assets/hydrate.html.9410a402.js"><link rel="prefetch" href="/assets/i18n.html.25a0b66a.js"><link rel="prefetch" href="/assets/keyboard.html.4d810fe2.js"><link rel="prefetch" href="/assets/menu.html.cfb1c276.js"><link rel="prefetch" href="/assets/middlewares.html.867fa3c3.js"><link rel="prefetch" href="/assets/parse-mode.html.05c67127.js"><link rel="prefetch" href="/assets/ratelimiter.html.fac2803b.js"><link rel="prefetch" href="/assets/router.html.7bb13568.js"><link rel="prefetch" href="/assets/runner.html.3aceb2cb.js"><link rel="prefetch" href="/assets/session.html.607e1f78.js"><link rel="prefetch" href="/assets/stateless-question.html.ba289af4.js"><link rel="prefetch" href="/assets/transformer-throttler.html.2bc10895.js"><link rel="prefetch" href="/assets/about.html.dd8dd1bd.js"><link rel="prefetch" href="/assets/comparison.html.08a9df49.js"><link rel="prefetch" href="/assets/faq.html.f191f0dd.js"><link rel="prefetch" href="/assets/index.html.e3f1da9f.js"><link rel="prefetch" href="/assets/deployment.html.fd840b2c.js"><link rel="prefetch" href="/assets/flood.html.527bddc9.js"><link rel="prefetch" href="/assets/middleware.html.601f2461.js"><link rel="prefetch" href="/assets/proxy.html.b3f4fd17.js"><link rel="prefetch" href="/assets/reliability.html.de662784.js"><link rel="prefetch" href="/assets/scaling.html.50f1aee4.js"><link rel="prefetch" href="/assets/structuring.html.504ad325.js"><link rel="prefetch" href="/assets/transformers.html.b01cd3a5.js"><link rel="prefetch" href="/assets/index.html.77f24b3c.js"><link rel="prefetch" href="/assets/examples.html.45e1d7a6.js"><link rel="prefetch" href="/assets/index.html.638ef323.js"><link rel="prefetch" href="/assets/api.html.e5cf0e01.js"><link rel="prefetch" href="/assets/basics.html.bf414460.js"><link rel="prefetch" href="/assets/commands.html.6297b0fa.js"><link rel="prefetch" href="/assets/context.html.53f8d3a6.js"><link rel="prefetch" href="/assets/deployment-types.html.ca12af08.js"><link rel="prefetch" href="/assets/errors.html.211a03c8.js"><link rel="prefetch" href="/assets/files.html.5006be4b.js"><link rel="prefetch" href="/assets/filter-queries.html.8f06af7d.js"><link rel="prefetch" href="/assets/games.html.ee8db9b6.js"><link rel="prefetch" href="/assets/getting-started.html.ae61e581.js"><link rel="prefetch" href="/assets/inline-queries.html.56b1e257.js"><link rel="prefetch" href="/assets/introduction.html.bc652fe4.js"><link rel="prefetch" href="/assets/comparison.html.b5915a0a.js"><link rel="prefetch" href="/assets/deno-deploy.html.6f0e3402.js"><link rel="prefetch" href="/assets/gcf.html.278ead85.js"><link rel="prefetch" href="/assets/heroku.html.9708b190.js"><link rel="prefetch" href="/assets/supabase.html.0c245912.js"><link rel="prefetch" href="/assets/vps.html.74227816.js"><link rel="prefetch" href="/assets/index.html.e997bf2c.js"><link rel="prefetch" href="/assets/auto-retry.html.daf50f40.js"><link rel="prefetch" href="/assets/autoquote.html.b16395ae.js"><link rel="prefetch" href="/assets/command-filter.html.f7623237.js"><link rel="prefetch" href="/assets/console-time.html.8ef1305b.js"><link rel="prefetch" href="/assets/conversations.html.eab8c546.js"><link rel="prefetch" href="/assets/emoji.html.4a9bc117.js"><link rel="prefetch" href="/assets/files.html.015d6d74.js"><link rel="prefetch" href="/assets/fluent.html.cbfac932.js"><link rel="prefetch" href="/assets/guide.html.66ddf4cd.js"><link rel="prefetch" href="/assets/hydrate.html.13016f6a.js"><link rel="prefetch" href="/assets/i18n.html.df56fd54.js"><link rel="prefetch" href="/assets/keyboard.html.5c7ecedb.js"><link rel="prefetch" href="/assets/menu.html.6d144122.js"><link rel="prefetch" href="/assets/middlewares.html.8b855ec0.js"><link rel="prefetch" href="/assets/parse-mode.html.93810899.js"><link rel="prefetch" href="/assets/ratelimiter.html.8d10a31f.js"><link rel="prefetch" href="/assets/router.html.37d260a5.js"><link rel="prefetch" href="/assets/runner.html.836a3241.js"><link rel="prefetch" href="/assets/session.html.e6dfe9a3.js"><link rel="prefetch" href="/assets/stateless-question.html.3d5cdbaa.js"><link rel="prefetch" href="/assets/transformer-throttler.html.34ce9ca4.js"><link rel="prefetch" href="/assets/about.html.6e436155.js"><link rel="prefetch" href="/assets/comparison.html.daaaf6fa.js"><link rel="prefetch" href="/assets/faq.html.e1d35ea3.js"><link rel="prefetch" href="/assets/404.html.e1c3fb30.js">
    <link rel="stylesheet" href="/assets/style.e2836941.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/zh/" class=""><img class="logo" src="/Y.png" alt="grammY"><span class="site-name can-hide">grammY</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/zh/guide/" class="router-link-active" aria-label="基础"><!--[--><!--]--><span>基础 <!--v-if--></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="了解"><span class="title">了解</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="了解"><span class="title">了解</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>基础 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/guide/" class="" aria-label="概述"><!--[--><!--]--><span>概述 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/introduction.html" class="" aria-label="简介"><!--[--><!--]--><span>简介 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/getting-started.html" class="" aria-label="入门"><!--[--><!--]--><span>入门 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/basics.html" class="" aria-label="发送和接收消息"><!--[--><!--]--><span>发送和接收消息 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/context.html" class="" aria-label="上下文"><!--[--><!--]--><span>上下文 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/api.html" class="" aria-label="Bot API"><!--[--><!--]--><span>Bot API <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/filter-queries.html" class="" aria-label="Filter 查询与 bot.on()"><!--[--><!--]--><span>Filter 查询与 bot.on() <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/commands.html" class="" aria-label="Commands"><!--[--><!--]--><span>Commands <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/zh/guide/middleware.html" class="router-link-active router-link-exact-active router-link-active" aria-label="中间件"><!--[--><!--]--><span>中间件 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/errors.html" class="" aria-label="错误处理"><!--[--><!--]--><span>错误处理 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/inline-queries.html" class="" aria-label="Inline Queries"><!--[--><!--]--><span>Inline Queries <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/files.html" class="" aria-label="文件管理"><!--[--><!--]--><span>文件管理 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/games.html" class="" aria-label="游戏"><!--[--><!--]--><span>游戏 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/deployment-types.html" class="" aria-label="长轮询 vs. Webhooks"><!--[--><!--]--><span>长轮询 vs. Webhooks <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>进阶 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/advanced/" class="" aria-label="概述"><!--[--><!--]--><span>概述 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/middleware.html" class="" aria-label="重构中间件"><!--[--><!--]--><span>重构中间件 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/structuring.html" class="" aria-label="I: 代码组织"><!--[--><!--]--><span>I: 代码组织 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/scaling.html" class="" aria-label="II: 高负载"><!--[--><!--]--><span>II: 高负载 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/reliability.html" class="" aria-label="III: 可靠性"><!--[--><!--]--><span>III: 可靠性 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/flood.html" class="" aria-label="IV: 流量限制"><!--[--><!--]--><span>IV: 流量限制 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/transformers.html" class="" aria-label="Bot API Transformers"><!--[--><!--]--><span>Bot API Transformers <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/proxy.html" class="" aria-label="代理支持"><!--[--><!--]--><span>代理支持 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/deployment.html" class="" aria-label="部署"><!--[--><!--]--><span>部署 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="插件"><span class="title">插件</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="插件"><span class="title">插件</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>简介 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/plugins/" class="" aria-label="关于插件"><!--[--><!--]--><span>关于插件 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/guide.html" class="" aria-label="如何编写一个插件"><!--[--><!--]--><span>如何编写一个插件 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>内置插件 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/plugins/session.html" class="" aria-label="会话与数据储存"><!--[--><!--]--><span>会话与数据储存 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/keyboard.html" class="" aria-label="Inline 与自定义 Keyboards"><!--[--><!--]--><span>Inline 与自定义 Keyboards <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>官方维护 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/plugins/conversations.html" class="" aria-label="对话 (conversations)"><!--[--><!--]--><span>对话 (conversations) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/menu.html" class="" aria-label="互动菜单 (menu)"><!--[--><!--]--><span>互动菜单 (menu) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/stateless-question.html" class="" aria-label="无状态问题 (stateless-question)"><!--[--><!--]--><span>无状态问题 (stateless-question) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/runner.html" class="" aria-label="并发 (runner)"><!--[--><!--]--><span>并发 (runner) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/hydrate.html" class="" aria-label="Hydration (hydrate)"><!--[--><!--]--><span>Hydration (hydrate) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/auto-retry.html" class="" aria-label="重试 API 请求 (auto-retry)"><!--[--><!--]--><span>重试 API 请求 (auto-retry) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/transformer-throttler.html" class="" aria-label="流量控制 (transformer-throttler)"><!--[--><!--]--><span>流量控制 (transformer-throttler) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/ratelimiter.html" class="" aria-label="限制用户速率 (ratelimiter)"><!--[--><!--]--><span>限制用户速率 (ratelimiter) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/files.html" class="" aria-label="文件助手 (files)"><!--[--><!--]--><span>文件助手 (files) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/i18n.html" class="" aria-label="国际化 (i18n)"><!--[--><!--]--><span>国际化 (i18n) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/fluent.html" class="" aria-label="国际化 (fluent)"><!--[--><!--]--><span>国际化 (fluent) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/router.html" class="" aria-label="路由器 (router)"><!--[--><!--]--><span>路由器 (router) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/emoji.html" class="" aria-label="Emoji (emoji)"><!--[--><!--]--><span>Emoji (emoji) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/parse-mode.html" class="" aria-label="解析模式 (parse-mode)"><!--[--><!--]--><span>解析模式 (parse-mode) <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>第三方 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/plugins/console-time.html" class="" aria-label="调试时输出日志"><!--[--><!--]--><span>调试时输出日志 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/middlewares.html" class="" aria-label="有用的中间件"><!--[--><!--]--><span>有用的中间件 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/autoquote.html" class="" aria-label="自动引用"><!--[--><!--]--><span>自动引用 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/#创建你自己的插件" class="" aria-label="[等待你的 PR!]"><!--[--><!--]--><span>[等待你的 PR!] <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="示例"><span class="title">示例</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="示例"><span class="title">示例</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>示例 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://github.com/grammyjs/awesome-grammY" rel="noopener noreferrer" target="_blank" aria-label="Awesome grammY"><!--[--><!--]--><span>Awesome grammY <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://github.com/grammyjs/examples" rel="noopener noreferrer" target="_blank" aria-label="示例 Bots 仓库"><!--[--><!--]--><span>示例 Bots 仓库 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="资源"><span class="title">资源</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="资源"><span class="title">资源</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>grammY <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/resources/about.html" class="" aria-label="关于 grammY"><!--[--><!--]--><span>关于 grammY <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs" rel="noopener noreferrer" target="_blank" aria-label="社区聊天（英语）"><!--[--><!--]--><span>社区聊天（英语） <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs_ru" rel="noopener noreferrer" target="_blank" aria-label="社区聊天（俄语）"><!--[--><!--]--><span>社区聊天（俄语） <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs_news" rel="noopener noreferrer" target="_blank" aria-label="咨询"><!--[--><!--]--><span>咨询 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://twitter.com/grammy_js" rel="noopener noreferrer" target="_blank" aria-label="Twitter"><!--[--><!--]--><span>Twitter <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/resources/faq.html" class="" aria-label="FAQ"><!--[--><!--]--><span>FAQ <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/resources/comparison.html" class="" aria-label="与其他框架的比较"><!--[--><!--]--><span>与其他框架的比较 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Telegram <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots" rel="noopener noreferrer" target="_blank" aria-label="面向开发者的介绍"><!--[--><!--]--><span>面向开发者的介绍 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/faq" rel="noopener noreferrer" target="_blank" aria-label="Bots FAQ"><!--[--><!--]--><span>Bots FAQ <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/api" rel="noopener noreferrer" target="_blank" aria-label="Bot API 概览"><!--[--><!--]--><span>Bot API 概览 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/webhooks#testing-your-bot-with-updates" rel="noopener noreferrer" target="_blank" aria-label="Updates 示例"><!--[--><!--]--><span>Updates 示例 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="托管服务"><span class="title">托管服务</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="托管服务"><span class="title">托管服务</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>总览 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/hosting/comparison.html" class="" aria-label="对比"><!--[--><!--]--><span>对比 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>教程 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/hosting/deno-deploy.html" class="" aria-label="Deno Deploy"><!--[--><!--]--><span>Deno Deploy <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/hosting/supabase.html" class="" aria-label="Supabase Edge Functions"><!--[--><!--]--><span>Supabase Edge Functions <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/hosting/heroku.html" class="" aria-label="Heroku"><!--[--><!--]--><span>Heroku <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/hosting/gcf.html" class="" aria-label="Google Cloud Functions"><!--[--><!--]--><span>Google Cloud Functions <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/hosting/vps.html" class="" aria-label="Virtual Private Server"><!--[--><!--]--><span>Virtual Private Server <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://doc.deno.land/https://deno.land/x/grammy/mod.ts" rel="noopener noreferrer" target="_blank" aria-label="API 参考"><!--[--><!--]--><span>API 参考 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">语言</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">语言</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><a href="/guide/middleware.html" class="" aria-label="English"><!--[--><!--]--><span>English <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/guide/middleware.html" class="" aria-label="Español"><!--[--><!--]--><span>Español <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/guide/middleware.html" class="" aria-label="Indonesia"><!--[--><!--]--><span>Indonesia <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/zh/guide/middleware.html" class="router-link-active router-link-exact-active router-link-active" aria-label="简体中文"><!--[--><!--]--><span>简体中文 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/grammyjs/grammY" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--><span>GitHub <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/zh/guide/" class="router-link-active" aria-label="基础"><!--[--><!--]--><span>基础 <!--v-if--></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="了解"><span class="title">了解</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="了解"><span class="title">了解</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>基础 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/guide/" class="" aria-label="概述"><!--[--><!--]--><span>概述 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/introduction.html" class="" aria-label="简介"><!--[--><!--]--><span>简介 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/getting-started.html" class="" aria-label="入门"><!--[--><!--]--><span>入门 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/basics.html" class="" aria-label="发送和接收消息"><!--[--><!--]--><span>发送和接收消息 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/context.html" class="" aria-label="上下文"><!--[--><!--]--><span>上下文 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/api.html" class="" aria-label="Bot API"><!--[--><!--]--><span>Bot API <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/filter-queries.html" class="" aria-label="Filter 查询与 bot.on()"><!--[--><!--]--><span>Filter 查询与 bot.on() <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/commands.html" class="" aria-label="Commands"><!--[--><!--]--><span>Commands <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/zh/guide/middleware.html" class="router-link-active router-link-exact-active router-link-active" aria-label="中间件"><!--[--><!--]--><span>中间件 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/errors.html" class="" aria-label="错误处理"><!--[--><!--]--><span>错误处理 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/inline-queries.html" class="" aria-label="Inline Queries"><!--[--><!--]--><span>Inline Queries <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/files.html" class="" aria-label="文件管理"><!--[--><!--]--><span>文件管理 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/games.html" class="" aria-label="游戏"><!--[--><!--]--><span>游戏 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/guide/deployment-types.html" class="" aria-label="长轮询 vs. Webhooks"><!--[--><!--]--><span>长轮询 vs. Webhooks <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>进阶 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/advanced/" class="" aria-label="概述"><!--[--><!--]--><span>概述 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/middleware.html" class="" aria-label="重构中间件"><!--[--><!--]--><span>重构中间件 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/structuring.html" class="" aria-label="I: 代码组织"><!--[--><!--]--><span>I: 代码组织 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/scaling.html" class="" aria-label="II: 高负载"><!--[--><!--]--><span>II: 高负载 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/reliability.html" class="" aria-label="III: 可靠性"><!--[--><!--]--><span>III: 可靠性 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/flood.html" class="" aria-label="IV: 流量限制"><!--[--><!--]--><span>IV: 流量限制 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/transformers.html" class="" aria-label="Bot API Transformers"><!--[--><!--]--><span>Bot API Transformers <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/proxy.html" class="" aria-label="代理支持"><!--[--><!--]--><span>代理支持 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/advanced/deployment.html" class="" aria-label="部署"><!--[--><!--]--><span>部署 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="插件"><span class="title">插件</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="插件"><span class="title">插件</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>简介 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/plugins/" class="" aria-label="关于插件"><!--[--><!--]--><span>关于插件 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/guide.html" class="" aria-label="如何编写一个插件"><!--[--><!--]--><span>如何编写一个插件 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>内置插件 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/plugins/session.html" class="" aria-label="会话与数据储存"><!--[--><!--]--><span>会话与数据储存 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/keyboard.html" class="" aria-label="Inline 与自定义 Keyboards"><!--[--><!--]--><span>Inline 与自定义 Keyboards <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>官方维护 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/plugins/conversations.html" class="" aria-label="对话 (conversations)"><!--[--><!--]--><span>对话 (conversations) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/menu.html" class="" aria-label="互动菜单 (menu)"><!--[--><!--]--><span>互动菜单 (menu) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/stateless-question.html" class="" aria-label="无状态问题 (stateless-question)"><!--[--><!--]--><span>无状态问题 (stateless-question) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/runner.html" class="" aria-label="并发 (runner)"><!--[--><!--]--><span>并发 (runner) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/hydrate.html" class="" aria-label="Hydration (hydrate)"><!--[--><!--]--><span>Hydration (hydrate) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/auto-retry.html" class="" aria-label="重试 API 请求 (auto-retry)"><!--[--><!--]--><span>重试 API 请求 (auto-retry) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/transformer-throttler.html" class="" aria-label="流量控制 (transformer-throttler)"><!--[--><!--]--><span>流量控制 (transformer-throttler) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/ratelimiter.html" class="" aria-label="限制用户速率 (ratelimiter)"><!--[--><!--]--><span>限制用户速率 (ratelimiter) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/files.html" class="" aria-label="文件助手 (files)"><!--[--><!--]--><span>文件助手 (files) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/i18n.html" class="" aria-label="国际化 (i18n)"><!--[--><!--]--><span>国际化 (i18n) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/fluent.html" class="" aria-label="国际化 (fluent)"><!--[--><!--]--><span>国际化 (fluent) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/router.html" class="" aria-label="路由器 (router)"><!--[--><!--]--><span>路由器 (router) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/emoji.html" class="" aria-label="Emoji (emoji)"><!--[--><!--]--><span>Emoji (emoji) <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/parse-mode.html" class="" aria-label="解析模式 (parse-mode)"><!--[--><!--]--><span>解析模式 (parse-mode) <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>第三方 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/plugins/console-time.html" class="" aria-label="调试时输出日志"><!--[--><!--]--><span>调试时输出日志 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/middlewares.html" class="" aria-label="有用的中间件"><!--[--><!--]--><span>有用的中间件 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/autoquote.html" class="" aria-label="自动引用"><!--[--><!--]--><span>自动引用 <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/plugins/#创建你自己的插件" class="" aria-label="[等待你的 PR!]"><!--[--><!--]--><span>[等待你的 PR!] <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="示例"><span class="title">示例</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="示例"><span class="title">示例</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>示例 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://github.com/grammyjs/awesome-grammY" rel="noopener noreferrer" target="_blank" aria-label="Awesome grammY"><!--[--><!--]--><span>Awesome grammY <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://github.com/grammyjs/examples" rel="noopener noreferrer" target="_blank" aria-label="示例 Bots 仓库"><!--[--><!--]--><span>示例 Bots 仓库 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="资源"><span class="title">资源</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="资源"><span class="title">资源</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>grammY <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/resources/about.html" class="" aria-label="关于 grammY"><!--[--><!--]--><span>关于 grammY <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs" rel="noopener noreferrer" target="_blank" aria-label="社区聊天（英语）"><!--[--><!--]--><span>社区聊天（英语） <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs_ru" rel="noopener noreferrer" target="_blank" aria-label="社区聊天（俄语）"><!--[--><!--]--><span>社区聊天（俄语） <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://t.me/grammyjs_news" rel="noopener noreferrer" target="_blank" aria-label="咨询"><!--[--><!--]--><span>咨询 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://twitter.com/grammy_js" rel="noopener noreferrer" target="_blank" aria-label="Twitter"><!--[--><!--]--><span>Twitter <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/resources/faq.html" class="" aria-label="FAQ"><!--[--><!--]--><span>FAQ <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/resources/comparison.html" class="" aria-label="与其他框架的比较"><!--[--><!--]--><span>与其他框架的比较 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Telegram <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots" rel="noopener noreferrer" target="_blank" aria-label="面向开发者的介绍"><!--[--><!--]--><span>面向开发者的介绍 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/faq" rel="noopener noreferrer" target="_blank" aria-label="Bots FAQ"><!--[--><!--]--><span>Bots FAQ <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/api" rel="noopener noreferrer" target="_blank" aria-label="Bot API 概览"><!--[--><!--]--><span>Bot API 概览 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://core.telegram.org/bots/webhooks#testing-your-bot-with-updates" rel="noopener noreferrer" target="_blank" aria-label="Updates 示例"><!--[--><!--]--><span>Updates 示例 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="托管服务"><span class="title">托管服务</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="托管服务"><span class="title">托管服务</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>总览 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/hosting/comparison.html" class="" aria-label="对比"><!--[--><!--]--><span>对比 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>教程 <!----></span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/zh/hosting/deno-deploy.html" class="" aria-label="Deno Deploy"><!--[--><!--]--><span>Deno Deploy <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/hosting/supabase.html" class="" aria-label="Supabase Edge Functions"><!--[--><!--]--><span>Supabase Edge Functions <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/hosting/heroku.html" class="" aria-label="Heroku"><!--[--><!--]--><span>Heroku <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/hosting/gcf.html" class="" aria-label="Google Cloud Functions"><!--[--><!--]--><span>Google Cloud Functions <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/zh/hosting/vps.html" class="" aria-label="Virtual Private Server"><!--[--><!--]--><span>Virtual Private Server <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://doc.deno.land/https://deno.land/x/grammy/mod.ts" rel="noopener noreferrer" target="_blank" aria-label="API 参考"><!--[--><!--]--><span>API 参考 <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">语言</span><!----><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">语言</span><!----><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!-- suppress type check error by implementing `as any` --><!--[--><li class="navbar-dropdown-item"><a href="/guide/middleware.html" class="" aria-label="English"><!--[--><!--]--><span>English <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/guide/middleware.html" class="" aria-label="Español"><!--[--><!--]--><span>Español <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/guide/middleware.html" class="" aria-label="Indonesia"><!--[--><!--]--><span>Indonesia <!--v-if--></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/zh/guide/middleware.html" class="router-link-active router-link-exact-active router-link-active" aria-label="简体中文"><!--[--><!--]--><span>简体中文 <!--v-if--></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/grammyjs/grammY" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--><span>GitHub <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">中间件 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/zh/guide/middleware.html#中间件栈" class="router-link-active router-link-exact-active sidebar-item" aria-label="中间件栈"><!--[--><!--]--><span>中间件栈 <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh/guide/middleware.html#编写自定义中间件" class="router-link-active router-link-exact-active sidebar-item" aria-label="编写自定义中间件"><!--[--><!--]--><span>编写自定义中间件 <!--v-if--></span><!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh/guide/middleware.html#grammy-的中间件属性" class="router-link-active router-link-exact-active sidebar-item" aria-label="grammY 的中间件属性"><!--[--><!--]--><span>grammY 的中间件属性 <!--v-if--></span><!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="中间件" tabindex="-1"><a class="header-anchor" href="#中间件" aria-hidden="true">#</a> 中间件</h1><p>传递给 <code>bot<wbr>.on()</code>，<code>bot<wbr>.command()</code> 和它们的兄弟姐妹的监听器函数被称为 <em>中间件</em>。 虽然说它们在监听更新是没有错的，但称它们为&quot;监听者&quot;又有些简单了。</p><blockquote><p>本节解释了什么是中间件，并以 grammY 为例，说明如何使用中间件。 如果你正在寻找关于 grammY 实现中间件的特别之处的具体文档，请查看文档高级部分的 <a href="/zh/advanced/middleware.html" class="">Middleware Redux</a>。</p></blockquote><h2 id="中间件栈" tabindex="-1"><a class="header-anchor" href="#中间件栈" aria-hidden="true">#</a> 中间件栈</h2><p>假设你写一个这样的 bot:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bot</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;token&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Started!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;help&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Help text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;:text&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Text!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
bot<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;:photo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Photo!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当有普通文本信息的更新到达时，将执行这些步骤：</p><ol><li>你向 bot 发送 <code>你好！</code>。</li><li>你的 <code>session</code> 中间件会收到这些更新，并且做一些它需要做的事情。</li><li>这次更新将检查是否存在 <code>/start</code> command，即使它并不存在。</li><li>这次更新将检查是否存在 <code>/help</code> command，即使它并不存在。</li><li>更新将检查存在于信息中（或是 channel post 中）存在的文本信息，这些是存在的。</li><li>中间件 <code>(*)</code> 将被调用，它通过回复 <code>Text</code> 来处理更新。</li></ol><p>这次更新是<strong>不</strong>检查照片内容的，因为 <code>(*)</code> 的中间件已经处理了该更新。</p><p>这是如何工作的呢？ 让我们来了解一下。</p><p>我们可以在 grammY 的参考资料中查看 <code>Middleware</code> <a href="https://doc.deno.land/https://deno.land/x/grammy/mod.ts/~/Middleware" target="_blank" rel="noopener noreferrer">类型<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 为了简洁起见，省略了一些类型参数。</span>
<span class="token keyword">type</span> <span class="token class-name">Middleware</span> <span class="token operator">=</span> MiddlewareFn <span class="token operator">|</span> MiddlewareObj<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>啊哈。 中间件可以是一个函数或一个对象。 我们只用了函数（<code>(ctx) <wbr>=<wbr>&gt; { <wbr>..<wbr>. }</code>），所以我们暂时忽略中间件对象，深入挖掘 <code>Middleware<wbr>Fn</code> 类型（<a href="https://doc.deno.land/https://deno.land/x/grammy/mod.ts/~/MiddlewareFn" target="_blank" rel="noopener noreferrer">参考<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 再次省略了类型参数。</span>
<span class="token keyword">type</span> <span class="token class-name">MiddlewareFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ctx<span class="token operator">:</span> Context<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MaybePromise<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// 和</span>
<span class="token keyword">type</span> <span class="token class-name">NextFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>所以，中间件需要两个参数! 到目前为止我们只用了一个，即上下文对象 <code>ctx</code>。 我们<a href="/zh/guide/context.html" class="">已经知道</a> <code>ctx</code> 是什么，但我们也看到一个名字为 <code>next</code> 的函数。 为了理解 <code>next</code> 是什么，我们必须把你安装在 bot 对象上的所有中间件作为一个整体来看。</p><p>你可以把所有安装的中间件功能看作是若干层，它们相互堆叠在一起。 第一个中间件（在我们的例子中是 <code>session</code> ）是最上层，因此首先接收每个更新。 然后它可以决定是否要处理更新，或将其传递给下一层（ <code>/start</code> command 处理程序）。 函数 <code>next</code> 可以用来调用后续的中间件，通常称为 <em>下游中间件</em>。 这也意味着，如果你在中间件中不调用 <code>next</code> ，底层的中间件将不会被调用。</p><p>这个函数栈就是 <em>中间件栈</em>。</p><div class="language-asciiart ext-asciiart"><pre class="language-asciiart"><code>(ctx, next) =&gt; ...    |
(ctx, next) =&gt; ...    |————— X 的上游中间件
(ctx, next) =&gt; ...    |
(ctx, next) =&gt; ...       &lt;— 中间件 X 调用 `next` 来传递更新信息
(ctx, next) =&gt; ...    |
(ctx, next) =&gt; ...    |————— X 的下游中间件
(ctx, next) =&gt; ...    |
</code></pre></div><p>回顾我们之前的例子，我们现在知道为什么 <code>bot<wbr>.on(&quot;:<wbr>photo&quot;)</code> 从未被使用：<code>bot<wbr>.on(&quot;:<wbr>text&quot;<wbr>, (ctx) <wbr>=<wbr>&gt; { <wbr>..<wbr>. })</code> 中的中间件已经处理了更新，它没有调用 <code>next</code> 。 事实上，它甚至没有把 <code>next</code> 作为一个参数。 它只是忽略了 <code>next</code> ，因此没有传递更新。</p><p>让我们用我们的新知识尝试一下其他的东西吧!</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bot</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;token&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;:text&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Text!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token string">&quot;Command!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你运行上述 bot ，并发送 <code>/start</code> ，你将永远不会看到一个 <code>Command!</code> 的响应。 让我们思考一下会发生什么。</p><ol><li>你发送了 <code>&quot;<wbr>/start&quot;</code> 给 bot.</li><li><code>:<wbr>text</code> 中间件收到更新并检查文本，由于 command 是文本信息，所以成功了。 更新被第一个中间件立即处理，你的机器人回复 <code>Text!</code> 。</li></ol><p>消息甚至从来没有被检查过是否包含 <code>/start</code> command。 你注册中间件的顺序很重要，因为它决定了中间件栈中各层的顺序。 你可以通过翻转第 3 和第 4 行的顺序来解决这个问题。 如果你在第 3 行调用 <code>next</code> ，就会有两个响应被发送。</p><p><strong><code>bot<wbr>.use()</code> 函数只是注册了接收所有更新的中间件</strong> 这就是为什么 <code>session()</code> 要通过 <code>bot<wbr>.use()</code> 来安装的原因–我们希望这个插件能对所有的更新进行操作，不管包含什么数据。</p><p>拥有一个中间件栈是任何网络框架的一个极其强大的属性，这种模式广泛流行（不仅仅是Telegram Bot）。</p><p>让我们自己写一个小的中间件来更好地说明它是如何工作的。</p><h2 id="编写自定义中间件" tabindex="-1"><a class="header-anchor" href="#编写自定义中间件" aria-hidden="true">#</a> 编写自定义中间件</h2><p>我们将通过编写一个简单的中间件函数来说明中间件的概念，该函数可以统计你的 bot 的响应时间，即你的 bot 处理一个消息需要多长时间。</p><p>这里是我们中间件的函数签名。 你可以把它与上面的中间件类型进行比较，并说服自己，我们在这里确实完成了一个中间件。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token doc-comment comment">/** 统计 bot 的响应时间，并将其记录到 `console`。 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">responseTime</span><span class="token punctuation">(</span>
  ctx<span class="token operator">:</span> Context<span class="token punctuation">,</span>
  next<span class="token operator">:</span> NextFunction<span class="token punctuation">,</span> <span class="token comment">// 这是 `() =&gt; Promise&lt;void&gt;` 的一个别名</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO：实现</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/** 统计 bot 的响应时间，并将其记录到 `console`。 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">responseTime</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO：实现</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>我们可以用 <code>bot<wbr>.use()</code> 把它安装到我们的 <code>bot</code> 实例中。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>让我们开始实现它。 以下是我们要做的事情：</p><ol><li>一旦有更新到来，我们就把 <code>Date<wbr>.now()</code> 存储在一个变量中。</li><li>我们调用下游的中间件，好让所有的消息处理发生。 这包括 command 匹配、回复以及你的 bot 所做的其他一切。</li><li>我们再次使用 <code>Date<wbr>.now()</code> ，将其与旧值进行比较，然后 <code>console<wbr>.log</code> 显示时间差异。</li></ol><p>重要的是，要先在 bot 上安装我们的 <code>response<wbr>Time</code> 中间件（在中间件栈的顶部），以确保所有操作都包括在统计中。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TypeScript</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">JavaScript</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token doc-comment comment">/** 统计 bot 的响应时间，并将其记录到 `console`。 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">responseTime</span><span class="token punctuation">(</span>
  ctx<span class="token operator">:</span> Context<span class="token punctuation">,</span>
  next<span class="token operator">:</span> NextFunction<span class="token punctuation">,</span> <span class="token comment">// 这是 `() =&gt; Promise&lt;void&gt;` 的一个别名</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 开始计时</span>
  <span class="token keyword">const</span> before <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 毫秒</span>
  <span class="token comment">// 调用下游的中间件</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请务必使用 `await`！</span>
  <span class="token comment">// 停止计时</span>
  <span class="token keyword">const</span> after <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 毫秒</span>
  <span class="token comment">// 打印时间差</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Response time: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>after <span class="token operator">-</span> before<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/** 统计 bot 的响应时间，并将其记录到 `console`。 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">responseTime</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 开始计时</span>
  <span class="token keyword">const</span> before <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 毫秒</span>
  <span class="token comment">// 调用下游的中间件</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请务必使用 `await`！</span>
  <span class="token comment">// 停止计时</span>
  <span class="token keyword">const</span> after <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 毫秒</span>
  <span class="token comment">// 打印时间差</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Response time: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>after <span class="token operator">-</span> before<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>完成，并且可以正常工作! ✔️</p><p>欢迎在你的 bot 对象上使用这个中间件，注册更多的监听器，并试一试这个例子。 这样做将有助于你充分理解什么是中间件。</p><div class="custom-container danger"><p class="custom-container-title">DANGER: 请一定要对 `next` 使用 `await`！</p><p>如果你在调用 <code>next()</code> 时没有使用 <code>await</code> 关键字，有几件事会被搞砸：</p><ul><li>❌ 你的中间件栈将以错误的顺序执行。</li><li>❌ 你可能会遇到数据丢失。</li><li>❌ 一些消息可能无法发送</li><li>❌ 你的 bot 可能会以难以重现的方式随机崩溃。</li><li>❌ 如果发生错误，你的错误处理程序将不会被调用。 相反，你会看到一个 <code>Unhandled<wbr>Promise<wbr>Rejection<wbr>Warning</code> 发生，这可能会使你的 bot 进程崩溃。</li><li>❌ <a href="/zh/plugins/runner.html" class="">grammY runner</a> 的抗压机制被打破，它可以保护你的服务器免受过高的负载，例如在负载高峰期。</li><li>💀 有时，它还会杀死你所有的无辜代码（是真的！）。😿</li></ul></div><p>你应该在 <code>next()</code> 前使用 <code>await</code> 这一规则是特别重要的，但它实际上适用于任何返回 <code>Promise</code> 的一般表达式。 这包括 <code>bot<wbr>.api<wbr>.send<wbr>Message</code>，<code>ctx<wbr>.reply</code>，以及所有其他网络调用。 如果你的项目对你很重要，那么你就会使用提示工具，如果你忘记在 <code>Promise</code> 上使用 <code>await</code>，工具会警告你。</p><div class="custom-container tip"><p class="custom-container-title">启用 no-floating-promises</p><p>考虑使用 <a href="https://eslint.org/" target="_blank" rel="noopener noreferrer">ESLint<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 并配置它使用 <a href="https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/docs/rules/no-floating-promises.md" target="_blank" rel="noopener noreferrer">no<wbr>-floating<wbr>-promises<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 规则。 这将确保你永远不会忘记使用 <code>await</code>（通过不停的唠叨你）。</p></div><h2 id="grammy-的中间件属性" tabindex="-1"><a class="header-anchor" href="#grammy-的中间件属性" aria-hidden="true">#</a> grammY 的中间件属性</h2><p>对于 grammY，中间件将返回一个 <code>Promise</code>（必须结合 <code>await</code> 使用）, 但它也可以是同步的。</p><p>与其他中间件系统（如来自 <code>express</code> 的中间件系统）相比，你不能向 <code>next</code> 传递错误值。 <code>next</code> 不接受任何参数。 如果你想报错，你可以直接 <code>throw</code> 错误。 另一个区别是，你的中间件接受多少个参数并不重要。<code>() <wbr>=<wbr>&gt; {}</code> 将被完全作为 <code>(ctx) <wbr>=<wbr>&gt; {}</code> 处理，或作为 <code>(ctx<wbr>, next) <wbr>=<wbr>&gt; {}</code> 处理。</p><p>有两种类型的中间件：函数和对象。 中间件对象只是中间件函数的一个封装器。 它们大多在内部使用，但有时也可以帮助第三方库，或用于高级用例，如与 <a href="https://doc.deno.land/https://deno.land/x/grammy/mod.ts/~/Composer" target="_blank" rel="noopener noreferrer">Composer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bot</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;token&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> composer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Composer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
composer<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>composer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// composer 是一个中间件对象!</span>

bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bot<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你想深入了解 grammY 如何实现中间件，请在文档的进阶部分查阅 <a href="/zh/advanced/middleware.html" class="">Middleware Redux</a>。</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/grammyjs/website/edit/main/site/docs/zh/guide/middleware.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页！"><!--[--><!--]--><span>在 GitHub 上编辑此页！ <!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">最近更新时间: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: shtrog@gmail.com">KnorpelSenf</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: ez@roj.im">Roj</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 643089849@qq.com">WingLim</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 56839018+linbuxiao@users.noreply.github.com">linbuxiao</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: rojserbest@gmail.com">Roj</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/zh/guide/commands.html" class="" aria-label="Commands"><!--[--><!--]--><span>Commands <!--v-if--></span><!--[--><!--]--></a></span><span class="next"><a href="/zh/guide/errors.html" class="" aria-label="错误处理"><!--[--><!--]--><span>错误处理 <!--v-if--></span><!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.81c9d145.js" defer></script>
  </body>
</html>
